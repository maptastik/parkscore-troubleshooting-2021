var e=Object.defineProperty,a=Object.prototype.hasOwnProperty,t=Object.getOwnPropertySymbols,l=Object.prototype.propertyIsEnumerable,n=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,s=(e,s)=>{for(var o in s||(s={}))a.call(s,o)&&n(e,o,s[o]);if(t)for(var o of t(s))l.call(s,o)&&n(e,o,s[o]);return e};import{aJ as o,O as i,m as r,U as c,aN as u}from"./vendor.1ee57f36.js";import{c as m,d as p,e as h,h as d,l as f,f as y}from"./index.4894e768.js";const v=document.createElement("canvas");function b(e,a){const t=null!=(null==a?void 0:a.size)?o(a.size):null,l=null!=(null==a?void 0:a.maxSize)?o(a.maxSize):null,n=null!=(null==a?void 0:a.opacity)?a.opacity:null,b=null!=(null==a?void 0:a.rotation)?a.rotation:null,w=m(e),g={shape:null,fill:null,stroke:w,offset:[0,0]};null!=w&&w.width&&(w.width=Math.min(w.width,80));const M=(null==w?void 0:w.width)||0;let x=null!=t&&(null==(null==a?void 0:a.scale)||(null==a?void 0:a.scale)),k=0,L=0;switch(e.type){case"simple-marker":{const a=e.style,n=Math.min(null!=t?t:o(e.size),l||120);switch(k=n,L=n,a){case"circle":g.shape={type:"circle",cx:0,cy:0,r:.5*n},x||(k+=M,L+=M);break;case"cross":g.shape={type:"path",path:[{command:"M",values:[0,.5*L]},{command:"L",values:[k,.5*L]},{command:"M",values:[.5*k,0]},{command:"L",values:[.5*k,L]}]};break;case"diamond":g.shape={type:"path",path:[{command:"M",values:[0,.5*L]},{command:"L",values:[.5*k,0]},{command:"L",values:[k,.5*L]},{command:"L",values:[.5*k,L]},{command:"Z",values:[]}]},x||(k+=M,L+=M);break;case"square":g.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[k,0]},{command:"L",values:[k,L]},{command:"L",values:[0,L]},{command:"Z",values:[]}]},x||(k+=M,L+=M);break;case"triangle":g.shape={type:"path",path:[{command:"M",values:[.5*k,0]},{command:"L",values:[k,L]},{command:"L",values:[0,L]},{command:"Z",values:[]}]},x||(k+=M,L+=M);break;case"x":g.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[k,L]},{command:"M",values:[k,0]},{command:"L",values:[0,L]}]};break;case"path":g.shape={type:"path",path:e.path||""},x||(k+=M,L+=M),x=!0}break}case"simple-line":{const e=Math.min(null!=t?t:M,l||80),a=e>22?2*e:40;w.width=e,k=a,L=e,g.shape={type:"path",path:[{command:"M",values:[0,L]},{command:"L",values:[k,L]}]};break}case"picture-fill":case"simple-fill":k=Math.min(null!=t?t:22,l||120)+M,L=k,x=!0,g.shape="object"==typeof(null==a?void 0:a.symbolConfig)&&null!=a&&a.symbolConfig.isSquareFill?p.squareFill[0]:p.fill[0];break;case"picture-marker":{let a=o(e.width),n=o(e.height);const s=Math.max(a,n),i=a/n;a=i<=1?Math.ceil(s*i):s,n=i<=1?s:Math.ceil(s/i),k=Math.min(null!=t?t:a,l||120),L=Math.min(null!=t?t:n,l||120),g.shape={type:"image",x:-Math.round(k/2),y:-Math.round(L/2),width:k,height:L,src:e.url||""};break}case"text":{const a=e,n=a.text||"Aa",s=a.font,i=Math.min(null!=t?t:o(s.size),l||120),r=function(e,a){const t=v.getContext("2d"),l=[];return a&&(a.weight&&l.push(a.weight),a.size&&l.push(a.size+"px"),a.family&&l.push(a.family)),t.font=l.join(" "),t.measureText(e).width}(n,{weight:s.weight,size:i,family:s.family}),c=/[\uE600-\uE6FF]/.test(n);k=c?i:r,L=i;let m=.25*function(e){if(0===e.length)return 0;if(e.length>2){const a=u(1),t=parseFloat(e);switch(e.slice(-2)){case"px":return t;case"pt":return t*a;case"in":return 72*t*a;case"pc":return 12*t*a;case"mm":return 2.8346456692913384*t*a;case"cm":return 28.346456692913385*t*a}}return parseFloat(e)}((s?i:0).toString());c&&(m+=5),g.shape={type:"text",text:n,x:0,y:m,align:"middle",decoration:s&&s.decoration,rotated:a.rotated,kerning:a.kerning},g.font=s&&{size:i,style:s.style,decoration:s.decoration,weight:s.weight,family:s.family};break}}if(!g.shape)return i(new r("symbolPreview: renderPreviewHTML2D","symbol not supported."));const z=h(e),j=z,C=e.color;let F=null;return j&&"pattern"===j.type&&C&&"picture-fill"!==e.type?F=y(j.src,C.toCss(!0)).then((e=>(j.src=e,g.fill=j,g))):(g.fill=z,F=c(g)),F.then((e=>{const t=[[e]];if("object"==typeof(null==a?void 0:a.symbolConfig)&&null!=a&&a.symbolConfig.applyColorModulation){const a=.6*k;t.unshift([s(s({},e),{offset:[-a,0],fill:d(z,-.3)})]),t.push([s(s({},e),{offset:[a,0],fill:d(z,.3)})]),k+=2*a}return f(t,[k,L],{node:a&&a.node,scale:x,opacity:n,rotation:b})}))}export{b as previewSymbol2D};
