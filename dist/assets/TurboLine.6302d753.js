import{bW as e,di as t,g as i}from"./vendor.1ee57f36.js";import{g as s}from"./GeometryUtils.4f6b8486.js";class r{constructor(e,t){this.x=e,this.y=t}clone(){return new r(this.x,this.y)}equals(e,t){return e===this.x&&t===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,t){this.x=e,this.y=t}normalize(){const e=this.x,t=this.y,i=Math.sqrt(e*e+t*t);this.x/=i,this.y/=i}rightPerpendicular(){const e=this.x;this.x=this.y,this.y=-e}move(e,t){this.x+=e,this.y+=t}assign(e){this.x=e.x,this.y=e.y}assignAdd(e,t){this.x=e.x+t.x,this.y=e.y+t.y}assignSub(e,t){this.x=e.x-t.x,this.y=e.y-t.y}rotate(e,t){const i=this.x,s=this.y;this.x=i*e-s*t,this.y=i*t+s*e}scale(e){this.x*=e,this.y*=e}length(){const e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}static distance(e,t){const i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}static add(e,t){return new r(e.x+t.x,e.y+t.y)}static sub(e,t){return new r(e.x-t.x,e.y-t.y)}}class n{constructor(e,t,i){this.ratio=e,this.x=t,this.y=i}}class o{constructor(t,i,s,r=8,n=8){this.lines=[],this.starts=[],this.validateTessellation=!0,this.pixelRatio=r,this.pixelMargin=n,this.tileSize=e*r,this.dz=t,this.yPos=i,this.xPos=s}setExtent(e){this.finalRatio=this.tileSize/e*(1<<this.dz);let t=this.pixelRatio*this.pixelMargin;t/=this.finalRatio;const i=e>>this.dz;t>i&&(t=i),this.margin=t,this.xmin=i*this.xPos-t,this.ymin=i*this.yPos-t,this.xmax=this.xmin+i+2*t,this.ymax=this.ymin+i+2*t}reset(e){this.type=e,this.lines=[],this.starts=[],this.line=null,this.start=0}moveTo(e,t){this._pushLine(),this._prevIsIn=this._isIn(e,t),this._moveTo(e,t,this._prevIsIn),this._prevPt=new r(e,t),this._firstPt=new r(e,t),this._dist=0}lineTo(e,t){const i=this._isIn(e,t),s=new r(e,t),o=r.distance(this._prevPt,s);let l,a,h,u,c,x,d,g;if(i)this._prevIsIn?this._lineTo(e,t,!0):(l=this._prevPt,a=s,h=this._intersect(a,l),this.start=this._dist+o*(1-this._r),this._lineTo(h.x,h.y,!0),this._lineTo(a.x,a.y,!0));else if(this._prevIsIn)a=this._prevPt,l=s,h=this._intersect(a,l),this._lineTo(h.x,h.y,!0),this._lineTo(l.x,l.y,!1);else{const e=this._prevPt,t=s;if(e.x<=this.xmin&&t.x<=this.xmin||e.x>=this.xmax&&t.x>=this.xmax||e.y<=this.ymin&&t.y<=this.ymin||e.y>=this.ymax&&t.y>=this.ymax)this._lineTo(t.x,t.y,!1);else{const i=[];if((e.x<this.xmin&&t.x>this.xmin||e.x>this.xmin&&t.x<this.xmin)&&(u=(this.xmin-e.x)/(t.x-e.x),g=e.y+u*(t.y-e.y),g<=this.ymin?x=!1:g>=this.ymax?x=!0:i.push(new n(u,this.xmin,g))),(e.x<this.xmax&&t.x>this.xmax||e.x>this.xmax&&t.x<this.xmax)&&(u=(this.xmax-e.x)/(t.x-e.x),g=e.y+u*(t.y-e.y),g<=this.ymin?x=!1:g>=this.ymax?x=!0:i.push(new n(u,this.xmax,g))),(e.y<this.ymin&&t.y>this.ymin||e.y>this.ymin&&t.y<this.ymin)&&(u=(this.ymin-e.y)/(t.y-e.y),d=e.x+u*(t.x-e.x),d<=this.xmin?c=!1:d>=this.xmax?c=!0:i.push(new n(u,d,this.ymin))),(e.y<this.ymax&&t.y>this.ymax||e.y>this.ymax&&t.y<this.ymax)&&(u=(this.ymax-e.y)/(t.y-e.y),d=e.x+u*(t.x-e.x),d<=this.xmin?c=!1:d>=this.xmax?c=!0:i.push(new n(u,d,this.ymax))),0===i.length)c?x?this._lineTo(this.xmax,this.ymax,!0):this._lineTo(this.xmax,this.ymin,!0):x?this._lineTo(this.xmin,this.ymax,!0):this._lineTo(this.xmin,this.ymin,!0);else if(i.length>1&&i[0].ratio>i[1].ratio)this.start=this._dist+o*i[1].ratio,this._lineTo(i[1].x,i[1].y,!0),this._lineTo(i[0].x,i[0].y,!0);else{this.start=this._dist+o*i[0].ratio;for(let e=0;e<i.length;e++)this._lineTo(i[e].x,i[e].y,!0)}this._lineTo(t.x,t.y,!1)}}this._dist+=o,this._prevIsIn=i,this._prevPt=s}close(){if(this.line.length>2){const e=this._firstPt,t=this._prevPt;e.x===t.x&&e.y===t.y||this.lineTo(e.x,e.y);const i=this.line;let s=i.length;for(;s>=4&&(i[0].x===i[1].x&&i[0].x===i[s-2].x||i[0].y===i[1].y&&i[0].y===i[s-2].y);)i.pop(),i[0].x=i[s-2].x,i[0].y=i[s-2].y,--s}}result(e=!0){return this._pushLine(),0===this.lines.length?null:(3===this.type&&e&&a.simplify(this.tileSize,this.margin*this.finalRatio,this.lines),this.lines)}resultWithStarts(){if(2!==this.type)throw new Error("Only valid for lines");this._pushLine();const e=this.lines,t=e.length;if(0===t)return null;const i=[];for(let s=0;s<t;s++)i.push({line:e[s],start:this.starts[s]||0});return i}_isIn(e,t){return e>=this.xmin&&e<=this.xmax&&t>=this.ymin&&t<=this.ymax}_intersect(e,t){let i,s,n;if(t.x>=this.xmin&&t.x<=this.xmax)s=t.y<=this.ymin?this.ymin:this.ymax,n=(s-e.y)/(t.y-e.y),i=e.x+n*(t.x-e.x);else if(t.y>=this.ymin&&t.y<=this.ymax)i=t.x<=this.xmin?this.xmin:this.xmax,n=(i-e.x)/(t.x-e.x),s=e.y+n*(t.y-e.y);else{s=t.y<=this.ymin?this.ymin:this.ymax,i=t.x<=this.xmin?this.xmin:this.xmax;const r=(i-e.x)/(t.x-e.x),o=(s-e.y)/(t.y-e.y);r<o?(n=r,s=e.y+r*(t.y-e.y)):(n=o,i=e.x+o*(t.x-e.x))}return this._r=n,new r(i,s)}_pushLine(){this.line&&(1===this.type?this.line.length>0&&(this.lines.push(this.line),this.starts.push(this.start)):2===this.type?this.line.length>1&&(this.lines.push(this.line),this.starts.push(this.start)):3===this.type&&this.line.length>3&&(this.lines.push(this.line),this.starts.push(this.start))),this.line=[],this.start=0}_moveTo(e,t,i){3!==this.type?i&&(e=Math.round((e-(this.xmin+this.margin))*this.finalRatio),t=Math.round((t-(this.ymin+this.margin))*this.finalRatio),this.line.push(new r(e,t))):(i||(e<this.xmin&&(e=this.xmin),e>this.xmax&&(e=this.xmax),t<this.ymin&&(t=this.ymin),t>this.ymax&&(t=this.ymax)),e=Math.round((e-(this.xmin+this.margin))*this.finalRatio),t=Math.round((t-(this.ymin+this.margin))*this.finalRatio),this.line.push(new r(e,t)),this._is_h=!1,this._is_v=!1)}_lineTo(e,t,i){let s,n;if(3!==this.type)if(i){if(e=Math.round((e-(this.xmin+this.margin))*this.finalRatio),t=Math.round((t-(this.ymin+this.margin))*this.finalRatio),this.line.length>0&&(s=this.line[this.line.length-1],s.equals(e,t)))return;this.line.push(new r(e,t))}else this.line&&this.line.length>0&&this._pushLine();else if(i||(e<this.xmin&&(e=this.xmin),e>this.xmax&&(e=this.xmax),t<this.ymin&&(t=this.ymin),t>this.ymax&&(t=this.ymax)),e=Math.round((e-(this.xmin+this.margin))*this.finalRatio),t=Math.round((t-(this.ymin+this.margin))*this.finalRatio),this.line&&this.line.length>0){s=this.line[this.line.length-1];const i=s.x===e,o=s.y===t;if(i&&o)return;this._is_h&&i||this._is_v&&o?(s.x=e,s.y=t,n=this.line[this.line.length-2],n.x===e&&n.y===t?(this.line.pop(),this.line.length<=1?(this._is_h=!1,this._is_v=!1):(n=this.line[this.line.length-2],this._is_h=n.x===e,this._is_v=n.y===t)):(this._is_h=n.x===e,this._is_v=n.y===t)):(this.line.push(new r(e,t)),this._is_h=i,this._is_v=o)}else this.line.push(new r(e,t))}}class l{setExtent(e){this._ratio=4096===e?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this.lines=[],this.line=null}moveTo(e,t){this.line&&this.lines.push(this.line),this.line=[];const i=this._ratio;this.line.push(new r(e*i,t*i))}lineTo(e,t){const i=this._ratio;this.line.push(new r(e*i,t*i))}close(){const e=this.line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this.line&&this.lines.push(this.line),0===this.lines.length?null:this.lines}}class a{static simplify(e,t,i){if(!i)return;const s=-t,r=e+t,n=-t,o=e+t,l=[],h=[],u=i.length;for(let a=0;a<u;++a){const e=i[a];if(!e||e.length<2)continue;let t,u=e[0];const c=e.length;for(let i=1;i<c;++i)t=e[i],u.x===t.x&&(u.x<=s&&(u.y>t.y?(l.push(a),l.push(i),l.push(0),l.push(-1)):(h.push(a),h.push(i),h.push(0),h.push(-1))),u.x>=r&&(u.y<t.y?(l.push(a),l.push(i),l.push(1),l.push(-1)):(h.push(a),h.push(i),h.push(1),h.push(-1)))),u.y===t.y&&(u.y<=n&&(u.x<t.x?(l.push(a),l.push(i),l.push(2),l.push(-1)):(h.push(a),h.push(i),h.push(2),h.push(-1))),u.y>=o&&(u.x>t.x?(l.push(a),l.push(i),l.push(3),l.push(-1)):(h.push(a),h.push(i),h.push(3),h.push(-1)))),u=t}if(0===l.length||0===h.length)return;a.fillParent(i,h,l),a.fillParent(i,l,h);const c=[];a.calcDeltas(c,h,l),a.calcDeltas(c,l,h),a.addDeltas(c,i)}static fillParent(e,t,i){const r=i.length,n=t.length;for(let o=0;o<n;o+=4){const n=t[o],l=t[o+1],a=t[o+2],h=e[n][l-1],u=e[n][l];let c=8092,x=-1;for(let t=0;t<r;t+=4){if(i[t+2]!==a)continue;const r=i[t],n=i[t+1],o=e[r][n-1],l=e[r][n];switch(a){case 0:case 1:if(s(h.y,o.y,l.y)&&s(u.y,o.y,l.y)){const e=Math.abs(l.y-o.y);e<c&&(c=e,x=t)}break;case 2:case 3:if(s(h.x,o.x,l.x)&&s(u.x,o.x,l.x)){const e=Math.abs(l.x-o.x);e<c&&(c=e,x=t)}}}t[o+3]=x}}static calcDeltas(e,t,i){const s=t.length;for(let r=0;r<s;r+=4){const s=[],n=a.calcDelta(r,t,i,s);e.push(t[r]),e.push(t[r+1]),e.push(t[r+2]),e.push(n)}}static calcDelta(e,t,i,s){const r=t[e+3];if(-1===r)return 0;const n=s.length;return n>1&&s[n-2]===r?0:(s.push(r),a.calcDelta(r,i,t,s)+1)}static addDeltas(e,t){const i=e.length;let s=0;for(let r=0;r<i;r+=4){const t=e[r+3];t>s&&(s=t)}for(let r=0;r<i;r+=4){const i=t[e[r]],n=e[r+1],o=s-e[r+3];switch(e[r+2]){case 0:i[n-1].x-=o,i[n].x-=o,1===n&&(i[i.length-1].x-=o),n===i.length-1&&(i[0].x-=o);break;case 1:i[n-1].x+=o,i[n].x+=o,1===n&&(i[i.length-1].x+=o),n===i.length-1&&(i[0].x+=o);break;case 2:i[n-1].y-=o,i[n].y-=o,1===n&&(i[i.length-1].y-=o),n===i.length-1&&(i[0].y-=o);break;case 3:i[n-1].y+=o,i[n].y+=o,1===n&&(i[i.length-1].y+=o),n===i.length-1&&(i[0].y+=o)}}}}var h=t((function(e){var t,i;void 0!==((i={DEBUG:!1,assert:function(e,t){if(i.DEBUG&&!e)throw new Error("Assertion failed"+(t?": "+t:""))},GLU_TESS_MAX_COORD:1e150,TRUE_PROJECT:!1,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901},geom:{}}).geom.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},i.geom.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},i.geom.edgeEval=function(e,t,s){i.assert(i.geom.vertLeq(e,t)&&i.geom.vertLeq(t,s));var r=t.s-e.s,n=s.s-t.s;return r+n>0?r<n?t.t-e.t+(e.t-s.t)*(r/(r+n)):t.t-s.t+(s.t-e.t)*(n/(r+n)):0},i.geom.edgeSign=function(e,t,s){i.assert(i.geom.vertLeq(e,t)&&i.geom.vertLeq(t,s));var r=t.s-e.s,n=s.s-t.s;return r+n>0?(t.t-s.t)*r+(t.t-e.t)*n:0},i.geom.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},i.geom.transEval=function(e,t,s){i.assert(i.geom.transLeq(e,t)&&i.geom.transLeq(t,s));var r=t.t-e.t,n=s.t-t.t;return r+n>0?r<n?t.s-e.s+(e.s-s.s)*(r/(r+n)):t.s-s.s+(s.s-e.s)*(n/(r+n)):0},i.geom.transSign=function(e,t,s){i.assert(i.geom.transLeq(e,t)&&i.geom.transLeq(t,s));var r=t.t-e.t,n=s.t-t.t;return r+n>0?(t.s-s.s)*r+(t.s-e.s)*n:0},i.geom.edgeGoesLeft=function(e){return i.geom.vertLeq(e.dst(),e.org)},i.geom.edgeGoesRight=function(e){return i.geom.vertLeq(e.org,e.dst())},i.geom.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},i.geom.vertCCW=function(e,t,i){return e.s*(t.t-i.t)+t.s*(i.t-e.t)+i.s*(e.t-t.t)>=0},i.geom.interpolate_=function(e,t,i,s){return(e=e<0?0:e)<=(i=i<0?0:i)?0===i?(t+s)/2:t+e/(e+i)*(s-t):s+i/(e+i)*(t-s)},i.geom.edgeIntersect=function(e,t,s,r,n){var o,l,a;i.geom.vertLeq(e,t)||(a=e,e=t,t=a),i.geom.vertLeq(s,r)||(a=s,s=r,r=a),i.geom.vertLeq(e,s)||(a=e,e=s,s=a,a=t,t=r,r=a),i.geom.vertLeq(s,t)?i.geom.vertLeq(t,r)?((o=i.geom.edgeEval(e,s,t))+(l=i.geom.edgeEval(s,t,r))<0&&(o=-o,l=-l),n.s=i.geom.interpolate_(o,s.s,l,t.s)):((o=i.geom.edgeSign(e,s,t))+(l=-i.geom.edgeSign(e,r,t))<0&&(o=-o,l=-l),n.s=i.geom.interpolate_(o,s.s,l,r.s)):n.s=(s.s+t.s)/2,i.geom.transLeq(e,t)||(a=e,e=t,t=a),i.geom.transLeq(s,r)||(a=s,s=r,r=a),i.geom.transLeq(e,s)||(a=e,e=s,s=a,a=t,t=r,r=a),i.geom.transLeq(s,t)?i.geom.transLeq(t,r)?((o=i.geom.transEval(e,s,t))+(l=i.geom.transEval(s,t,r))<0&&(o=-o,l=-l),n.t=i.geom.interpolate_(o,s.t,l,t.t)):((o=i.geom.transSign(e,s,t))+(l=-i.geom.transSign(e,r,t))<0&&(o=-o,l=-l),n.t=i.geom.interpolate_(o,s.t,l,r.t)):n.t=(s.t+t.t)/2},i.mesh={},i.mesh.makeEdge=function(e){var t=i.mesh.makeEdgePair_(e.eHead);return i.mesh.makeVertex_(t,e.vHead),i.mesh.makeVertex_(t.sym,e.vHead),i.mesh.makeFace_(t,e.fHead),t},i.mesh.meshSplice=function(e,t){var s=!1,r=!1;e!==t&&(t.org!==e.org&&(r=!0,i.mesh.killVertex_(t.org,e.org)),t.lFace!==e.lFace&&(s=!0,i.mesh.killFace_(t.lFace,e.lFace)),i.mesh.splice_(t,e),r||(i.mesh.makeVertex_(t,e.org),e.org.anEdge=e),s||(i.mesh.makeFace_(t,e.lFace),e.lFace.anEdge=e))},i.mesh.deleteEdge=function(e){var t=e.sym,s=!1;e.lFace!==e.rFace()&&(s=!0,i.mesh.killFace_(e.lFace,e.rFace())),e.oNext===e?i.mesh.killVertex_(e.org,null):(e.rFace().anEdge=e.oPrev(),e.org.anEdge=e.oNext,i.mesh.splice_(e,e.oPrev()),s||i.mesh.makeFace_(e,e.lFace)),t.oNext===t?(i.mesh.killVertex_(t.org,null),i.mesh.killFace_(t.lFace,null)):(e.lFace.anEdge=t.oPrev(),t.org.anEdge=t.oNext,i.mesh.splice_(t,t.oPrev())),i.mesh.killEdge_(e)},i.mesh.addEdgeVertex=function(e){var t=i.mesh.makeEdgePair_(e),s=t.sym;return i.mesh.splice_(t,e.lNext),t.org=e.dst(),i.mesh.makeVertex_(s,t.org),t.lFace=s.lFace=e.lFace,t},i.mesh.splitEdge=function(e){var t=i.mesh.addEdgeVertex(e).sym;return i.mesh.splice_(e.sym,e.sym.oPrev()),i.mesh.splice_(e.sym,t),e.sym.org=t.org,t.dst().anEdge=t.sym,t.sym.lFace=e.rFace(),t.winding=e.winding,t.sym.winding=e.sym.winding,t},i.mesh.connect=function(e,t){var s=!1,r=i.mesh.makeEdgePair_(e),n=r.sym;return t.lFace!==e.lFace&&(s=!0,i.mesh.killFace_(t.lFace,e.lFace)),i.mesh.splice_(r,e.lNext),i.mesh.splice_(n,t),r.org=e.dst(),n.org=t.org,r.lFace=n.lFace=e.lFace,e.lFace.anEdge=n,s||i.mesh.makeFace_(r,e.lFace),r},i.mesh.zapFace=function(e){var t,s=e.anEdge,r=s.lNext;do{if(r=(t=r).lNext,t.lFace=null,null===t.rFace()){t.oNext===t?i.mesh.killVertex_(t.org,null):(t.org.anEdge=t.oNext,i.mesh.splice_(t,t.oPrev()));var n=t.sym;n.oNext===n?i.mesh.killVertex_(n.org,null):(n.org.anEdge=n.oNext,i.mesh.splice_(n,n.oPrev())),i.mesh.killEdge_(t)}}while(t!==s);var o=e.prev,l=e.next;l.prev=o,o.next=l},i.mesh.meshUnion=function(e,t){var i=e.fHead,s=e.vHead,r=e.eHead,n=t.fHead,o=t.vHead,l=t.eHead;return n.next!==n&&(i.prev.next=n.next,n.next.prev=i.prev,n.prev.next=i,i.prev=n.prev),o.next!==o&&(s.prev.next=o.next,o.next.prev=s.prev,o.prev.next=s,s.prev=o.prev),l.next!==l&&(r.sym.next.sym.next=l.next,l.next.sym.next=r.sym.next,l.sym.next.sym.next=r,r.sym.next=l.sym.next),e},i.mesh.deleteMesh=function(e){},i.mesh.makeEdgePair_=function(e){var t=new i.GluHalfEdge,s=new i.GluHalfEdge,r=e.sym.next;return s.next=r,r.sym.next=t,t.next=e,e.sym.next=s,t.sym=s,t.oNext=t,t.lNext=s,s.sym=t,s.oNext=s,s.lNext=t,t},i.mesh.splice_=function(e,t){var i=e.oNext,s=t.oNext;i.sym.lNext=t,s.sym.lNext=e,e.oNext=s,t.oNext=i},i.mesh.makeVertex_=function(e,t){var s=t.prev,r=new i.GluVertex(t,s);s.next=r,t.prev=r,r.anEdge=e;var n=e;do{n.org=r,n=n.oNext}while(n!==e)},i.mesh.makeFace_=function(e,t){var s=t.prev,r=new i.GluFace(t,s);s.next=r,t.prev=r,r.anEdge=e,r.inside=t.inside;var n=e;do{n.lFace=r,n=n.lNext}while(n!==e)},i.mesh.killEdge_=function(e){var t=e.next,i=e.sym.next;t.sym.next=i,i.sym.next=t},i.mesh.killVertex_=function(e,t){var i=e.anEdge,s=i;do{s.org=t,s=s.oNext}while(s!==i);var r=e.prev,n=e.next;n.prev=r,r.next=n},i.mesh.killFace_=function(e,t){var i=e.anEdge,s=i;do{s.lFace=t,s=s.lNext}while(s!==i);var r=e.prev,n=e.next;n.prev=r,r.next=n},i.normal={},i.normal.S_UNIT_X_=1,i.normal.S_UNIT_Y_=0,i.normal.projectPolygon=function(e,t,s,r){var n=!1,o=[t,s,r];0===t&&0===s&&0===r&&(i.normal.computeNormal_(e,o),n=!0);var l,a=i.normal.longAxis_(o),h=e.mesh.vHead;if(i.TRUE_PROJECT){i.normal.normalize_(o);var u=[0,0,0],c=[0,0,0];u[a]=0,u[(a+1)%3]=i.normal.S_UNIT_X_,u[(a+2)%3]=i.normal.S_UNIT_Y_;var x=i.normal.dot_(u,o);for(u[0]-=x*o[0],u[1]-=x*o[1],u[2]-=x*o[2],i.normal.normalize_(u),c[0]=o[1]*u[2]-o[2]*u[1],c[1]=o[2]*u[0]-o[0]*u[2],c[2]=o[0]*u[1]-o[1]*u[0],i.normal.normalize_(c),l=h.next;l!==h;l=l.next)l.s=i.normal.dot_(l.coords,u),l.t=i.normal.dot_(l.coords,c)}else{var d=(a+1)%3,g=(a+2)%3,_=o[a]>0?1:-1;for(l=h.next;l!==h;l=l.next)l.s=l.coords[d],l.t=_*l.coords[g]}n&&i.normal.checkOrientation_(e)},i.normal.dot_=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},i.normal.normalize_=function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];i.assert(t>0),t=Math.sqrt(t),e[0]/=t,e[1]/=t,e[2]/=t},i.normal.longAxis_=function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},i.normal.computeNormal_=function(e,t){var s,r=[-2*i.GLU_TESS_MAX_COORD,-2*i.GLU_TESS_MAX_COORD,-2*i.GLU_TESS_MAX_COORD],n=[2*i.GLU_TESS_MAX_COORD,2*i.GLU_TESS_MAX_COORD,2*i.GLU_TESS_MAX_COORD],o=[],l=[],a=e.mesh.vHead;for(s=a.next;s!==a;s=s.next)for(var h=0;h<3;++h){var u=s.coords[h];u<n[h]&&(n[h]=u,l[h]=s),u>r[h]&&(r[h]=u,o[h]=s)}var c=0;if(r[1]-n[1]>r[0]-n[0]&&(c=1),r[2]-n[2]>r[c]-n[c]&&(c=2),n[c]>=r[c])return t[0]=0,t[1]=0,void(t[2]=1);var x=0,d=l[c],g=o[c],_=[0,0,0],p=[d.coords[0]-g.coords[0],d.coords[1]-g.coords[1],d.coords[2]-g.coords[2]],y=[0,0,0];for(s=a.next;s!==a;s=s.next){y[0]=s.coords[0]-g.coords[0],y[1]=s.coords[1]-g.coords[1],y[2]=s.coords[2]-g.coords[2],_[0]=p[1]*y[2]-p[2]*y[1],_[1]=p[2]*y[0]-p[0]*y[2],_[2]=p[0]*y[1]-p[1]*y[0];var m=_[0]*_[0]+_[1]*_[1]+_[2]*_[2];m>x&&(x=m,t[0]=_[0],t[1]=_[1],t[2]=_[2])}x<=0&&(t[0]=t[1]=t[2]=0,t[i.normal.longAxis_(p)]=1)},i.normal.checkOrientation_=function(e){for(var t=0,i=e.mesh.fHead,s=i.next;s!==i;s=s.next){var r=s.anEdge;if(!(r.winding<=0))do{t+=(r.org.s-r.dst().s)*(r.org.t+r.dst().t),r=r.lNext}while(r!==s.anEdge)}if(t<0)for(var n=e.mesh.vHead,o=n.next;o!==n;o=o.next)o.t=-o.t},i.render={},i.render.renderMesh=function(e,t,s){for(var r=!1,n=-1,o=t.fHead.prev;o!==t.fHead;o=o.prev)if(o.inside){r||(e.callBeginCallback(i.primitiveType.GL_TRIANGLES),r=!0);var l=o.anEdge;i.assert(l.lNext.lNext.lNext===l,"renderMesh called with non-triangulated mesh");do{if(s){var a=l.rFace().inside?0:1;n!==a&&(n=a,e.callEdgeFlagCallback(!!n))}e.callVertexCallback(l.org.data),l=l.lNext}while(l!==o.anEdge)}r&&e.callEndCallback()},i.render.renderBoundary=function(e,t){for(var s=t.fHead.next;s!==t.fHead;s=s.next)if(s.inside){e.callBeginCallback(i.primitiveType.GL_LINE_LOOP);var r=s.anEdge;do{e.callVertexCallback(r.org.data),r=r.lNext}while(r!==s.anEdge);e.callEndCallback()}},i.sweep={},i.sweep.SENTINEL_COORD_=4*i.GLU_TESS_MAX_COORD,i.sweep.TOLERANCE_NONZERO_=!1,i.sweep.computeInterior=function(e){var t;for(e.fatalError=!1,i.sweep.removeDegenerateEdges_(e),i.sweep.initPriorityQ_(e),i.sweep.initEdgeDict_(e);null!==(t=e.pq.extractMin());){for(;;){var s=e.pq.minimum();if(null===s||!i.geom.vertEq(s,t))break;s=e.pq.extractMin(),i.sweep.spliceMergeVertices_(e,t.anEdge,s.anEdge)}i.sweep.sweepEvent_(e,t)}var r=e.dict.getMin().getKey();e.event=r.eUp.org,i.sweep.doneEdgeDict_(e),i.sweep.donePriorityQ_(e),i.sweep.removeDegenerateFaces_(e.mesh),e.mesh.checkMesh()},i.sweep.addWinding_=function(e,t){e.winding+=t.winding,e.sym.winding+=t.sym.winding},i.sweep.edgeLeq_=function(e,t,s){var r=e.event,n=t.eUp,o=s.eUp;return n.dst()===r?o.dst()===r?i.geom.vertLeq(n.org,o.org)?i.geom.edgeSign(o.dst(),n.org,o.org)<=0:i.geom.edgeSign(n.dst(),o.org,n.org)>=0:i.geom.edgeSign(o.dst(),r,o.org)<=0:o.dst()===r?i.geom.edgeSign(n.dst(),r,n.org)>=0:i.geom.edgeEval(n.dst(),r,n.org)>=i.geom.edgeEval(o.dst(),r,o.org)},i.sweep.deleteRegion_=function(e,t){t.fixUpperEdge&&i.assert(0===t.eUp.winding),t.eUp.activeRegion=null,e.dict.deleteNode(t.nodeUp),t.nodeUp=null},i.sweep.fixUpperEdge_=function(e,t){i.assert(e.fixUpperEdge),i.mesh.deleteEdge(e.eUp),e.fixUpperEdge=!1,e.eUp=t,t.activeRegion=e},i.sweep.topLeftRegion_=function(e){var t=e.eUp.org;do{e=e.regionAbove()}while(e.eUp.org===t);if(e.fixUpperEdge){var s=i.mesh.connect(e.regionBelow().eUp.sym,e.eUp.lNext);i.sweep.fixUpperEdge_(e,s),e=e.regionAbove()}return e},i.sweep.topRightRegion_=function(e){var t=e.eUp.dst();do{e=e.regionAbove()}while(e.eUp.dst()===t);return e},i.sweep.addRegionBelow_=function(e,t,s){var r=new i.ActiveRegion;return r.eUp=s,r.nodeUp=e.dict.insertBefore(t.nodeUp,r),s.activeRegion=r,r},i.sweep.isWindingInside_=function(e,t){switch(e.windingRule){case i.windingRule.GLU_TESS_WINDING_ODD:return 0!=(1&t);case i.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==t;case i.windingRule.GLU_TESS_WINDING_POSITIVE:return t>0;case i.windingRule.GLU_TESS_WINDING_NEGATIVE:return t<0;case i.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return t>=2||t<=-2}return i.assert(!1),!1},i.sweep.computeWinding_=function(e,t){t.windingNumber=t.regionAbove().windingNumber+t.eUp.winding,t.inside=i.sweep.isWindingInside_(e,t.windingNumber)},i.sweep.finishRegion_=function(e,t){var s=t.eUp,r=s.lFace;r.inside=t.inside,r.anEdge=s,i.sweep.deleteRegion_(e,t)},i.sweep.finishLeftRegions_=function(e,t,s){for(var r=t,n=t.eUp;r!==s;){r.fixUpperEdge=!1;var o=r.regionBelow(),l=o.eUp;if(l.org!==n.org){if(!o.fixUpperEdge){i.sweep.finishRegion_(e,r);break}l=i.mesh.connect(n.lPrev(),l.sym),i.sweep.fixUpperEdge_(o,l)}n.oNext!==l&&(i.mesh.meshSplice(l.oPrev(),l),i.mesh.meshSplice(n,l)),i.sweep.finishRegion_(e,r),n=o.eUp,r=o}return n},i.sweep.addRightEdges_=function(e,t,s,r,n,o){var l=!0,a=s;do{i.assert(i.geom.vertLeq(a.org,a.dst())),i.sweep.addRegionBelow_(e,t,a.sym),a=a.oNext}while(a!==r);null===n&&(n=t.regionBelow().eUp.rPrev());for(var h,u=t,c=n;(a=(h=u.regionBelow()).eUp.sym).org===c.org;)a.oNext!==c&&(i.mesh.meshSplice(a.oPrev(),a),i.mesh.meshSplice(c.oPrev(),a)),h.windingNumber=u.windingNumber-a.winding,h.inside=i.sweep.isWindingInside_(e,h.windingNumber),u.dirty=!0,!l&&i.sweep.checkForRightSplice_(e,u)&&(i.sweep.addWinding_(a,c),i.sweep.deleteRegion_(e,u),i.mesh.deleteEdge(c)),l=!1,u=h,c=a;u.dirty=!0,i.assert(u.windingNumber-a.winding===h.windingNumber),o&&i.sweep.walkDirtyRegions_(e,u)},i.sweep.callCombine_=function(e,t,s,r,n){var o=[t.coords[0],t.coords[1],t.coords[2]];t.data=null,t.data=e.callCombineCallback(o,s,r),null===t.data&&(n?e.fatalError||(e.callErrorCallback(i.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),e.fatalError=!0):t.data=s[0])},i.sweep.spliceMergeVertices_=function(e,t,s){var r=[null,null,null,null];r[0]=t.org.data,r[1]=s.org.data,i.sweep.callCombine_(e,t.org,r,[.5,.5,0,0],!1),i.mesh.meshSplice(t,s)},i.sweep.vertexWeights_=function(e,t,s,r,n){var o=i.geom.vertL1dist(t,e),l=i.geom.vertL1dist(s,e),a=n,h=n+1;r[a]=.5*l/(o+l),r[h]=.5*o/(o+l),e.coords[0]+=r[a]*t.coords[0]+r[h]*s.coords[0],e.coords[1]+=r[a]*t.coords[1]+r[h]*s.coords[1],e.coords[2]+=r[a]*t.coords[2]+r[h]*s.coords[2]},i.sweep.getIntersectData_=function(e,t,s,r,n,o){var l=[0,0,0,0],a=[s.data,r.data,n.data,o.data];t.coords[0]=t.coords[1]=t.coords[2]=0,i.sweep.vertexWeights_(t,s,r,l,0),i.sweep.vertexWeights_(t,n,o,l,2),i.sweep.callCombine_(e,t,a,l,!0)},i.sweep.checkForRightSplice_=function(e,t){var s=t.regionBelow(),r=t.eUp,n=s.eUp;if(i.geom.vertLeq(r.org,n.org)){if(i.geom.edgeSign(n.dst(),r.org,n.org)>0)return!1;i.geom.vertEq(r.org,n.org)?r.org!==n.org&&(e.pq.remove(r.org.pqHandle),i.sweep.spliceMergeVertices_(e,n.oPrev(),r)):(i.mesh.splitEdge(n.sym),i.mesh.meshSplice(r,n.oPrev()),t.dirty=s.dirty=!0)}else{if(i.geom.edgeSign(r.dst(),n.org,r.org)<0)return!1;t.regionAbove().dirty=t.dirty=!0,i.mesh.splitEdge(r.sym),i.mesh.meshSplice(n.oPrev(),r)}return!0},i.sweep.checkForLeftSplice_=function(e,t){var s,r=t.regionBelow(),n=t.eUp,o=r.eUp;if(i.assert(!i.geom.vertEq(n.dst(),o.dst())),i.geom.vertLeq(n.dst(),o.dst())){if(i.geom.edgeSign(n.dst(),o.dst(),n.org)<0)return!1;t.regionAbove().dirty=t.dirty=!0,s=i.mesh.splitEdge(n),i.mesh.meshSplice(o.sym,s),s.lFace.inside=t.inside}else{if(i.geom.edgeSign(o.dst(),n.dst(),o.org)>0)return!1;t.dirty=r.dirty=!0,s=i.mesh.splitEdge(o),i.mesh.meshSplice(n.lNext,o.sym),s.rFace().inside=t.inside}return!0},i.sweep.checkForIntersect_=function(e,t){var s=t.regionBelow(),r=t.eUp,n=s.eUp,o=r.org,l=n.org,a=r.dst(),h=n.dst(),u=new i.GluVertex;if(i.assert(!i.geom.vertEq(h,a)),i.assert(i.geom.edgeSign(a,e.event,o)<=0),i.assert(i.geom.edgeSign(h,e.event,l)>=0),i.assert(o!==e.event&&l!==e.event),i.assert(!t.fixUpperEdge&&!s.fixUpperEdge),o===l)return!1;if(Math.min(o.t,a.t)>Math.max(l.t,h.t))return!1;if(i.geom.vertLeq(o,l)){if(i.geom.edgeSign(h,o,l)>0)return!1}else if(i.geom.edgeSign(a,l,o)<0)return!1;i.geom.edgeIntersect(a,o,h,l,u),i.assert(Math.min(o.t,a.t)<=u.t),i.assert(u.t<=Math.max(l.t,h.t)),i.assert(Math.min(h.s,a.s)<=u.s),i.assert(u.s<=Math.max(l.s,o.s)),i.geom.vertLeq(u,e.event)&&(u.s=e.event.s,u.t=e.event.t);var c=i.geom.vertLeq(o,l)?o:l;if(i.geom.vertLeq(c,u)&&(u.s=c.s,u.t=c.t),i.geom.vertEq(u,o)||i.geom.vertEq(u,l))return i.sweep.checkForRightSplice_(e,t),!1;if(!i.geom.vertEq(a,e.event)&&i.geom.edgeSign(a,e.event,u)>=0||!i.geom.vertEq(h,e.event)&&i.geom.edgeSign(h,e.event,u)<=0){if(h===e.event)return i.mesh.splitEdge(r.sym),i.mesh.meshSplice(n.sym,r),r=(t=i.sweep.topLeftRegion_(t)).regionBelow().eUp,i.sweep.finishLeftRegions_(e,t.regionBelow(),s),i.sweep.addRightEdges_(e,t,r.oPrev(),r,r,!0),!0;if(a===e.event){i.mesh.splitEdge(n.sym),i.mesh.meshSplice(r.lNext,n.oPrev()),s=t;var x=(t=i.sweep.topRightRegion_(t)).regionBelow().eUp.rPrev();return s.eUp=n.oPrev(),n=i.sweep.finishLeftRegions_(e,s,null),i.sweep.addRightEdges_(e,t,n.oNext,r.rPrev(),x,!0),!0}return i.geom.edgeSign(a,e.event,u)>=0&&(t.regionAbove().dirty=t.dirty=!0,i.mesh.splitEdge(r.sym),r.org.s=e.event.s,r.org.t=e.event.t),i.geom.edgeSign(h,e.event,u)<=0&&(t.dirty=s.dirty=!0,i.mesh.splitEdge(n.sym),n.org.s=e.event.s,n.org.t=e.event.t),!1}return i.mesh.splitEdge(r.sym),i.mesh.splitEdge(n.sym),i.mesh.meshSplice(n.oPrev(),r),r.org.s=u.s,r.org.t=u.t,r.org.pqHandle=e.pq.insert(r.org),i.sweep.getIntersectData_(e,r.org,o,a,l,h),t.regionAbove().dirty=t.dirty=s.dirty=!0,!1},i.sweep.walkDirtyRegions_=function(e,t){for(var s=t.regionBelow();;){for(;s.dirty;)t=s,s=s.regionBelow();if(!t.dirty&&(s=t,null===(t=t.regionAbove())||!t.dirty))return;t.dirty=!1;var r=t.eUp,n=s.eUp;if(r.dst()!==n.dst()&&i.sweep.checkForLeftSplice_(e,t)&&(s.fixUpperEdge?(i.sweep.deleteRegion_(e,s),i.mesh.deleteEdge(n),n=(s=t.regionBelow()).eUp):t.fixUpperEdge&&(i.sweep.deleteRegion_(e,t),i.mesh.deleteEdge(r),r=(t=s.regionAbove()).eUp)),r.org!==n.org)if(r.dst()===n.dst()||t.fixUpperEdge||s.fixUpperEdge||r.dst()!==e.event&&n.dst()!==e.event)i.sweep.checkForRightSplice_(e,t);else if(i.sweep.checkForIntersect_(e,t))return;r.org===n.org&&r.dst()===n.dst()&&(i.sweep.addWinding_(n,r),i.sweep.deleteRegion_(e,t),i.mesh.deleteEdge(r),t=s.regionAbove())}},i.sweep.connectRightVertex_=function(e,t,s){var r,n=s.oNext,o=t.regionBelow(),l=t.eUp,a=o.eUp,h=!1;l.dst()!==a.dst()&&i.sweep.checkForIntersect_(e,t),i.geom.vertEq(l.org,e.event)&&(i.mesh.meshSplice(n.oPrev(),l),n=(t=i.sweep.topLeftRegion_(t)).regionBelow().eUp,i.sweep.finishLeftRegions_(e,t.regionBelow(),o),h=!0),i.geom.vertEq(a.org,e.event)&&(i.mesh.meshSplice(s,a.oPrev()),s=i.sweep.finishLeftRegions_(e,o,null),h=!0),h?i.sweep.addRightEdges_(e,t,s.oNext,n,n,!0):(r=i.geom.vertLeq(a.org,l.org)?a.oPrev():l,r=i.mesh.connect(s.lPrev(),r),i.sweep.addRightEdges_(e,t,r,r.oNext,r.oNext,!1),r.sym.activeRegion.fixUpperEdge=!0,i.sweep.walkDirtyRegions_(e,t))},i.sweep.connectLeftDegenerate_=function(e,t,s){var r=t.eUp;if(i.geom.vertEq(r.org,s))return i.assert(i.sweep.TOLERANCE_NONZERO_),void(i.sweep.TOLERANCE_NONZERO_&&i.sweep.spliceMergeVertices_(e,r,s.anEdge));if(!i.geom.vertEq(r.dst(),s))return i.mesh.splitEdge(r.sym),t.fixUpperEdge&&(i.mesh.deleteEdge(r.oNext),t.fixUpperEdge=!1),i.mesh.meshSplice(s.anEdge,r),void i.sweep.sweepEvent_(e,s);if(i.assert(i.sweep.TOLERANCE_NONZERO_),i.sweep.TOLERANCE_NONZERO_){var n=(t=i.sweep.topRightRegion_(t)).regionBelow(),o=n.eUp.sym,l=o.oNext,a=l;n.fixUpperEdge&&(i.assert(l!==o),i.sweep.deleteRegion_(e,n),i.mesh.deleteEdge(o),o=l.oPrev()),i.mesh.meshSplice(s.anEdge,o),i.geom.edgeGoesLeft(l)||(l=null),i.sweep.addRightEdges_(e,t,o.oNext,a,l,!0)}},i.sweep.connectLeftVertex_=function(e,t){var s=new i.ActiveRegion;s.eUp=t.anEdge.sym;var r=e.dict.search(s).getKey(),n=r.regionBelow(),o=r.eUp,l=n.eUp;if(0!==i.geom.edgeSign(o.dst(),t,o.org)){var a,h=i.geom.vertLeq(l.dst(),o.dst())?r:n;r.inside||h.fixUpperEdge?(a=h===r?i.mesh.connect(t.anEdge.sym,o.lNext):i.mesh.connect(l.dNext(),t.anEdge).sym,h.fixUpperEdge?i.sweep.fixUpperEdge_(h,a):i.sweep.computeWinding_(e,i.sweep.addRegionBelow_(e,r,a)),i.sweep.sweepEvent_(e,t)):i.sweep.addRightEdges_(e,r,t.anEdge,t.anEdge,null,!0)}else i.sweep.connectLeftDegenerate_(e,r,t)},i.sweep.sweepEvent_=function(e,t){e.event=t;for(var s=t.anEdge;null===s.activeRegion;)if((s=s.oNext)===t.anEdge)return void i.sweep.connectLeftVertex_(e,t);var r=i.sweep.topLeftRegion_(s.activeRegion),n=r.regionBelow(),o=n.eUp,l=i.sweep.finishLeftRegions_(e,n,null);l.oNext===o?i.sweep.connectRightVertex_(e,r,l):i.sweep.addRightEdges_(e,r,l.oNext,o,o,!0)},i.sweep.addSentinel_=function(e,t){var s=new i.ActiveRegion,r=i.mesh.makeEdge(e.mesh);r.org.s=i.sweep.SENTINEL_COORD_,r.org.t=t,r.dst().s=-i.sweep.SENTINEL_COORD_,r.dst().t=t,e.event=r.dst(),s.eUp=r,s.windingNumber=0,s.inside=!1,s.fixUpperEdge=!1,s.sentinel=!0,s.dirty=!1,s.nodeUp=e.dict.insert(s)},i.sweep.initEdgeDict_=function(e){e.dict=new i.Dict(e,i.sweep.edgeLeq_),i.sweep.addSentinel_(e,-i.sweep.SENTINEL_COORD_),i.sweep.addSentinel_(e,i.sweep.SENTINEL_COORD_)},i.sweep.doneEdgeDict_=function(e){for(var t,s=0;null!==(t=e.dict.getMin().getKey());)t.sentinel||(i.assert(t.fixUpperEdge),i.assert(1==++s)),i.assert(0===t.windingNumber),i.sweep.deleteRegion_(e,t);e.dict=null},i.sweep.removeDegenerateEdges_=function(e){for(var t,s=e.mesh.eHead,r=s.next;r!==s;r=t){t=r.next;var n=r.lNext;i.geom.vertEq(r.org,r.dst())&&r.lNext.lNext!==r&&(i.sweep.spliceMergeVertices_(e,n,r),i.mesh.deleteEdge(r),n=(r=n).lNext),n.lNext===r&&(n!==r&&(n!==t&&n!==t.sym||(t=t.next),i.mesh.deleteEdge(n)),r!==t&&r!==t.sym||(t=t.next),i.mesh.deleteEdge(r))}},i.sweep.initPriorityQ_=function(e){var t=new i.PriorityQ;e.pq=t;var s,r=e.mesh.vHead;for(s=r.next;s!==r;s=s.next)s.pqHandle=t.insert(s);t.init()},i.sweep.donePriorityQ_=function(e){e.pq.deleteQ(),e.pq=null},i.sweep.removeDegenerateFaces_=function(e){for(var t,s=e.fHead.next;s!==e.fHead;s=t){t=s.next;var r=s.anEdge;i.assert(r.lNext!==r),r.lNext.lNext===r&&(i.sweep.addWinding_(r.oNext,r),i.mesh.deleteEdge(r))}},i.tessmono={},i.tessmono.tessellateMonoRegion_=function(e){var t=e.anEdge;for(i.assert(t.lNext!==t&&t.lNext.lNext!==t);i.geom.vertLeq(t.dst(),t.org);t=t.lPrev());for(;i.geom.vertLeq(t.org,t.dst());t=t.lNext);for(var s,r=t.lPrev();t.lNext!==r;)if(i.geom.vertLeq(t.dst(),r.org)){for(;r.lNext!==t&&(i.geom.edgeGoesLeft(r.lNext)||i.geom.edgeSign(r.org,r.dst(),r.lNext.dst())<=0);)r=(s=i.mesh.connect(r.lNext,r)).sym;r=r.lPrev()}else{for(;r.lNext!==t&&(i.geom.edgeGoesRight(t.lPrev())||i.geom.edgeSign(t.dst(),t.org,t.lPrev().org)>=0);)s=i.mesh.connect(t,t.lPrev()),t=s.sym;t=t.lNext}for(i.assert(r.lNext!==t);r.lNext.lNext!==t;)r=(s=i.mesh.connect(r.lNext,r)).sym},i.tessmono.tessellateInterior=function(e){for(var t,s=e.fHead.next;s!==e.fHead;s=t)t=s.next,s.inside&&i.tessmono.tessellateMonoRegion_(s)},i.tessmono.discardExterior=function(e){for(var t,s=e.fHead.next;s!==e.fHead;s=t)t=s.next,s.inside||i.mesh.zapFace(s)},i.tessmono.setWindingNumber=function(e,t,s){for(var r,n=e.eHead.next;n!==e.eHead;n=r)r=n.next,n.rFace().inside!==n.lFace.inside?n.winding=n.lFace.inside?t:-t:s?i.mesh.deleteEdge(n):n.winding=0},i.Dict=function(e,t){this.head_=new i.DictNode,this.frame_=e,this.leq_=t},i.Dict.prototype.deleteDict_=function(){},i.Dict.prototype.insertBefore=function(e,t){do{e=e.prev}while(null!==e.key&&!this.leq_(this.frame_,e.key,t));var s=new i.DictNode(t,e.next,e);return e.next.prev=s,e.next=s,s},i.Dict.prototype.insert=function(e){return this.insertBefore(this.head_,e)},i.Dict.prototype.deleteNode=function(e){e.next.prev=e.prev,e.prev.next=e.next},i.Dict.prototype.search=function(e){var t=this.head_;do{t=t.next}while(null!==t.key&&!this.leq_(this.frame_,e,t.key));return t},i.Dict.prototype.getMin=function(){return this.head_.next},i.Dict.prototype.getMax=function(){return this.head_.prev},i.DictNode=function(e,t,i){this.key=e||null,this.next=t||this,this.prev=i||this},i.DictNode.prototype.getKey=function(){return this.key},i.DictNode.prototype.getSuccessor=function(){return this.next},i.DictNode.prototype.getPredecessor=function(){return this.prev},i.GluTesselator=function(){this.state_=i.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null,this.errorCallback_=null,this.normal_=[0,0,0],this.windingRule=i.windingRule.GLU_TESS_WINDING_ODD,this.fatalError=!1,this.dict=null,this.pq=null,this.event=null,this.combineCallback_=null,this.boundaryOnly_=!1,this.beginCallback_=null,this.edgeFlagCallback_=null,this.vertexCallback_=null,this.endCallback_=null,this.meshCallback_=null,this.polygonData_=null},i.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2},i.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(i.GluTesselator.tessState_.T_DORMANT)},i.GluTesselator.prototype.gluTessProperty=function(e,t){switch(e){case i.gluEnum.GLU_TESS_TOLERANCE:return;case i.gluEnum.GLU_TESS_WINDING_RULE:var s=t;switch(s){case i.windingRule.GLU_TESS_WINDING_ODD:case i.windingRule.GLU_TESS_WINDING_NONZERO:case i.windingRule.GLU_TESS_WINDING_POSITIVE:case i.windingRule.GLU_TESS_WINDING_NEGATIVE:case i.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return void(this.windingRule=s)}break;case i.gluEnum.GLU_TESS_BOUNDARY_ONLY:return void(this.boundaryOnly_=!!t);default:return void this.callErrorCallback(i.gluEnum.GLU_INVALID_ENUM)}this.callErrorCallback(i.gluEnum.GLU_INVALID_VALUE)},i.GluTesselator.prototype.gluGetTessProperty=function(e){switch(e){case i.gluEnum.GLU_TESS_TOLERANCE:return 0;case i.gluEnum.GLU_TESS_WINDING_RULE:var t=this.windingRule;return i.assert(t===i.windingRule.GLU_TESS_WINDING_ODD||t===i.windingRule.GLU_TESS_WINDING_NONZERO||t===i.windingRule.GLU_TESS_WINDING_POSITIVE||t===i.windingRule.GLU_TESS_WINDING_NEGATIVE||t===i.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO),t;case i.gluEnum.GLU_TESS_BOUNDARY_ONLY:return i.assert(!0===this.boundaryOnly_||!1===this.boundaryOnly_),this.boundaryOnly_;default:this.callErrorCallback(i.gluEnum.GLU_INVALID_ENUM)}return!1},i.GluTesselator.prototype.gluTessNormal=function(e,t,i){this.normal_[0]=e,this.normal_[1]=t,this.normal_[2]=i},i.GluTesselator.prototype.gluTessCallback=function(e,t){var s=t||null;switch(e){case i.gluEnum.GLU_TESS_BEGIN:case i.gluEnum.GLU_TESS_BEGIN_DATA:return void(this.beginCallback_=s);case i.gluEnum.GLU_TESS_EDGE_FLAG:case i.gluEnum.GLU_TESS_EDGE_FLAG_DATA:return void(this.edgeFlagCallback_=s);case i.gluEnum.GLU_TESS_VERTEX:case i.gluEnum.GLU_TESS_VERTEX_DATA:return void(this.vertexCallback_=s);case i.gluEnum.GLU_TESS_END:case i.gluEnum.GLU_TESS_END_DATA:return void(this.endCallback_=s);case i.gluEnum.GLU_TESS_ERROR:case i.gluEnum.GLU_TESS_ERROR_DATA:return void(this.errorCallback_=s);case i.gluEnum.GLU_TESS_COMBINE:case i.gluEnum.GLU_TESS_COMBINE_DATA:return void(this.combineCallback_=s);case i.gluEnum.GLU_TESS_MESH:return void(this.meshCallback_=s);default:return void this.callErrorCallback(i.gluEnum.GLU_INVALID_ENUM)}},i.GluTesselator.prototype.gluTessVertex=function(e,t){var s=!1,r=[0,0,0];this.requireState_(i.GluTesselator.tessState_.T_IN_CONTOUR);for(var n=0;n<3;++n){var o=e[n];o<-i.GLU_TESS_MAX_COORD&&(o=-i.GLU_TESS_MAX_COORD,s=!0),o>i.GLU_TESS_MAX_COORD&&(o=i.GLU_TESS_MAX_COORD,s=!0),r[n]=o}s&&this.callErrorCallback(i.errorType.GLU_TESS_COORD_TOO_LARGE),this.addVertex_(r,t)},i.GluTesselator.prototype.gluTessBeginPolygon=function(e){this.requireState_(i.GluTesselator.tessState_.T_DORMANT),this.state_=i.GluTesselator.tessState_.T_IN_POLYGON,this.mesh=new i.GluMesh,this.polygonData_=e},i.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(i.GluTesselator.tessState_.T_IN_POLYGON),this.state_=i.GluTesselator.tessState_.T_IN_CONTOUR,this.lastEdge_=null},i.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(i.GluTesselator.tessState_.T_IN_CONTOUR),this.state_=i.GluTesselator.tessState_.T_IN_POLYGON},i.GluTesselator.prototype.gluTessEndPolygon=function(){if(this.requireState_(i.GluTesselator.tessState_.T_IN_POLYGON),this.state_=i.GluTesselator.tessState_.T_DORMANT,i.normal.projectPolygon(this,this.normal_[0],this.normal_[1],this.normal_[2]),i.sweep.computeInterior(this),!this.fatalError){var e=this.mesh;if(this.boundaryOnly_?i.tessmono.setWindingNumber(e,1,!0):i.tessmono.tessellateInterior(e),this.mesh.checkMesh(),this.beginCallback_||this.endCallback_||this.vertexCallback_||this.edgeFlagCallback_)if(this.boundaryOnly_)i.render.renderBoundary(this,this.mesh);else{var t=!!this.edgeFlagCallback_;i.render.renderMesh(this,this.mesh,t)}if(this.meshCallback_)return i.tessmono.discardExterior(this.mesh),this.meshCallback_(this.mesh),this.mesh=null,void(this.polygonData_=null)}i.mesh.deleteMesh(this.mesh),this.polygonData_=null,this.mesh=null},i.GluTesselator.prototype.requireState_=function(e){this.state_!==e&&this.gotoState_(e)},i.GluTesselator.prototype.gotoState_=function(e){for(;this.state_!==e;)if(this.state_<e)switch(this.state_){case i.GluTesselator.tessState_.T_DORMANT:this.callErrorCallback(i.errorType.GLU_TESS_MISSING_BEGIN_POLYGON),this.gluTessBeginPolygon(null);break;case i.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(i.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state_){case i.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorCallback(i.errorType.GLU_TESS_MISSING_END_CONTOUR),this.gluTessEndContour();break;case i.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(i.errorType.GLU_TESS_MISSING_END_POLYGON),this.gluTessEndPolygon()}},i.GluTesselator.prototype.addVertex_=function(e,t){var s=this.lastEdge_;null===s?(s=i.mesh.makeEdge(this.mesh),i.mesh.meshSplice(s,s.sym)):(i.mesh.splitEdge(s),s=s.lNext),s.org.data=t,s.org.coords[0]=e[0],s.org.coords[1]=e[1],s.org.coords[2]=e[2],s.winding=1,s.sym.winding=-1,this.lastEdge_=s},i.GluTesselator.prototype.callBeginCallback=function(e){this.beginCallback_&&this.beginCallback_(e,this.polygonData_)},i.GluTesselator.prototype.callVertexCallback=function(e){this.vertexCallback_&&this.vertexCallback_(e,this.polygonData_)},i.GluTesselator.prototype.callEdgeFlagCallback=function(e){this.edgeFlagCallback_&&this.edgeFlagCallback_(e,this.polygonData_)},i.GluTesselator.prototype.callEndCallback=function(){this.endCallback_&&this.endCallback_(this.polygonData_)},i.GluTesselator.prototype.callCombineCallback=function(e,t,i){return this.combineCallback_&&this.combineCallback_(e,t,i,this.polygonData_)||null},i.GluTesselator.prototype.callErrorCallback=function(e){this.errorCallback_&&this.errorCallback_(e,this.polygonData_)},i.GluFace=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.inside=!1},i.GluHalfEdge=function(e){this.next=e||this,this.sym=null,this.oNext=null,this.lNext=null,this.org=null,this.lFace=null,this.activeRegion=null,this.winding=0},i.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace},i.GluHalfEdge.prototype.dst=function(){return this.sym.org},i.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext},i.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym},i.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym},i.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext},i.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym},i.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym},i.GluMesh=function(){this.vHead=new i.GluVertex,this.fHead=new i.GluFace,this.eHead=new i.GluHalfEdge,this.eHeadSym=new i.GluHalfEdge,this.eHead.sym=this.eHeadSym,this.eHeadSym.sym=this.eHead},i.GluMesh.prototype.checkMesh=function(){if(i.DEBUG){var e,t,s,r=this.fHead,n=this.vHead,o=this.eHead,l=r;for(l=r;(t=l.next)!==r;l=t){i.assert(t.prev===l),e=t.anEdge;do{i.assert(e.sym!==e),i.assert(e.sym.sym===e),i.assert(e.lNext.oNext.sym===e),i.assert(e.oNext.sym.lNext===e),i.assert(e.lFace===t),e=e.lNext}while(e!==t.anEdge)}i.assert(t.prev===l&&null===t.anEdge);var a=n;for(a=n;(s=a.next)!==n;a=s){i.assert(s.prev===a),e=s.anEdge;do{i.assert(e.sym!==e),i.assert(e.sym.sym===e),i.assert(e.lNext.oNext.sym===e),i.assert(e.oNext.sym.lNext===e),i.assert(e.org===s),e=e.oNext}while(e!==s.anEdge)}i.assert(s.prev===a&&null===s.anEdge&&null===s.data);var h=o;for(h=o;(e=h.next)!==o;h=e)i.assert(e.sym.next===h.sym),i.assert(e.sym!==e),i.assert(e.sym.sym===e),i.assert(null!==e.org),i.assert(null!==e.dst()),i.assert(e.lNext.oNext.sym===e),i.assert(e.oNext.sym.lNext===e);i.assert(e.sym.next===h.sym&&e.sym===this.eHeadSym&&e.sym.sym===e&&null===e.org&&null===e.dst()&&null===e.lFace&&null===e.rFace())}},i.GluVertex=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0},i.PriorityQ=function(){this.verts_=[],this.order_=null,this.size_=0,this.initialized_=!1,this.heap_=new i.PriorityQHeap},i.PriorityQ.prototype.deleteQ=function(){this.heap_=null,this.order_=null,this.verts_=null},i.PriorityQ.prototype.init=function(){this.order_=[];for(var e=0;e<this.size_;e++)this.order_[e]=e;var t,s=(t=this.verts_,function(e,s){return i.geom.vertLeq(t[e],t[s])?1:-1});if(this.order_.sort(s),this.initialized_=!0,this.heap_.init(),i.DEBUG){var r=0+this.size_-1;for(e=0;e<r;++e)i.assert(i.geom.vertLeq(this.verts_[this.order_[e+1]],this.verts_[this.order_[e]]))}},i.PriorityQ.prototype.insert=function(e){if(this.initialized_)return this.heap_.insert(e);var t=this.size_++;return this.verts_[t]=e,-(t+1)},i.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();var e=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var t=this.heap_.minimum();if(i.geom.vertLeq(t,e))return this.heap_.extractMin()}do{--this.size_}while(this.size_>0&&null===this.verts_[this.order_[this.size_-1]]);return e},i.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var e=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var t=this.heap_.minimum();if(i.geom.vertLeq(t,e))return t}return e},i.PriorityQ.prototype.remove=function(e){if(e>=0)this.heap_.remove(e);else for(e=-(e+1),i.assert(e<this.verts_.length&&null!==this.verts_[e]),this.verts_[e]=null;this.size_>0&&null===this.verts_[this.order_[this.size_-1]];)--this.size_},i.PriorityQHeap=function(){this.heap_=i.PriorityQHeap.reallocNumeric_([0],i.PriorityQHeap.INIT_SIZE_+1),this.verts_=[null,null],this.handles_=[0,0],this.size_=0,this.max_=i.PriorityQHeap.INIT_SIZE_,this.freeList_=0,this.initialized_=!1,this.heap_[1]=1},i.PriorityQHeap.INIT_SIZE_=32,i.PriorityQHeap.reallocNumeric_=function(e,t){for(var i=new Array(t),s=0;s<e.length;s++)i[s]=e[s];for(;s<t;s++)i[s]=0;return i},i.PriorityQHeap.prototype.init=function(){for(var e=this.size_;e>=1;--e)this.floatDown_(e);this.initialized_=!0},i.PriorityQHeap.prototype.insert=function(e){var t,s=++this.size_;return 2*s>this.max_&&(this.max_*=2,this.handles_=i.PriorityQHeap.reallocNumeric_(this.handles_,this.max_+1)),0===this.freeList_?t=s:(t=this.freeList_,this.freeList_=this.handles_[this.freeList_]),this.verts_[t]=e,this.handles_[t]=s,this.heap_[s]=t,this.initialized_&&this.floatUp_(s),t},i.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_},i.PriorityQHeap.prototype.minimum=function(){return this.verts_[this.heap_[1]]},i.PriorityQHeap.prototype.extractMin=function(){var e=this.heap_,t=this.verts_,i=this.handles_,s=e[1],r=t[s];return this.size_>0&&(e[1]=e[this.size_],i[e[1]]=1,t[s]=null,i[s]=this.freeList_,this.freeList_=s,--this.size_>0&&this.floatDown_(1)),r},i.PriorityQHeap.prototype.remove=function(e){var t=this.heap_,s=this.verts_,r=this.handles_;i.assert(e>=1&&e<=this.max_&&null!==s[e]);var n=r[e];if(t[n]=t[this.size_],r[t[n]]=n,n<=--this.size_)if(n<=1)this.floatDown_(n);else{var o=s[t[n]],l=s[t[n>>1]];i.geom.vertLeq(l,o)?this.floatDown_(n):this.floatUp_(n)}s[e]=null,r[e]=this.freeList_,this.freeList_=e},i.PriorityQHeap.prototype.floatDown_=function(e){for(var t=this.heap_,s=this.verts_,r=this.handles_,n=e,o=t[n];;){var l=n<<1;l<this.size_&&i.geom.vertLeq(s[t[l+1]],s[t[l]])&&(l+=1),i.assert(l<=this.max_);var a=t[l];if(l>this.size_||i.geom.vertLeq(s[o],s[a]))return t[n]=o,void(r[o]=n);t[n]=a,r[a]=n,n=l}},i.PriorityQHeap.prototype.floatUp_=function(e){for(var t=this.heap_,s=this.verts_,r=this.handles_,n=e,o=t[n];;){var l=n>>1,a=t[l];if(0===l||i.geom.vertLeq(s[a],s[o]))return t[n]=o,void(r[o]=n);t[n]=a,r[a]=n,n=l}},i.ActiveRegion=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},i.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()},i.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()},t=i)&&(e.exports=t)}));const u=i.getLogger("esri.views.2d.engine.webgl.mesh.templates.Tesselator");class c{constructor(){this._currentVertexIndex=0,this._indexCounter=0,this._triangleIndices=[-1,-1,-1],this.glu=new h.GluTesselator,this.glu.gluTessCallback(h.gluEnum.GLU_TESS_BEGIN,this._begincallback.bind(this)),this.glu.gluTessCallback(h.gluEnum.GLU_TESS_VERTEX_DATA,this._vertexCallback.bind(this)),this.glu.gluTessCallback(h.gluEnum.GLU_TESS_END,this._endcallback.bind(this)),this.glu.gluTessCallback(h.gluEnum.GLU_TESS_COMBINE,this._combinecallback.bind(this)),this.glu.gluTessCallback(h.gluEnum.GLU_TESS_ERROR,this._errorcallback.bind(this)),this.glu.gluTessCallback(h.gluEnum.GLU_TESS_EDGE_FLAG,this._edgeCallback.bind(this)),this.glu.gluTessProperty(h.gluEnum.GLU_TESS_WINDING_RULE,h.windingRule.GLU_TESS_WINDING_ODD)}beginPolygon(e,t){this._triangleIndices[0]=-1,this._triangleIndices[1]=-1,this._triangleIndices[2]=-1,this._currentVertexIndex=0,this._indexCounter=0,this.glu.gluTessBeginPolygon(e),this._indices=t}endPolygon(){this.glu.gluTessEndPolygon()}beginContour(){this.glu.gluTessBeginContour()}endContour(){this.glu.gluTessEndContour()}addVertex(e,t){this.glu.gluTessVertex(e,t)}_vertexCallback(e,t){if(t[t.length]=e[0],t[t.length]=e[1],this._triangleIndices[this._currentVertexIndex]=-1,this._currentVertexIndex>=2){for(let e=0;e<3;e++)-1===this._triangleIndices[e]&&(this._triangleIndices[e]=this._indexCounter++),this._indices[this._indices.length]=this._triangleIndices[e];this._currentVertexIndex=0}else this._currentVertexIndex++}_begincallback(){this._triangleIndices[0]=-1,this._triangleIndices[1]=-1,this._triangleIndices[2]=-1,this._currentVertexIndex=0}_endcallback(){this._currentVertexIndex=0}_errorcallback(e){u.error(`Encountered error during tesselation: ${e}`)}_combinecallback(e){return[e[0],e[1],e[2]]}_edgeCallback(){}}function x(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function d(e,t){return Math.sqrt(e*e+t*t)}function g(e){const t=d(e[0],e[1]);e[0]/=t,e[1]/=t}function _(e,t){return d(e[0]-t[0],e[1]-t[1])}function p(e){return"function"==typeof e}function y(e){return 1/Math.max(e,1)}function m(e,t,i){N.trackDistance=null!=t.trackDistance&&t.trackDistance,N.wrapDistance=null!=t.wrapDistance?t.wrapDistance:65535,N.thin=null!=t.thin&&t.thin,N.initialDistance=null!=t.initialDistance?t.initialDistance:0,N.enableOuterBisectorSplit=null!=t.enableOuterBisectorSplit&&t.enableOuterBisectorSplit,N.outerBisectorAutoSplitThreshold=null!=t.outerBisectorAutoSplitThreshold?t.outerBisectorAutoSplitThreshold:0,N.enableInnerBisectorSplit=null!=t.enableOuterBisectorSplit&&t.enableOuterBisectorSplit,N.innerBisectorAutoSplitThreshold=null!=t.innerBisectorAutoSplitThreshold?t.innerBisectorAutoSplitThreshold:0,v=e,S=i,w=0,b=0,T=0,L=!1,G=null,I=null,U.currentVertex.x=null,U.currentVertex.y=null,U.distance=N.initialDistance;const s=v[0],r=v[v.length-1];U.canSplit=!1,U.closed=s.x===r.x&&s.y===r.y,v.length<2||2===v.length&&U.closed||(N.thin?N.trackDistance?function(){for(O(),V(),C(1);b-T>N.wrapDistance||w<v.length;)O(),V(),C(2),S.bridge(U),U.leftExit0=U.rightExit0,U.leftExit2=U.rightExit2}():function(){for(;w<v.length;){if(w>0&&(U.inbound.x=U.outbound.x,U.inbound.y=U.outbound.y),w<v.length-1){U.outbound.x=v[w+1].x-v[w].x,U.outbound.y=v[w+1].y-v[w].y;const e=Math.sqrt(U.outbound.x*U.outbound.x+U.outbound.y*U.outbound.y);U.distance+=e,U.outbound.x/=e,U.outbound.y/=e}else U.outbound.x=U.inbound.x,U.outbound.y=U.inbound.y;0===w&&(U.inbound.x=U.outbound.x,U.inbound.y=U.outbound.y),U.currentVertex.x=v[w].x,U.currentVertex.y=v[w].y,U.prevNormal.x=-U.inbound.y,U.prevNormal.y=U.inbound.x,U.nextNormal.x=-U.outbound.y,U.nextNormal.y=U.outbound.x,0===w?(S.vertex(U),U.leftEntry0=U.entry0,U.leftEntry2=U.entry2,U.leftExit0=U.exit0,U.leftExit2=U.exit2):(S.vertex(U),U.rightEntry0=U.entry0,U.rightEntry2=U.entry2,U.rightExit0=U.exit0,U.rightExit2=U.exit2,S.bridge(U),U.leftExit0=U.rightExit0,U.leftExit2=U.rightExit2),++w}}():N.enableOuterBisectorSplit||N.outerBisectorAutoSplitThreshold>0||N.enableInnerBisectorSplit||N.innerBisectorAutoSplitThreshold>0?(U.canSplit=!0,function(){for(O(),R(),U.splitInner=U.gapInner=U.splitOuter=U.gapOuter=!1,D(1),U.closure0=U.leftEntry0,U.closure1=U.leftEntry1,U.closure2=U.leftEntry2;b-T>N.wrapDistance||w<v.length-1||w<v.length&&(!U.closed||N.trackDistance);)O(),R(),U.splitInner=U.gapInner=U.splitOuter=U.gapOuter=!1,D(2),S.bridge(U),U.leftExit0=U.rightExit0,U.leftExit1=U.rightExit1,U.leftExit2=U.rightExit2;U.closed&&!N.trackDistance&&(U.rightEntry0=U.closure0,U.rightEntry1=U.closure1,U.rightEntry2=U.closure2,S.bridge(U),U.leftExit0=U.rightExit0,U.leftExit1=U.rightExit1,U.leftExit2=U.rightExit2)}()):function(){for(O(),R(),D(1),U.closure0=U.leftEntry0,U.closure1=U.leftEntry1,U.closure2=U.leftEntry2;b-T>N.wrapDistance||w<v.length-1||w<v.length&&(!U.closed||N.trackDistance);)O(),R(),D(2),S.bridge(U),U.leftExit0=U.rightExit0,U.leftExit1=U.rightExit1,U.leftExit2=U.rightExit2;U.closed&&!N.trackDistance&&(U.rightEntry0=U.closure0,U.rightEntry1=U.closure1,U.rightEntry2=U.closure2,S.bridge(U),U.leftExit0=U.rightExit0,U.leftExit1=U.rightExit1,U.leftExit2=U.rightExit2)}())}function E(){v=null,S=null}function f(){if(U.cosine<N.innerBisectorAutoSplitThreshold){U.splitInner=!0,U.gapInner=!0;const e=Math.max(N.innerBisectorAutoSplitThreshold,U.cosine),t=Math.sqrt(1-e*e)/e;U.leftInner.x=U.nextNormal.x+U.sign*t*U.outbound.x,U.leftInner.y=U.nextNormal.y+U.sign*t*U.outbound.y,U.rightInner.x=U.prevNormal.x-U.sign*t*U.inbound.x,U.rightInner.y=U.prevNormal.y-U.sign*t*U.inbound.y}else N.enableInnerBisectorSplit&&(U.splitInner=!0,U.gapInner=!1,U.leftInner.x=U.rightInner.x=U.bisector.x/U.cosine,U.leftInner.y=U.rightInner.y=U.bisector.y/U.cosine);if(U.cosine<N.outerBisectorAutoSplitThreshold){U.splitOuter=!0,U.gapOuter=!0;const e=Math.max(N.outerBisectorAutoSplitThreshold,U.cosine),t=Math.sqrt(1-e*e)/e;U.leftOuter.x=U.prevNormal.x-U.sign*t*U.inbound.x,U.leftOuter.y=U.prevNormal.y-U.sign*t*U.inbound.y,U.rightOuter.x=U.nextNormal.x+U.sign*t*U.outbound.x,U.rightOuter.y=U.nextNormal.y+U.sign*t*U.outbound.y}else N.enableOuterBisectorSplit&&(U.splitOuter=!0,U.gapOuter=!1,U.leftOuter.x=U.rightOuter.x=U.bisector.x/U.cosine,U.leftOuter.y=U.rightOuter.y=U.bisector.y/U.cosine)}let v;const N={};let S,w,b,T,L,G,I;const U=new class{constructor(){this.closed=void 0,this.isFirstVertex=void 0,this.isLastVertex=void 0,this.isCap=void 0,this.currentVertex={x:void 0,y:void 0},this.inbound={x:void 0,y:void 0},this.outbound={x:void 0,y:void 0},this.prevNormal={x:void 0,y:void 0},this.nextNormal={x:void 0,y:void 0},this.bisector={x:void 0,y:void 0},this.leftInner={x:void 0,y:void 0},this.rightInner={x:void 0,y:void 0},this.leftOuter={x:void 0,y:void 0},this.rightOuter={x:void 0,y:void 0}}};function O(){if(L)return U.distance=0,U.isCap=U.isFirstVertex=U.isLastVertex=!1,void(L=!1);if(0===b)if(U.isFirstVertex=0===w,I=v[w],0===w){if(b=0,U.closed){U.inbound.x=I.x-v[v.length-2].x,U.inbound.y=I.y-v[v.length-2].y;const e=Math.sqrt(U.inbound.x*U.inbound.x+U.inbound.y*U.inbound.y);U.inbound.x/=e,U.inbound.y/=e}}else U.inbound.x=I.x-G.x,U.inbound.y=I.y-G.y,b=Math.sqrt(U.inbound.x*U.inbound.x+U.inbound.y*U.inbound.y),U.inbound.x/=b,U.inbound.y/=b;if(U.distance+b-T<=N.wrapDistance){if(w<v.length-1){U.outbound.x=v[w+1].x-I.x,U.outbound.y=v[w+1].y-I.y;const e=Math.sqrt(U.outbound.x*U.outbound.x+U.outbound.y*U.outbound.y);U.outbound.x/=e,U.outbound.y/=e}else if(U.closed){U.outbound.x=v[1].x-I.x,U.outbound.y=v[1].y-I.y;const e=Math.sqrt(U.outbound.x*U.outbound.x+U.outbound.y*U.outbound.y);U.outbound.x/=e,U.outbound.y/=e}else U.outbound.x=U.inbound.x,U.outbound.y=U.inbound.y;return 0!==w||U.closed||(U.inbound.x=U.outbound.x,U.inbound.y=U.outbound.y),++w,U.isLastVertex=w===v.length,U.isCap=!U.closed&&(U.isFirstVertex||U.isLastVertex),U.distance+=b-T,b=0,T=0,L=U.distance+b-T===N.wrapDistance,U.currentVertex.x=I.x,U.currentVertex.y=I.y,G=I,void(I=null)}U.outbound.x=U.inbound.x,U.outbound.y=U.inbound.y,T+=N.wrapDistance-U.distance,U.distance=N.wrapDistance,L=!0;const e=T/b;U.currentVertex.x=(1-e)*G.x+e*I.x,U.currentVertex.y=(1-e)*G.y+e*I.y}function V(){U.prevNormal.x=-U.inbound.y,U.prevNormal.y=U.inbound.x,U.nextNormal.x=-U.outbound.y,U.nextNormal.y=U.outbound.x}function R(){V(),U.bisector.x=U.prevNormal.x+U.nextNormal.x,U.bisector.y=U.prevNormal.y+U.nextNormal.y;const e=Math.sqrt(U.bisector.x*U.bisector.x+U.bisector.y*U.bisector.y);if(e<.001)return U.bisector.x=void 0,U.bisector.y=void 0,U.cosine=0,void(U.sign=void 0);U.bisector.x/=e,U.bisector.y/=e,U.cosine=U.bisector.x*U.nextNormal.x+U.bisector.y*U.nextNormal.y,U.sign=U.prevNormal.x*U.nextNormal.y-U.prevNormal.y*U.nextNormal.x>=0?1:-1}function D(e){S.vertex(U),1===e?(U.leftEntry0=U.entry0,U.leftEntry1=U.entry1,U.leftEntry2=U.entry2,U.leftExit0=U.exit0,U.leftExit1=U.exit1,U.leftExit2=U.exit2):2===e&&(U.rightEntry0=U.entry0,U.rightEntry1=U.entry1,U.rightEntry2=U.entry2,U.rightExit0=U.exit0,U.rightExit1=U.exit1,U.rightExit2=U.exit2)}function C(e){S.vertex(U),1===e?(U.leftEntry0=U.entry0,U.leftEntry2=U.entry2,U.leftExit0=U.exit0,U.leftExit2=U.exit2):2===e&&(U.rightEntry0=U.entry0,U.rightEntry2=U.entry2,U.rightExit0=U.exit0,U.rightExit2=U.exit2)}class k{constructor(e,t){this.writeVertex=e,this.writeTriangle=t,this.capType=0,this.joinType=2,this.miterLimitCosine=y(2),this.roundLimitCosine=Math.cos(23*Math.PI/180),this.almostParallelCosine=.97,this.radsPerSlice=.8,this.textured=!1,this.joinOnUTurn=!1}vertex(e){const t=2===this.joinType?this.miterLimitCosine:this.roundLimitCosine,i=e.isCap&&0!==this.capType;let s=!1;e.cosine>this.almostParallelCosine?(e.exit0=e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance),e.exit2=e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance)):e.cosine<1-this.almostParallelCosine?(s=!e.isCap&&this.joinOnUTurn,e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.prevNormal.x,e.prevNormal.y,0,-1,e.distance),e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.prevNormal.x,-e.prevNormal.y,0,1,e.distance),e.exit0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.nextNormal.x,e.nextNormal.y,0,-1,e.distance),e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.nextNormal.x,-e.nextNormal.y,0,1,e.distance)):e.canSplit?(f(),e.sign>0?(e.splitInner?(e.exit0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.outbound.x,e.outbound.y,e.leftInner.x,e.leftInner.y,0,-1,e.distance),e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,e.rightInner.x,e.rightInner.y,0,-1,e.distance)):e.exit0=e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance),e.cosine<t?(s=!e.isCap,e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.prevNormal.x,-e.prevNormal.y,0,1,e.distance),e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.nextNormal.x,-e.nextNormal.y,0,1,e.distance)):e.splitOuter?(s=s||e.gapOuter,e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,-e.leftOuter.x,-e.leftOuter.y,0,1,e.distance),e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.outbound.x,e.outbound.y,-e.rightOuter.x,-e.rightOuter.y,0,1,e.distance)):e.entry2=e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance)):(e.splitInner?(e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.outbound.x,e.outbound.y,-e.leftInner.x,-e.leftInner.y,0,1,e.distance),e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,-e.rightInner.x,-e.rightInner.y,0,1,e.distance)):e.exit2=e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance),e.cosine<t?(s=!e.isCap,e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.prevNormal.x,e.prevNormal.y,0,-1,e.distance),e.exit0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.nextNormal.x,e.nextNormal.y,0,-1,e.distance)):e.splitOuter?(s=s||e.gapOuter,e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,e.leftOuter.x,e.leftOuter.y,0,-1,e.distance),e.exit0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.outbound.x,e.outbound.y,e.rightOuter.x,e.rightOuter.y,0,-1,e.distance)):e.exit0=e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance))):e.sign>0?(e.exit0=e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance),e.cosine<t?(s=!e.isCap,e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.prevNormal.x,-e.prevNormal.y,0,1,e.distance),e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.nextNormal.x,-e.nextNormal.y,0,1,e.distance)):e.entry2=e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance)):(e.exit2=e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance),e.cosine<t?(s=!e.isCap,e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.prevNormal.x,e.prevNormal.y,0,-1,e.distance),e.exit0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.nextNormal.x,e.nextNormal.y,0,-1,e.distance)):e.exit0=e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance));const r=e.canSplit&&(e.splitInner||e.splitOuter);let n;if(n=e.entry1=e.exit1=r||s||i?this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,0,0,0,0,e.distance):null,s&&1!==this.joinType)this.writeTriangle(n,e.sign>0?e.exit2:e.entry0,e.sign>0?e.entry2:e.exit0);else if(i&&1===this.capType||s&&1===this.joinType){let t,i,s,r,o,l;if(e.isCap){const n=Math.PI;o=Math.ceil(n/this.radsPerSlice),l=n/o,e.isFirstVertex?(t=e.prevNormal.x,i=e.prevNormal.y,s=e.entry0,r=e.entry2):e.isLastVertex&&(t=-e.nextNormal.x,i=-e.nextNormal.y,s=e.exit2,r=e.exit0)}else{const n=2*Math.acos(e.cosine);o=Math.ceil(n/this.radsPerSlice),l=n/o,t=e.sign>0?-e.prevNormal.x:e.nextNormal.x,i=e.sign>0?-e.prevNormal.y:e.nextNormal.y,s=e.sign>0?e.entry2:e.exit0,r=e.sign>0?e.exit2:e.entry0}const a=Math.cos(l),h=Math.sin(l),u=h*t+a*i;let c,x;t=a*t-h*i,i=u;for(let d=0;d<o;++d){if(c=x,d<o-1)if(e.isCap){const s=e.isFirstVertex?-1:1;x=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,t,i,s,0,e.distance)}else x=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,t,i,0,e.sign,e.distance);this.writeTriangle(0===d?s:c,n,d===o-1?r:x);const l=h*t+a*i;t=a*t-h*i,i=l}}else if(i&&2===this.capType){const t=e.isFirstVertex?1:-1;let i,s;this.textured?(i=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.prevNormal.x-t*e.inbound.x,e.prevNormal.y-t*e.inbound.y,-t,-1,e.distance),s=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.prevNormal.x-t*e.inbound.x,-e.prevNormal.y-t*e.inbound.y,-t,1,e.distance)):(i=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.prevNormal.x-t*e.inbound.x,e.prevNormal.y-t*e.inbound.y,0,-1,e.distance),s=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.prevNormal.x-t*e.inbound.x,-e.prevNormal.y-t*e.inbound.y,0,1,e.distance)),t>0?(this.writeTriangle(n,e.entry2,s),this.writeTriangle(n,s,i),this.writeTriangle(n,i,e.entry0)):(this.writeTriangle(n,s,e.exit2),this.writeTriangle(n,i,s),this.writeTriangle(n,e.exit0,i))}}bridge(e){this.writeTriangle(e.leftExit0,e.rightEntry0,null!=e.leftExit1?e.leftExit1:e.leftExit2),this.writeTriangle(e.rightEntry0,null!=e.rightEntry1?e.rightEntry1:e.rightEntry2,null!=e.leftExit1?e.leftExit1:e.leftExit2),null!=e.leftExit1&&null!=e.rightEntry1?(this.writeTriangle(e.leftExit1,e.rightEntry1,e.leftExit2),this.writeTriangle(e.rightEntry1,e.rightEntry2,e.leftExit2)):null!=e.leftExit1?this.writeTriangle(e.leftExit1,e.rightEntry2,e.leftExit2):null!=e.rightEntry1&&this.writeTriangle(e.rightEntry1,e.rightEntry2,e.leftExit2)}}export{k as E,m as a,x as b,g as c,f as d,l as e,E as i,o as n,_ as o,p as r,c as s,r as t,y as u};
