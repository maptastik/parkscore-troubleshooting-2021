import{c0 as e,aZ as t,O as n,X as r,U as a,fu as o,cz as c,x as l,e_ as i,eZ as s,z as u}from"./vendor.1ee57f36.js";import{h as f,f as h,L as d,N as p,D as g,o as E,J as y,I as m,B as w,S as v,a as N,b as I,g as b,c as S,T,d as R,_ as O,j as U,e as A,u as C,i as x,m as F,p as M,A as D,k as P,v as L,F as k,X as _,K as j,q as V,y as B,Z as Y,w as G,E as z,O as Z,l as H,n as q,r as W,P as X,s as K,t as J,x as Q,z as $}from"./arcadeUtils.d58d6223.js";import{registerFunctions as ee}from"./geomasync.aeb64d67.js";import"./number.adca3a71.js";import"./FeatureSetReader.3ec5c3db.js";import"./centroid.b04b550b.js";import"./geometryEngineAsync.1940242f.js";function te(e){return e instanceof Error?n(e):n(new Error(e))}function ne(e){return a(e)}function re(e,n){const r=[];for(let t=0;t<n.arguments.length;t++)r.push(ce(e,n.arguments[t]));return t(r)}function ae(t,n,r){return e(((e,a)=>{re(t,n).then((o=>{try{e(r(t,n,o))}catch(c){a(c)}}),a)}))}function oe(e,t,n){try{return re(e,t).then((r=>{try{const c=n(e,t,r);return(o=c)&&"function"==typeof o.then?c:a(c)}catch(c){return te(c)}var o}))}catch(r){return te(r)}}function ce(r,c){try{switch(c.type){case"VariableDeclarator":return function(t,n){try{let r=null;return r=null===n.init?a(null):ce(t,n.init),null!==t.localScope?r.then((r=>e((e=>{if(r===R&&(r=null),"Identifier"!==n.id.type)throw new Error("Can only assign a regular variable");const a=n.id.name.toLowerCase();t.localScope[a]={value:r,valueset:!0,node:n.init},e(R)})))):r.then((r=>e((e=>{if("Identifier"!==n.id.type)throw new Error("Can only assign a regular variable");const a=n.id.name.toLowerCase();r===R&&(r=null),t.globalScope[a]={value:r,valueset:!0,node:n.init},e(R)}))))}catch(r){return te(r)}}(r,c);case"VariableDeclaration":return ge(r,c,0);case"BlockStatement":return function(e,t){try{return pe(e,t,0)}catch(n){return te(n)}}(r,c);case"FunctionDeclaration":return function(e,t){try{const n=t.id.name.toLowerCase();return e.globalScope[n]={valueset:!0,node:null,value:new A(t,e)},a(R)}catch(n){return te(n)}}(r,c);case"ReturnStatement":return l=r,i=c,e(((e,t)=>{null===i.argument?e(new S(R)):ce(l,i.argument).then((n=>{try{e(new S(n))}catch(r){t(r)}}),t)}));case"IfStatement":return function(t,n){return e(((e,r)=>{"AssignmentExpression"!==n.test.type&&"UpdateExpression"!==n.test.type?ce(t,n.test).then((a=>{try{!0===a?ce(t,n.consequent).then(e,r):!1===a?null!==n.alternate?ce(t,n.alternate).then(e,r):e(R):r(new Error(P(n.test,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION")))}catch(o){r(o)}}),r):r(new Error(P(n.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION")))}))}(r,c);case"ExpressionStatement":return function(t,r){try{return"AssignmentExpression"===r.expression.type?ce(t,r.expression):(r.expression.type,ce(t,r.expression).then((t=>e((e=>{e(t===R?R:new T(t))})))))}catch(a){return n(a)}}(r,c);case"UpdateExpression":return function(t,r){try{const n=r.argument;if("MemberExpression"===n.type){const o={t:null};return ce(t,n.object).then((e=>{let r=null;return o.t=e,!0===n.computed?r=ce(t,n.property):"Identifier"===n.property.type&&(r=a(n.property.name)),r})).then((t=>e((e=>{const n=o.t;let a;if(Y(n)){if(!G(t))throw new Error("Invalid Parameter");if(t<0&&(t=n.length+t),t<0||t>=n.length)throw new Error("Assignment outside of array bounds");a=_(n[t]),n[t]="++"===r.operator?a+1:a-1}else if(n instanceof I){if(!1===k(t))throw new Error("Dictionary accessor must be a string");if(!0!==n.hasField(t))throw new Error("Invalid Parameter");a=_(n.field(t)),n.setField(t,"++"===r.operator?a+1:a-1)}else{if(!(n instanceof b))throw z(n)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===k(t))throw new Error("Feature accessor must be a string");if(!0!==n.hasField(t))throw new Error("Invalid Parameter");a=_(n.field(t)),n.setField(t,"++"===r.operator?a+1:a-1)}!1===r.prefix?e(a):e("++"===r.operator?a+1:a-1)}))))}return e(((e,n)=>{const a="Identifier"===r.argument.type?r.argument.name.toLowerCase():"";if(!a)throw new Error("Invalid identifier");let o;return null!==t.localScope&&void 0!==t.localScope[a]?(o=_(t.localScope[a].value),t.localScope[a]={value:"++"===r.operator?o+1:o-1,valueset:!0,node:r},void(!1===r.prefix?e(o):e("++"===r.operator?o+1:o-1))):void 0!==t.globalScope[a]?(o=_(t.globalScope[a].value),t.globalScope[a]={value:"++"===r.operator?o+1:o-1,valueset:!0,node:r},void(!1===r.prefix?e(o):e("++"===r.operator?o+1:o-1))):void n(new Error("Variable not recognised"))}))}catch(o){return n(o)}}(r,c);case"AssignmentExpression":return function(t,n){return e(((e,r)=>{const o=n.left;if("MemberExpression"===o.type)ce(t,n.right).then((c=>{try{ce(t,o.object).then((l=>{try{let i=null;if(!0===o.computed)i=ce(t,o.property);else{if("Identifier"!==o.property.type)throw new Error("Expected computed or identifier for assignemnt target");i=a(o.property.name)}i.then((t=>{try{if(Y(l)){if(!G(t))throw new Error("Invalid Parameter");if(t<0&&(t=l.length+t),t<0||t>l.length)throw new Error("Assignment outside of array bounds");if(t===l.length){if("="!==n.operator)throw new Error("Invalid Parameter");l[t]=de(c,n.operator,l[t],n)}else l[t]=de(c,n.operator,l[t],n)}else if(l instanceof I){if(!1===k(t))throw new Error("Dictionary accessor must be a string");if(!0===l.hasField(t))l.setField(t,de(c,n.operator,l.field(t),n));else{if("="!==n.operator)throw new Error("Invalid Parameter");l.setField(t,de(c,n.operator,null,n))}}else{if(!(l instanceof b))throw z(l)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===k(t))throw new Error("Feature accessor must be a string");if(!0===l.hasField(t))l.setField(t,de(c,n.operator,l.field(t),n));else{if("="!==n.operator)throw new Error("Invalid Parameter");l.setField(t,de(c,n.operator,null,n))}}e(R)}catch(a){r(a)}}),r)}catch(i){r(i)}}),r)}catch(l){r(l)}}),r);else{const a=o.name.toLowerCase();if(null!==t.localScope&&void 0!==t.localScope[a])return void ce(t,n.right).then((o=>{try{t.localScope[a]={value:de(o,n.operator,t.localScope[a].value,n),valueset:!0,node:n.right},e(R)}catch(c){r(c)}}),r);void 0!==t.globalScope[a]?ce(t,n.right).then((o=>{try{t.globalScope[a]={value:de(o,n.operator,t.globalScope[a].value,n),valueset:!0,node:n.right},e(R)}catch(c){r(c)}}),r):r(new Error("Cannot assign undeclared variable"))}}))}(r,c);case"ForStatement":return function(t,r){try{return null!==r.init?ce(t,r.init).then((()=>e(((e,n)=>{ie(t,r,{testResult:!0,lastAction:R},(t=>{e(t)}),(e=>{n(e)}),0)})))):e(((e,n)=>{ie(t,r,{testResult:!0,lastAction:R},(t=>{e(t)}),(e=>{n(e)}),0)}))}catch(a){return n(a)}}(r,c);case"ForInStatement":return function(t,n){return e(((e,r)=>{ce(t,n.right).then((o=>{try{let c=null;c="VariableDeclaration"===n.left.type?ce(t,n.left):a(),c.then((()=>{try{let a="";if("VariableDeclaration"===n.left.type){const e=n.left.declarations[0].id;"Identifier"===e.type&&(a=e.name)}else"Identifier"===n.left.type&&(a=n.left.name);if(!a)throw new Error(P(n,"RUNTIME","INVALIDVARIABLE"));a=a.toLowerCase();let c=null;if(null!==t.localScope&&void 0!==t.localScope[a]&&(c=t.localScope[a]),null===c&&void 0!==t.globalScope[a]&&(c=t.globalScope[a]),null===c)return void r(new Error(P(n,"RUNTIME","VARIABLENOTDECLARED")));Y(o)||k(o)?fe(t,n,o,{reject:r,resolve:e},c):z(o)?function(e,t,n,r,a,o){try{if(void 0===o&&(o="i"),0===n.length)return void r.resolve(R);ue(e,t,n,a,0,o,(e=>{r.resolve(e)}),(e=>{r.reject(e)}),0)}catch(c){r.reject(c)}}(t,n,o,{reject:r,resolve:e},c):o instanceof I||o instanceof b?function(e,t,n,r,a){try{fe(e,t,n.keys(),r,a,"k")}catch(o){r.reject(o)}}(t,n,o,{reject:r,resolve:e},c):H(o)?he(o.iterator(t.abortSignal),t,n,o,c,(t=>{e(t)}),(e=>{r(e)}),0):fe(t,n,[],{reject:r,resolve:e},c)}catch(a){r(a)}}),r)}catch(c){r(c)}}),r)}))}(r,c);case"BreakStatement":return a(O);case"EmptyStatement":return a(R);case"ContinueStatement":return a(U);case"TemplateElement":return function(e,t){return a(t.value?t.value.cooked:"")}(0,c);case"TemplateLiteral":return function(t,n){return e((e=>{const r=[];Z(n.expressions,((e,n,a,o)=>ce(t,n).then((e=>{r[a]=j(e)})))).then((()=>{let t="",a=0;for(const e of n.quasis)t+=e.value?e.value.cooked:"",!1===e.tail&&(t+=r[a]?r[a]:"",a++);e(t)}))}))}(r,c);case"Identifier":return me(r,c);case"MemberExpression":return function(t,r){try{return ce(t,r.object).then((c=>{try{return null===c?n(new Error(P(r,"RUNTIME","NOTFOUND"))):!1===r.computed?"Identifier"===r.property.type?c instanceof I||c instanceof b?a(c.field(r.property.name)):c instanceof o?a(ye(c,r.property.name,t,r)):n(new Error(P(r,"RUNTIME","INVALIDTYPE"))):n(new Error(P(r,"RUNTIME","INVALIDTYPE"))):ce(t,r.property).then((n=>e(((e,a)=>{if(c instanceof I||c instanceof b)k(n)?e(c.field(n)):a(new Error(P(r,"RUNTIME","INVALIDTYPE")));else if(c instanceof o)k(n)?e(ye(c,n,t,r)):a(new Error(P(r,"RUNTIME","INVALIDTYPE")));else if(Y(c))if(G(n)&&isFinite(n)&&Math.floor(n)===n){if(n<0&&(n=c.length+n),n>=c.length||n<0)throw new Error(P(r,"RUNTIME","OUTOFBOUNDS"));e(c[n])}else a(new Error(P(r,"RUNTIME","INVALIDTYPE")));else if(z(c))if(G(n)&&isFinite(n)&&Math.floor(n)===n){if(n<0&&(n=c.length()+n),n>=c.length()||n<0)throw new Error(P(r,"RUNTIME","OUTOFBOUNDS"));e(c.get(n))}else a(new Error(P(r,"RUNTIME","INVALIDTYPE")));else if(k(c))if(G(n)&&isFinite(n)&&Math.floor(n)===n){if(n<0&&(n=c.length+n),n>=c.length||n<0)throw new Error(P(r,"RUNTIME","OUTOFBOUNDS"));e(c[n])}else a(new Error(P(r,"RUNTIME","INVALIDTYPE")));else a(new Error(P(r,"RUNTIME","INVALIDTYPE")))}))))}catch(l){return te(l)}}))}catch(c){return te(c)}}(r,c);case"Literal":return ne(c.value);case"CallExpression":return function(e,t){try{if("Identifier"!==t.callee.type)return te(P(t,"RUNTIME","ONLYNODESSUPPORTED"));if(null!==e.localScope&&void 0!==e.localScope[t.callee.name.toLowerCase()]){const n=e.localScope[t.callee.name.toLowerCase()];return n.value instanceof v?n.value.fn(e,t):n.value instanceof A?Oe(e,t,n.value.definition):te(P(t,"RUNTIME","NOTAFUNCTION"))}if(void 0!==e.globalScope[t.callee.name.toLowerCase()]){const n=e.globalScope[t.callee.name.toLowerCase()];return n.value instanceof v?n.value.fn(e,t):n.value instanceof A?Oe(e,t,n.value.definition):te(P(t,"RUNTIME","NOTAFUNCTION"))}return te(P(t,"RUNTIME","NOTFOUND"))}catch(n){return te(n)}}(r,c);case"UnaryExpression":return function(t,n){try{return ce(t,n.argument).then((t=>e(((e,r)=>{m(t)&&"!"===n.operator?e(!t):"-"===n.operator?e(-1*_(t)):"+"===n.operator?e(1*_(t)):"~"===n.operator?e(~_(t)):r(new Error(P(n,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR")))}))))}catch(r){return te(r)}}(r,c);case"BinaryExpression":return function(n,r){try{return t([ce(n,r.left),ce(n,r.right)]).then((t=>e(((e,n)=>{const a=t[0],o=t[1];switch(r.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":e(B(_(a),_(o),r.operator));case"==":e(w(a,o));break;case"!=":e(!w(a,o));break;case"<":case">":case"<=":case">=":e(V(a,o,r.operator));break;case"+":k(a)||k(o)?e(j(a)+j(o)):e(_(a)+_(o));break;case"-":e(_(a)-_(o));break;case"*":e(_(a)*_(o));break;case"/":e(_(a)/_(o));break;case"%":e(_(a)%_(o));break;default:n(new Error(P(r,"RUNTIME","OPERATORNOTRECOGNISED")))}}))))}catch(a){return te(a)}}(r,c);case"LogicalExpression":return function(t,n){return e(((e,r)=>{"AssignmentExpression"!==n.left.type&&"UpdateExpression"!==n.left.type?"AssignmentExpression"!==n.right.type&&"UpdateExpression"!==n.right.type?ce(t,n.left).then((a=>{try{if(!m(a))throw new Error(P(n,"RUNTIME","ONLYBOOLEAN"));switch(n.operator){case"||":!0===a?e(a):ce(t,n.right).then((t=>{try{if(!m(t))throw new Error(P(n,"RUNTIME","ONLYORORAND"));e(t)}catch(a){r(a)}}),r);break;case"&&":!1===a?e(a):ce(t,n.right).then((t=>{try{if(!m(t))throw new Error(P(n,"RUNTIME","ONLYORORAND"));e(t)}catch(a){r(a)}}),r);break;default:throw new Error(P(n,"RUNTIME","ONLYORORAND"))}}catch(o){r(o)}}),r):r(new Error(P(n.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"))):r(new Error(P(n.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION")))}))}(r,c);case"ConditionalExpression":return te(P(c,"RUNTIME","NOTSUPPORTED"));case"ArrayExpression":return function(n,r){try{const a=[];for(let e=0;e<r.elements.length;e++)a.push(ce(n,r.elements[e]));return t(a).then((t=>e(((e,n)=>{for(let a=0;a<t.length;a++){if(L(t[a]))return void n(new Error(P(r,"RUNTIME","FUNCTIONCONTEXTILLEGAL")));t[a]===R&&(t[a]=null)}e(t)}))))}catch(a){return te(a)}}(r,c);case"ObjectExpression":return function(n,r){try{const a=[];for(let e=0;e<r.properties.length;e++)a.push(ce(n,r.properties[e]));return t(a).then((t=>e((e=>{const n={};for(let a=0;a<t.length;a++){const e=t[a];if(L(e.value))throw new Error("Illegal Argument");if(!1===k(e.key))throw new Error("Illegal Argument");e.value===R?n[e.key.toString()]=null:n[e.key.toString()]=e.value}const r=new I(n);r.immutable=!1,e(r)}))))}catch(a){return te(a)}}(r,c);case"Property":return function(t,r){try{return ce(t,r.value).then((n=>e((e=>{"Identifier"===r.key.type?e({key:r.key.name,value:n}):ce(t,r.key).then((t=>{e({key:t,value:n})}))}))))}catch(a){return n(a)}}(r,c);default:return te(P(c,"RUNTIME","UNREOGNISED"))}}catch(s){return te(s)}var l,i}function le(e,t,r){try{return ce(e,t.body).then((o=>{try{return r.lastAction=o,r.lastAction===O||r.lastAction instanceof S?(r.testResult=!1,a(r)):null!==t.update?ce(e,t.update).then((()=>a(r))):a(r)}catch(c){return n(c)}}))}catch(o){return n(o)}}function ie(e,t,r,o,c,l){try{(function(e,t,r){try{return null!==t.test?ce(e,t.test).then((o=>{try{return!0===e.abortSignal.aborted?n(new Error("Cancelled")):(r.testResult=o,!1===r.testResult?a(r):!0!==r.testResult?n(new Error(P(t,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))):le(e,t,r))}catch(c){return n(c)}})):le(e,t,r)}catch(o){return n(o)}})(e,t,r).then((()=>{try{!0===r.testResult?++l>100?(l=0,setTimeout((()=>{ie(e,t,r,o,c,l)}),0)):ie(e,t,r,o,c,l):r.lastAction instanceof S?o(r.lastAction):o(R)}catch(n){c(n)}}),(e=>{c(e)}))}catch(i){c(i)}}function se(e,t,n,r,a,o,c,l,i,s){try{if(r<=o)return void l(R);a.value="k"===c?n[o]:o,ce(e,t.body).then((u=>{try{u instanceof S?l(u):u===O?l(R):++s>100?(s=0,setTimeout((()=>{se(e,t,n,r,a,o+1,c,l,i,s)}),0)):se(e,t,n,r,a,o+1,c,l,i,s)}catch(f){i(f)}}),(e=>{i(e)}))}catch(u){i(u)}}function ue(e,t,n,r,a,o,c,l,i){try{if(n.length()<=a)return void c(R);r.value="k"===o?n.get(a):a,ce(e,t.body).then((s=>{s instanceof S?c(s):s===O?c(R):++i>100?(i=0,setTimeout((()=>{ue(e,t,n,r,a+1,o,c,l,i)}),0)):ue(e,t,n,r,a+1,o,c,l,i)}),(e=>{l(e)}))}catch(s){l(s)}}function fe(e,t,n,r,a,o){try{if(void 0===o&&(o="i"),0===n.length)return void r.resolve(R);se(e,t,n,n.length,a,0,o,(e=>{r.resolve(e)}),(e=>{r.reject(e)}),0)}catch(c){r.reject(c)}}function he(e,t,n,r,a,o,c,l){try{e.next().then((i=>{try{if(null===i)o(R);else{const s=b.createFromGraphicLikeObject(i.geometry,i.attributes,r);s._underlyingGraphic=i,a.value=s,ce(t,n.body).then((i=>{try{i===O?o(R):i instanceof S?o(i):++l>100?(l=0,setTimeout((()=>{he(e,t,n,r,a,o,c,l)}),0)):he(e,t,n,r,a,o,c,l)}catch(s){c(s)}}),(e=>{c(e)}))}}catch(s){c(s)}}),(e=>{c(e)}))}catch(i){c(i)}}function de(e,t,n,r){switch(t){case"=":return e===R?null:e;case"/=":return _(n)/_(e);case"*=":return _(n)*_(e);case"-=":return _(n)-_(e);case"+=":return k(n)||k(e)?j(n)+j(e):_(n)+_(e);case"%=":return _(n)%_(e);default:throw new Error(P(r,"RUNTIME","OPERATORNOTRECOGNISED"))}}function pe(t,n,r){try{return r>=n.body.length?a(R):e(((e,a)=>{ce(t,n.body[r]).then((o=>{try{o instanceof S||o===O||o===U||r===n.body.length-1?e(o):pe(t,n,r+1).then(e,a)}catch(c){a(c)}}),a)}))}catch(o){return te(o)}}function ge(t,n,r){return e(((e,a)=>{r>=n.declarations.length?e(R):ce(t,n.declarations[r]).then((()=>{r===n.declarations.length-1?e(R):ge(t,n,r+1).then((()=>{e(R)}),a)}),a)}))}let Ee=0;function ye(e,t,n,r){let a;switch(t=t.toLowerCase()){case"hasz":{const t=e.hasZ;return void 0!==t&&t}case"hasm":{const t=e.hasM;return void 0!==t&&t}case"spatialreference":{let t=e.spatialReference._arcadeCacheId;if(void 0===t){let n=!0;Object.freeze&&Object.isFrozen(e.spatialReference)&&(n=!1),n&&(Ee++,e.spatialReference._arcadeCacheId=Ee,t=Ee)}const n=new I({wkt:e.spatialReference.wkt,wkid:e.spatialReference.wkid});return void 0!==t&&(n._arcadeCacheId="SPREF"+t.toString()),n}}switch(e.type){case"extent":switch(t){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":{const n=e[t];return void 0!==n?n:null}case"type":return"Extent"}break;case"polygon":switch(t){case"rings":return a=e.cache._arcadeCacheId,void 0===a&&(Ee++,a=Ee,e.cache._arcadeCacheId=a),new W(e.rings,e.spatialReference,!0===e.hasZ,!0===e.hasM,a);case"type":return"Polygon"}break;case"point":switch(t){case"x":case"y":case"z":case"m":return void 0!==e[t]?e[t]:null;case"type":return"Point"}break;case"polyline":switch(t){case"paths":return a=e.cache._arcadeCacheId,void 0===a&&(Ee++,a=Ee,e.cache._arcadeCacheId=a),new W(e.paths,e.spatialReference,!0===e.hasZ,!0===e.hasM,a);case"type":return"Polyline"}break;case"multipoint":switch(t){case"points":return a=e.cache._arcadeCacheId,void 0===a&&(Ee++,a=Ee,e.cache._arcadeCacheId=a),new q(e.points,e.spatialReference,!0===e.hasZ,!0===e.hasM,a,1);case"type":return"Multipoint"}}throw new Error(P(r,"RUNTIME","PROPERTYNOTFOUND"))}function me(t,n){return e(((e,r)=>{const a=n.name.toLowerCase();if(null===t.localScope||void 0===t.localScope[a])if(void 0===t.globalScope[a])r(new Error(P(n,"RUNTIME","VARIABLENOTFOUND")));else{const n=t.globalScope[a];!0===n.valueset?e(n.value):null!==n.d?n.d.then(e,r):(n.d=ce(t,n.node),n.d.then((t=>{try{n.value=t,n.valueset=!0,e(t)}catch(a){r(a)}}),r))}else{const n=t.localScope[a];!0===n.valueset?e(n.value):null!==n.d?n.d.then(e,r):(n.d=ce(t,n.node),n.d.then((t=>{try{n.value=t,n.valueset=!0,e(t)}catch(a){r(a)}}),r))}}))}const we={};function ve(e){return null===e?"":Y(e)||z(e)?"Array":X(e)?"Date":k(e)?"String":m(e)?"Boolean":G(e)?"Number":e instanceof K?"Attachment":e instanceof J?"Portal":e instanceof I?"Dictionary":e instanceof b?"Feature":e instanceof c?"Point":e instanceof l?"Polygon":e instanceof i?"Polyline":e instanceof s?"Multipoint":e instanceof u?"Extent":L(e)?"Function":H(e)?"FeatureSet":Q(e)?"FeatureSetCollection":e===R?"":"number"==typeof e&&isNaN(e)?"Number":"Unrecognised Type"}function Ne(t,n,r,a){return e(((e,o)=>{ce(t,n.arguments[r]).then((c=>{try{if(w(c,a))return void ce(t,n.arguments[r+1]).then(e,o);{const c=n.arguments.length-r;return 1===c?void ce(t,n.arguments[r]).then(e,o):(2===c&&e(null),3===c?void ce(t,n.arguments[r+2]).then(e,o):void Ne(t,n,r+2,a).then(e,o))}}catch(l){o(l)}}),o)}))}function Ie(t,n,r,a){return e(((e,o)=>{!0===a?ce(t,n.arguments[r+1]).then(e,o):n.arguments.length-r==3?ce(t,n.arguments[r+2]).then(e,o):ce(t,n.arguments[r+2]).then((a=>{try{if(!1===m(a))return void o(new Error("WHEN needs boolean test conditions"));Ie(t,n,r+2,a).then(e,o)}catch(c){o(c)}}))}))}function be(n,r){try{const o=n.length,c=Math.floor(o/2);return 0===o?a([]):1===o?a([n[0]]):e(((e,a)=>{const l=[be(n.slice(0,c),r),be(n.slice(c,o),r)];t(l).then((t=>{try{Se(t[0],t[1],r,[]).then(e,a)}catch(n){a(n)}}),a)}))}catch(o){return te(o)}}function Se(t,n,r,a){return e(((e,o)=>{const c=a;t.length>0||n.length>0?t.length>0&&n.length>0?r(t[0],n[0]).then((l=>{try{isNaN(l)&&(l=1),l<=0?(c.push(t[0]),t=t.slice(1)):(c.push(n[0]),n=n.slice(1)),Se(t,n,r,a).then(e,o)}catch(i){o(i)}}),o):t.length>0?(c.push(t[0]),Se(t=t.slice(1),n,r,a).then(e,o)):n.length>0&&(c.push(n[0]),n=n.slice(1),Se(t,n,r,a).then(e,o)):e(a)}))}function Te(e,t){const n=e.length,r=Math.floor(n/2);return t||(t=function(e,t){return e<t?-1:e===t?0:1}),0===n?[]:1===n?[e[0]]:function(e,t,n){const r=[];for(;e.length>0||t.length>0;)if(e.length>0&&t.length>0){let a=n(e[0],t[0]);isNaN(a)&&(a=1),a<=0?(r.push(e[0]),e=e.slice(1)):(r.push(t[0]),t=t.slice(1))}else e.length>0?(r.push(e[0]),e=e.slice(1)):t.length>0&&(r.push(t[0]),t=t.slice(1));return r}(Te(e.slice(0,r),t),Te(e.slice(r,n),t),t)}function Re(t,r,a){try{const n=t.body;if(a.length!==t.params.length)return te(new Error("Invalid Parameter calls to function."));for(let e=0;e<a.length;e++){const n=t.params[e];"Identifier"===n.type&&(r.localScope[n.name.toLowerCase()]={d:null,value:a[e],valueset:!0,node:null})}return ce(r,n).then((t=>e(((e,n)=>{t instanceof S?e(t.value):t!==O?t!==U?e(t instanceof T?t.value:t):n(new Error("Cannot Continue from a Function")):n(new Error("Cannot Break from a Function"))}))))}catch(o){return n(o)}}function Oe(e,t,n){return oe(e,t,(function(t,r,a){const o={spatialReference:e.spatialReference,services:e.services,console:e.console,lrucache:e.lrucache,localScope:{},abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:e.depthCounter+1};if(o.depthCounter>64)throw new Error("Exceeded maximum function depth");return Re(n,o,a)}))}function Ue(e){return function(){const t={abortSignal:e.context.abortSignal,spatialReference:e.context.spatialReference,console:e.context.console,lrucache:e.context.lrucache,services:e.context.services,localScope:{},globalScope:e.context.globalScope,depthCounter:e.context.depthCounter+1};if(t.depthCounter>64)throw new Error("Exceeded maximum function depth");return Re(e.definition,t,arguments)}}f(we,ae),h(we,ae),d(we,ae),p(we,ae),g(we,ae),E(we,ae),ee({functions:we,compiled:!1,signatures:null,failDefferred:null,evaluateIdentifier:null,arcadeCustomFunctionHandler:null,mode:"async",standardFunction:ae,standardFunctionAsync:oe}),we.typeof=function(e,t){return ae(e,t,(function(e,t,n){y(n,1,1);const r=ve(n[0]);if("Unrecognised Type"===r)throw new Error("Unrecognised Type");return r}))},we.iif=function(n,r){return e(((e,a)=>{y(null===r.arguments?[]:r.arguments,3,3),ce(n,r.arguments[0]).then((o=>{try{if(!1===m(o))return void a(new Error("IF Function must have a boolean test condition"));t([ce(n,r.arguments[1]),ce(n,r.arguments[2])]).then((t=>{e(o?t[0]:t[1])}),a)}catch(c){a(c)}}),a)}))},we.decode=function(t,n){return e(((e,r)=>{n.arguments.length<2?r(new Error("Missing Parameters")):2!==n.arguments.length?(n.arguments.length-1)%2!=0?ce(t,n.arguments[0]).then((a=>{try{Ne(t,n,1,a).then(e,r)}catch(o){r(o)}}),r):r(new Error("Must have a default value result.")):ce(t,n.arguments[1]).then(e,r)}))},we.when=function(t,n){try{return n.arguments.length<3?te("Missing Parameters"):n.arguments.length%2==0?te("Must have a default value result."):ce(t,n.arguments[0]).then((r=>e(((e,a)=>{!1!==m(r)?Ie(t,n,0,r).then(e,a):a(new Error("WHEN needs boolean test conditions"))}))))}catch(r){return te(r)}},we.sort=function(e,t){return oe(e,t,(function(e,t,n){y(n,1,2);let r=n[0];if(z(r)&&(r=r.toArray()),!1===Y(r))return te(Error("Illegal Argument"));if(n.length>1)return!1===L(n[1])?te(Error("Illegal Argument")):be(r,Ue(n[1]));{let e=r;if(0===e.length)return a([]);const t={};for(let r=0;r<e.length;r++){const n=ve(e[r]);""!==n&&(t[n]=!0)}if(!0===t.Array||!0===t.Dictionary||!0===t.Feature||!0===t.Point||!0===t.Polygon||!0===t.Polyline||!0===t.Multipoint||!0===t.Extent||!0===t.Function)return a(e.slice(0));let n=0,o="";for(const r in t)n++,o=r;return n>1||"String"===o?e=Te(e,(function(e,t){if(null==e||e===R)return null==t||t===R?0:1;if(null==t||t===R)return-1;const n=j(e),r=j(t);return n<r?-1:n===r?0:1})):"Number"===o?e=Te(e,(function(e,t){return e-t})):"Boolean"===o?e=Te(e,(function(e,t){return e===t?0:t?-1:1})):"Date"===o&&(e=Te(e,(function(e,t){return t-e}))),a(e)}}))};const Ae={failDefferred:te,resolveDeffered:ne,fixSpatialReference:$,parseArguments:re,standardFunction:ae,standardFunctionAsync:oe,evaluateIdentifier:me,arcadeCustomFunction:Ue};for(const Ve in we)we[Ve]={value:new v(we[Ve]),valueset:!0,node:null};const Ce=function(){};function xe(e){console.log(e)}(Ce.prototype=we).infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},Ce.prototype.pi={value:Math.PI,valueset:!0,node:null};const Fe=Ae;function Me(e){const t={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:ae,standardFunctionAsync:oe,failDefferred:te,evaluateIdentifier:me,arcadeCustomFunctionHandler:Ue};for(let n=0;n<e.length;n++)e[n].registerFunctions(t);for(const n in t.functions)we[n]={value:new v(t.functions[n]),valueset:!0,node:null},Ce.prototype[n]=we[n];for(let n=0;n<t.signatures.length;n++)N(t.signatures[n],"async")}function De(t,n){let a=n.spatialReference;null==a&&(a=new r({wkid:102100}));const o=function(e,t){const n=new Ce;null==e&&(e={}),null==t&&(t={});const r=new I({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});r.immutable=!1,n.textformatting={value:r,valueset:!0,node:null};for(const a in t)n[a]={value:new v(t[a]),native:!0,valueset:!0,node:null};for(const a in e)e[a]&&"esri.Graphic"===e[a].declaredClass?n[a]={value:b.createFromGraphic(e[a]),valueset:!0,node:null}:n[a]={value:e[a],valueset:!0,node:null};return n}(n.vars,n.customfunctions);return ce({spatialReference:a,services:n.services,abortSignal:void 0===n.abortSignal||null===n.abortSignal?{aborted:!1}:n.abortSignal,globalScope:o,console:n.console?n.console:xe,lrucache:n.lrucache,localScope:null,depthCounter:1},t.body[0].body).then((t=>e(((e,n)=>{t instanceof S&&(t=t.value),t instanceof T&&(t=t.value),t===R&&(t=null),t!==O?t!==U?t instanceof v||t instanceof A?n(new Error("Cannot return FUNCTION")):e(t):n(new Error("Cannot return CONTINUE")):n(new Error("Cannot return BREAK"))}))))}function Pe(e,t){return C(e)}function Le(e,t){return x(e,t,"full")}function ke(e,t){return F(e,t)}function _e(e,t){return M(e,t)}function je(e){return D(e)}export{De as executeScript,Me as extend,Pe as extractFieldLiterals,je as findFunctionCalls,Fe as functionHelper,_e as referencesFunction,ke as referencesMember,Le as validateScript};
