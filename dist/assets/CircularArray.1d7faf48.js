var t=Object.defineProperty,e=Object.prototype.hasOwnProperty,s=Object.getOwnPropertySymbols,i=Object.prototype.propertyIsEnumerable,r=(e,s,i)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i,n=(t,n)=>{for(var o in n||(n={}))e.call(n,o)&&r(t,o,n[o]);if(s)for(var o of s(n))i.call(n,o)&&r(t,o,n[o]);return t};import{dA as o,q as l,ed as a,aJ as u,k as f}from"./vendor.1ee57f36.js";import{w as c,A as p}from"./Utils.88967ee0.js";import{o as h}from"./visualVariablesUtils.dc4022b6.js";function v(t,e=0,s=!1){const i=t[e+3];return t[e+0]*=i,t[e+1]*=i,t[e+2]*=i,s||(t[e+3]*=255),t}function m(t){if(!t)return 0;const{r:e,g:s,b:i,a:r}=t;return c(e*r,s*r,i*r,255*r)}function z(t){if(!t)return 0;const[e,s,i,r]=t;return c(e*(r/255),s*(r/255),i*(r/255),r)}const y=(t,e)=>t&&((...t)=>e.warn("DEBUG:",...t))||(()=>null),_=!1;function b(t,e){if(!t||!e)return t;switch(e){case"radius":case"distance":return 2*t;case"diameter":case"width":return t;case"area":return Math.sqrt(t)}return t}function d(t){return t.map((t=>function(t){return{value:t.value,size:o(t.size)}}(t)))}function S(t){if("string"==typeof t||"number"==typeof t)return o(t);const e=t;return{type:"size",expression:e.expression,stops:d(e.stops)}}const g=t=>{const e=[],s=[],i=d(t),r=i.length;for(let n=0;n<6;n++){const t=i[Math.min(n,r-1)];e.push(t.value),s.push(null==t.size?a:u(t.size))}return{values:new Float32Array(e),sizes:new Float32Array(s)}};function x(t){const e=t&&t.length>0?{}:null,s=e?{}:null;if(!e)return{vvFields:e,vvRanges:s};for(const i of t)if(i.field&&(e[i.type]=i.field),"size"===i.type){s.size||(s.size={});const t=i;switch(h(t)){case p.SIZE_MINMAX_VALUE:s.size.minMaxValue={minDataValue:t.minDataValue,maxDataValue:t.maxDataValue,minSize:S(t.minSize),maxSize:S(t.maxSize)};break;case p.SIZE_SCALE_STOPS:s.size.scaleStops={stops:d(t.stops)};break;case p.SIZE_FIELD_STOPS:if(t.levels){const e={};for(const s in t.levels)e[s]=g(t.levels[s]);s.size.fieldStops={type:"level-dependent",levels:e}}else s.size.fieldStops=n({type:"static"},g(t.stops));break;case p.SIZE_UNIT_VALUE:s.size.unitValue={unit:t.valueUnit,valueRepresentation:t.valueRepresentation}}}else if("color"===i.type)s.color=w(i);else if("opacity"===i.type)s.opacity=I(i);else if("rotation"===i.type){const t=i;s.rotation={type:t.rotationType}}return{vvFields:e,vvRanges:s}}function I(t){const e={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof t.field){if(!t.stops)return null;{if(t.stops.length>8)return null;const s=t.stops;for(let t=0;t<8;++t){const i=s[Math.min(t,s.length-1)];e.values[t]=i.value,e.opacities[t]=i.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const s=t.stops&&t.stops.length>=0&&t.stops[0].opacity;for(let t=0;t<8;t++)e.values[t]=1/0,e.opacities[t]=s}}return e}function E(t,e,s){t[4*e+0]=s.r/255,t[4*e+1]=s.g/255,t[4*e+2]=s.b/255,t[4*e+3]=s.a}function w(t){if(l(t))return null;if(t.normalizationField)return null;const e={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof t.field){if(!t.stops)return null;{if(t.stops.length>8)return null;e.field=t.field;const s=t.stops;for(let t=0;t<8;++t){const i=s[Math.min(t,s.length-1)];e.values[t]=i.value,E(e.colors,t,i.color)}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const s=t.stops&&t.stops.length>=0&&t.stops[0].color;for(let t=0;t<8;t++)e.values[t]=1/0,E(e.colors,t,s)}}for(let s=0;s<32;s+=4)v(e.colors,s,!0);return e}class V{constructor(t=Number.POSITIVE_INFINITY){this.size=0,this._start=0,this.maxSize=t,this._buffer=isFinite(t)?new Array(t):[]}get entries(){return this._buffer}enqueue(t){if(this.size===this.maxSize){const e=this._buffer[this._start];return this._buffer[this._start]=t,this._start=(this._start+1)%this.maxSize,e}return isFinite(this.maxSize)?this._buffer[(this._start+this.size++)%this.maxSize]=t:this._buffer[this._start+this.size++]=t,null}dequeue(){if(0===this.size)return null;const t=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,t}clear(){for(;f(this.dequeue()););}}export{V as e,z as f,m as i,_ as l,x as m,y as n,b as r};
