var t=Object.defineProperty,e=Object.prototype.hasOwnProperty,n=Object.getOwnPropertySymbols,o=Object.prototype.propertyIsEnumerable,r=(e,n,o)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o,s=(t,s)=>{for(var i in s||(s={}))e.call(s,i)&&r(t,i,s[i]);if(n)for(var i of n(s))o.call(s,i)&&r(t,i,s[i]);return t};import{dN as i,gJ as a,gK as c,cu as l,es as f,gL as u,gM as g,gN as d,gO as p,gP as m,cv as h,gQ as w,gR as y,gS as v,gT as A,gU as I}from"./vendor.1ee57f36.js";import{A as b,f as N,u as S,a as U,p as E,c as V,o as x,i as L,m as M,T as O,d as W,b as D,l as P,h as k,e as B,O as j,x as F,g as T,w as z,E as C,L as R,F as _,I as q,U as $,j as G,V as H,M as J,S as K,k as Q,q as X,v as Y,z as Z,B as tt,C as et,D as nt,G as ot,H as rt}from"./InterleavedLayout.aac2e361.js";function st(t,e,n,o){for(let r=0;r<o;r++)if(t[e+r]!==t[n+r])return!1;return!0}function it(t,e,n,o,r){for(let s=0;s<r;s++)n[o+s]=t[e+s]}function at(t,e,n){let o=0;for(let r=0;r<n;r++)o=t[e+r]+o|0,o=o+(o<<11)+(o>>>2)|0;return o>>>0}let ct=null;const lt={divisor:0};function ft(t,e={}){e=s(s({},lt),e);const n=t.stride;return t.fieldNames.filter((e=>{const n=t.fields.get(e).optional;return!(n&&n.glPadding)})).map((o=>{const r=t.fields.get(o),s=r.constructor.ElementCount,i=function(t){const e=ut[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}(r.constructor.ElementType),a=r.offset,c=!(!r.optional||!r.optional.glNormalized);return{name:o,stride:n,count:s,type:i,offset:a,normalized:c,divisor:e.divisor}}))}const ut={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126},gt=b().vec3f("position").u16("componentIndex").u16("_padding");ft(b().vec2u8("sideness"));const dt=b().vec3f("position0").vec3f("position1").u16("componentIndex").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("_padding",{glPadding:!0}).u16("_padding2",{glPadding:!0}),pt=dt.clone().vec3f("normal"),mt=dt.clone().vec3f("normalA").vec3f("normalB");class ht{updateSettings(t){this.settings=t}write(t,e,n){const o=function(t){const e=wt;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],vt[0]=5381;for(let n=0;n<yt.length;n++)vt[0]=31*vt[0]+yt[n];return vt[0]}(n);At.seed=o;const r=At.getIntRange(0,255),s=At.getIntRange(0,this.settings.variants-1),i=At.getFloat(),a=255*(.5*function(t,e){const n=t<0?-1:1;return Math.pow(Math.abs(t),1.2)*n}(-(1-Math.min(i/.7,1))+Math.max(0,i-.7)/(1-.7))+.5);t.position0.setVec(e,n.position0),t.position1.setVec(e,n.position1),t.componentIndex.set(e,n.componentIndex),t.variantOffset.set(e,r),t.variantStroke.set(e,s),t.variantExtension.set(e,a)}trim(t,e){return t.slice(0,e)}}const wt=new Float32Array(6),yt=new Uint32Array(wt.buffer),vt=new Uint32Array(1),At=new f;class It{constructor(){this.commonWriter=new ht}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return pt.createBuffer(t)}write(t,e,n){this.commonWriter.write(t,e,n),a(Nt,n.faceNormal0,n.faceNormal1),c(Nt,Nt),t.normal.setVec(e,Nt)}trim(t,e){return this.commonWriter.trim(t,e)}}It.Layout=pt,It.glLayout=ft(pt,{divisor:1});class bt{constructor(){this.commonWriter=new ht}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return mt.createBuffer(t)}write(t,e,n){this.commonWriter.write(t,e,n),t.normalA.setVec(e,n.faceNormal0),t.normalB.setVec(e,n.faceNormal1)}trim(t,e){return this.commonWriter.trim(t,e)}}bt.Layout=mt,bt.glLayout=ft(mt,{divisor:1});const Nt=l();function St(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:Ut(t.layout)}}function Ut(t){const e=new Array;return t.fields.forEach(((t,n)=>{const o=s(s({},t),{constructor:Vt(t.constructor)});e.push([n,o])})),{stride:t.stride,fields:e,fieldNames:t.fieldNames}}const Et=[N,S,U,E,V,x,L,M,O,W,D,P,k,B,j,F,T,z,C,R,_,q,$,G,H,J,K,Q,X,Y,Z,tt,et,nt,ot,rt];function Vt(t){return`${t.ElementType}_${t.ElementCount}`}const xt=new Map;function Lt(t,e){const n=t.length/3,o=new Uint32Array(e+1),r=new Uint32Array(e+1),s=(t,e)=>{t<e?o[t+1]++:r[e+1]++};for(let h=0;h<n;h++){const e=t[3*h],n=t[3*h+1],o=t[3*h+2];s(e,n),s(n,o),s(o,e)}let i=0,a=0;for(let h=0;h<e;h++){const t=o[h+1],e=r[h+1];o[h+1]=i,r[h+1]=a,i+=t,a+=e}const c=new Uint32Array(6*n),l=o[e],f=(t,e,n)=>{if(t<e){const r=o[t+1]++;c[2*r]=e,c[2*r+1]=n}else{const o=r[e+1]++;c[2*l+2*o]=t,c[2*l+2*o+1]=n}};for(let h=0;h<n;h++){const e=t[3*h],n=t[3*h+1],o=t[3*h+2];f(e,n,h),f(n,o,h),f(o,e,h)}const u=(t,e)=>{const n=2*t,o=e-t;for(let r=1;r<o;r++){const t=c[n+2*r],e=c[n+2*r+1];let o=r-1;for(;o>=0&&c[n+2*o]>t;o--)c[n+2*o+2]=c[n+2*o],c[n+2*o+3]=c[n+2*o+1];c[n+2*o+2]=t,c[n+2*o+3]=e}};for(let h=0;h<e;h++)u(o[h],o[h+1]),u(l+r[h],l+r[h+1]);const g=new Int32Array(3*n),d=(e,n)=>e===t[3*n]?0:e===t[3*n+1]?1:e===t[3*n+2]?2:-1,p=(t,e)=>{const n=d(t,e);g[3*e+n]=-1},m=(t,e,n,o)=>{const r=d(t,e);g[3*e+r]=o;const s=d(n,o);g[3*o+s]=e};for(let h=0;h<e;h++){let t=o[h];const e=o[h+1];let n=r[h];const s=r[h+1];for(;t<e&&n<s;){const e=c[2*t],o=c[2*l+2*n];e===o?(m(h,c[2*t+1],o,c[2*l+2*n+1]),t++,n++):e<o?(p(h,c[2*t+1]),t++):(p(o,c[2*l+2*n+1]),n++)}for(;t<e;)p(h,c[2*t+1]),t++;for(;n<s;)p(c[2*l+2*n],c[2*l+2*n+1]),n++}return g}function Mt(t,e){return t.cosAngle<e}function Ot(t,e){return t.cosAngle>e}function Wt(t,e){const n=v(t.cosAngle),o=Dt.fwd,r=Dt.ortho;return A(o,t.position1,t.position0),n*(y(d(r,t.faceNormal0,t.faceNormal1),o)>0?-1:1)>e}Et.forEach((t=>xt.set(Vt(t),t)));const Dt={edge:{position0:l(),position1:l(),faceNormal0:l(),faceNormal1:l(),componentIndex:0,cosAngle:0},ortho:l(),fwd:l()},Pt={v0:l(),v1:l(),v2:l()},kt={anglePlanar:4,angleSignificantEdge:35};async function Bt(t){const e=(r=t,{data:gt.createView(r.dataBuffer),originalIndices:"Uint32Array"===r.originalIndicesType?new Uint32Array(r.originalIndicesBuffer):"Uint16Array"===r.originalIndicesType?new Uint16Array(r.originalIndicesBuffer):void 0,writerSettings:r.writerSettings,skipDeduplicate:r.skipDeduplicate}),n=jt(e),o=[e.data.buffer];var r,s,i;return{result:(s=n,i=o,i.push(s.regular.lodInfo.lengths.buffer),i.push(s.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:St(s.regular.instancesData,i),lodInfo:{lengths:s.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:St(s.silhouette.instancesData,i),lodInfo:{lengths:s.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:s.averageEdgeLength}),transferList:o}}function jt(t){const e=function(t,e,n){if(e&&n)return{faces:n,neighbors:Lt(n,t.count),vertices:t};{const e=function(t,e,n){const o=t.byteLength/(4*e),r=new Uint32Array(t,0,o*e);let s=new Uint32Array(o);const a=n&&n.minReduction||0,c=n&&n.originalIndices||null,l=n&&n.componentOffsets||null;let f=0;if(l)for(let i=0;i<l.length-1;i++){const t=l[i+1]-l[i];t>f&&(f=t)}else f=o;const u=Math.floor(1.1*f)+1;(null==ct||ct.length<2*u)&&(ct=new Uint32Array(i(2*u)));for(let i=0;i<2*u;i++)ct[i]=0;let g=0;const d=!!l&&!!c,p=d?c.length:o,m=d?new Uint32Array(c.length):null,h=1.96;let w=0!==a?Math.ceil(7.84*h/(a*a)*a*(1-a)):p,y=1,v=l?l[1]:p;for(let i=0;i<p;i++){if(i===w){const t=1-g/i;if(t+h*Math.sqrt(t*(1-t)/i)<a)return null;w*=2}if(i===v){for(let t=0;t<2*u;t++)ct[t]=0;if(c)for(let t=l[y-1];t<l[y];t++)m[t]=s[c[t]];v=l[++y]}const t=d?c[i]:i,n=t*e,o=at(r,n,e);let f=o%u,p=g;for(;0!==ct[2*f+1];){if(ct[2*f]===o){const t=ct[2*f+1]-1;if(st(r,n,t*e,e)){p=s[t];break}}f++,f>=u&&(f-=u)}p===g&&(ct[2*f]=o,ct[2*f+1]=t+1,g++),s[t]=p}if(0!==a&&1-g/o<a)return null;if(d){for(let t=l[y-1];t<m.length;t++)m[t]=s[c[t]];s=m}const A=new Uint32Array(e*g);g=0;for(let i=0;i<p;i++)s[i]===g&&(it(r,(d?c[i]:i)*e,A,g*e,e),g++);if(c&&!d){const t=new Uint32Array(c.length);for(let e=0;e<t.length;e++)t[e]=s[c[e]];s=t}return{buffer:A.buffer,indices:s,uniqueCount:g}}(t.buffer,t.stride/4,{originalIndices:n}),o=Lt(e.indices,e.uniqueCount);return{faces:e.indices,neighbors:o,vertices:gt.createView(e.buffer)}}}(t.data,t.skipDeduplicate,t.originalIndices);return Ft.updateSettings(t.writerSettings),Tt.updateSettings(t.writerSettings),function(t,e,n,o=kt){const r=t.vertices.position,s=t.vertices.componentIndex,i=u(o.anglePlanar),a=u(o.angleSignificantEdge),l=Math.cos(a),f=Math.cos(i),v=Dt.edge,A=v.position0,b=v.position1,N=v.faceNormal0,S=v.faceNormal1,U=function(t){const e=t.faces.length/3,n=t.vertices.position,o=t.faces,r=Pt.v0,s=Pt.v1,i=Pt.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const t=o[3*l+0],e=o[3*l+1],f=o[3*l+2];n.getVec(t,r),n.getVec(e,s),n.getVec(f,i),g(s,s,r),g(i,i,r),d(r,s,i),c(r,r),a[3*l+0]=r[0],a[3*l+1]=r[1],a[3*l+2]=r[2]}return a}(t),E=function(t){const e=t.faces.length/3,n=t.faces,o=t.neighbors;let r=0;for(let a=0;a<e;a++){const t=o[3*a+0],e=o[3*a+1],s=o[3*a+2],i=n[3*a+0],c=n[3*a+1],l=n[3*a+2];r+=-1===t||i<c?1:0,r+=-1===e||c<l?1:0,r+=-1===s||l<i?1:0}const s=new Int32Array(4*r);let i=0;for(let a=0;a<e;a++){const t=o[3*a+0],e=o[3*a+1],r=o[3*a+2],c=n[3*a+0],l=n[3*a+1],f=n[3*a+2];(-1===t||c<l)&&(s[i++]=c,s[i++]=l,s[i++]=a,s[i++]=t),(-1===e||l<f)&&(s[i++]=l,s[i++]=f,s[i++]=a,s[i++]=e),(-1===r||f<c)&&(s[i++]=f,s[i++]=c,s[i++]=a,s[i++]=r)}return s}(t),V=E.length/4,x=e.allocate(V);let L=0;const M=V,O=n.allocate(M);let W=0,D=0,P=0;const k=p(0,V),B=new Float32Array(V);m(B,((t,e,n)=>{r.getVec(E[4*e+0],A),r.getVec(E[4*e+1],b),n[e]=I(A,b)})),k.sort(((t,e)=>B[e]-B[t]));const j=new Array,F=new Array;for(let c=0;c<V;c++){const t=k[c],o=B[t],a=E[4*t+0],u=E[4*t+1],g=E[4*t+2],d=E[4*t+3],p=-1===d;if(r.getVec(a,A),r.getVec(u,b),p)h(N,U[3*g+0],U[3*g+1],U[3*g+2]),w(S,N),v.componentIndex=s.get(a),v.cosAngle=y(N,S);else{if(h(N,U[3*g+0],U[3*g+1],U[3*g+2]),h(S,U[3*d+0],U[3*d+1],U[3*d+2]),v.componentIndex=s.get(a),v.cosAngle=y(N,S),Ot(v,f))continue;v.cosAngle<-.9999&&w(S,N)}D+=o,P++,p||Mt(v,l)?(e.write(x,L++,v),j.push(o)):Wt(v,i)&&(n.write(O,W++,v),F.push(o))}const T=new Float32Array(j.reverse()),z=new Float32Array(F.reverse());return{regular:{instancesData:e.trim(x,L),lodInfo:{lengths:T}},silhouette:{instancesData:n.trim(O,W),lodInfo:{lengths:z}},averageEdgeLength:D/P}}(e,Ft,Tt)}const Ft=new It,Tt=new bt;export{jt as work,Bt as wrappedWork};
