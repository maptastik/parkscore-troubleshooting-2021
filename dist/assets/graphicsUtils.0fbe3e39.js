import{b4 as t,cO as e,X as n,bP as s,c6 as i,c9 as a,bk as r,ee as o,ef as m,eg as c,aJ as l,b2 as x,b3 as h,b1 as f,b5 as u,d9 as y,db as p,eh as g,cY as b,ei as d,d7 as M,cP as S,cR as I,ej as w}from"./vendor.1ee57f36.js";import{n as v,T as P,a as L,r as W}from"./shapingUtils.66b0bc31.js";import{y as R}from"./CIMSymbolHelper.2ecfa4b9.js";const X=Math.PI/180,k=t(),A=a(),O=e();function j(t,e,n,s,i,a,r){if(!s||!n.symbol)return t[0]=t[1]=t[2]=t[3]=0,e[0]=e[1]=e[2]=e[3]=0,t;const o=s;if(!p(o)){g(t,o);let s=e[0];0===s&&(s=K(n),e[0]=s);const a=i*s/2;return t[0]-=a,t[1]-=a,t[2]+=a,t[3]+=a,t}{const s=o.x,m=o.y;"esriTS"===n.symbol.type&&0===e[2]&&0===e[3]&&Q(e,n.symbol,n.mosaicItem),function(t,e,n,s,i,a,r,o){let m;switch(s.type){case"esriSMS":case"esriPMS":m=U(e,n,s,a,r,0);break;case"esriTS":m=B(e,n,s,i,a,0);break;case"cim":case"CIMSymbolReference":case"expanded-cim":m=Y(e,n,s,a,r,0)}let c,l,x=0;for(let u=0;u<m.rings[0].length-1;u++)l=m.rings[0][u],c=(e-l[0])*(e-l[0])+(n-l[1])*(n-l[1]),x=Math.max(x,c);x=Math.sqrt(x);let h=b(e-x,o),f=b(e+x,o);if(h>f){const t=y(o);if(t){const[e,n]=t.valid;h=e,f=n}}t[0]=h,t[1]=n-x,t[2]=f,t[3]=n+x}(t,s,m,n.symbol,e,i,a,r)}return t}function z(t){return"simple-marker"===t||"picture-marker"===t||"text"===t}function H(t){switch(r(t.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0}const J=a(),T=a(),q=a(),C=a(),N=a(),E=a(),F=a();function G(t,e,n,s){i(q,e,n);const a=t.paths;let r,l,x,h,f,u,y,p,g,b=1/0;for(let d=0;d<a.length;d++){const t=a[d];if(!(t.length<2))for(let a=1;a<t.length;a++)r=t[a-1][0],x=t[a-1][1],l=t[a][0],h=t[a][1],f=Math.min(r,l)-s,u=Math.min(x,h)-s,y=Math.max(r,l)+s,p=Math.max(x,h)+s,e<f||e>y||n<u||n>p||(i(J,r,x),i(T,l,h),o(C,T,J),o(N,J,q),m(E,C,c(C,N)/c(C,C)),o(F,N,E),g=c(F,F),b>g&&(b=g))}return Math.sqrt(b)<=s}function U(t,e,n,a,r,o){let m,c;const y=l(n.xoffset),p=l(n.yoffset),g=X*n.angle,b=X*o;switch(n.type){case"esriSMS":m=c=l(n.size);break;case"esriPMS":m=l(n.width),c=l(n.height)}r<.04&&(a=.04*a/r);const d=x(k);h(d,d,i(A,t,e)),f(d,d,b-g),u(d,d,i(A,a,-a)),h(d,d,i(A,y,-p));const M=[0,0];s(M,i(A,-.5*m,-.5*c),d);const S=[0,0];s(S,i(A,-.5*m,.5*c),d);const I=[0,0];s(I,i(A,.5*m,-.5*c),d);const w=[0,0];return s(w,i(A,.5*m,.5*c),d),{rings:[[M,I,w,S,M]]}}function Y(t,e,n,a,r,o){const m=R.getEnvelope(n.data);if(!m)return null;r<.04&&(a=.04*a/r);const c=l(m.width),y=l(m.height),p=l(m.x),g=l(m.y),b=0*X,d=X*o,M=x(k);h(M,M,i(A,t,e)),f(M,M,d-b),u(M,M,i(A,a,a));const S=[0,0];s(S,i(A,p,g+y),M);const I=[0,0];s(I,i(A,p,g),M);const w=[0,0];s(w,i(A,p+c,g+y),M);const v=[0,0];return s(v,i(A,p+c,g),M),{rings:[[S,w,v,I,S]]}}function B(t,e,n,a,r,o){const m=l(n.xoffset),c=l(n.yoffset),y=X*n.angle,p=X*o,g=x(k);h(g,g,i(A,t,e)),f(g,g,p),u(g,g,i(A,r,-r));const b=a[0]+a[2]/2,d=a[1]+a[3]/2;h(g,g,i(A,m,-c)),h(g,g,i(A,b,d)),f(g,g,y),h(g,g,i(A,-b,-d));const M=[0,0];s(M,i(A,a[0],a[1]),g);const S=[0,0];s(S,i(A,a[0],a[1]+a[3]),g);const I=[0,0];s(I,i(A,a[0]+a[2],a[1]),g);const w=[0,0];return s(w,i(A,a[0]+a[2],a[1]+a[3]),g),{rings:[[M,I,w,S,M]]}}function D(t){let e,n,s,i,a,r,o,m,c,l=null;if(!t)return null;if("mesh"===t.type)return t.toJSON();if(e=t.spatialReference,n=y(e),!n)return t.toJSON();s=e.isWebMercator,r=s?102100:4326,i=V[r].maxX,a=V[r].minX,o=V[r].plus180Line,m=V[r].minus180Line;const x=t.toJSON();if(p(x))c=et(x,i,a);else if(d(x))x.points=x.points.map((t=>et(t,i,a))),c=x;else if(M(x))c=function(t,e){if(!e)return t;const n=function(t,e){const n=[],{ymin:s,ymax:i}=t,a=t.xmax-t.xmin,r=t.xmin,o=t.xmax;let m;const[c,l]=e.valid;m=$(t.xmin,e);const x=m.x,h=m.frameId;m=$(t.xmax,e);const f=m.x,u=m.frameId,y=x===f&&a>0;if(a>2*l){const t={xmin:r<o?x:f,ymin:s,xmax:l,ymax:i},e={xmin:c,ymin:s,xmax:r<o?f:x,ymax:i},a={xmin:0,ymin:s,xmax:l,ymax:i},m={xmin:c,ymin:s,xmax:0,ymax:i},y=[],p=[];_(t,a)&&y.push(h),_(t,m)&&p.push(h),_(e,a)&&y.push(u),_(e,m)&&p.push(u);for(let n=h+1;n<u;n++)y.push(n),p.push(n);n.push({extent:t,frameIds:[h]},{extent:e,frameIds:[u]},{extent:a,frameIds:y},{extent:m,frameIds:p})}else x>f||y?n.push({extent:{xmin:x,ymin:s,xmax:l,ymax:i},frameIds:[h]},{extent:{xmin:c,ymin:s,xmax:f,ymax:i},frameIds:[u]}):n.push({extent:{xmin:x,ymin:s,xmax:f,ymax:i},frameIds:[h]});return n}(t,e).map((t=>t.extent));return n.length<2?n[0]||t:n.length>2?(t.xmin=e.valid[0],t.xmax=e.valid[1],t):{rings:n.map((t=>[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]))}}(x,n);else if(S(x)||I(x)){const t=O;g(t,x);const e={xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3]},n=Z(e.xmin,a)*(2*i),s=0===n?x:function(t,e){const n=S(s=t)?s.rings:s.paths;var s;for(const i of n)for(const t of i)t[0]+=e;return t}(x,n);e.xmin+=n,e.xmax+=n,w(e,o)&&e.xmax!==i||w(e,m)&&e.xmin!==a?l=s:c=s}else c=t.clone();return null!==l?(new nt).cut(l,i):c}function K(t){switch(t.symbol.type){case"esriSFS":case"esriPFS":{const e=t.symbol.outline;return e?e.width:0}case"esriSLS":return l(t.symbol.width);case"esriSMS":return l(t.symbol.size);case"esriPMS":return l(Math.max(t.symbol.width,t.symbol.height));case"esriTS":{const e=[0,0,0,0];Q(e,t.symbol,t.mosaicItem);const n=Math.max(Math.abs(e[0]),Math.abs(e[1]));return Math.max(e[2],e[3])+n}case"expanded-cim":{const e=R.getEnvelope(t.symbol.data);return l(Math.sqrt(e.width*e.width+e.height*e.height))}case"composite-symbol":{if(!t.symbol.layers.length)return 0;const e=t.symbol.layers.length-1;return K({symbol:t.symbol.layers[e],mosaicItem:null})}case"label":default:return 0}}function Q(t,e,n){if(!n||0===n.glyphMosaicItems.length)return t;const s=v(e.text)[1],i=n.glyphMosaicItems,a=P(i,s,{scale:l(e.font.size)/24,angle:e.angle,xOffset:e.xoffset,yOffset:e.yoffset,hAlign:L(e.horizontalAlignment||"center"),vAlign:W(e.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(e.lineWidth||512,512)),lineHeight:30*Math.max(.25,Math.min(e.lineHeight||1,4)),decoration:e.font.decoration||"none",isCIM:!1}).bounds;return t[0]=l(a.x-a.halfWidth),t[1]=l(a.y-a.halfHeight),t[2]=l(a.width),t[3]=l(a.height),t}const V={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:{paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:n.WebMercator},minus180Line:{paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:n.WebMercator}},4326:{maxX:180,minX:-180,plus180Line:{paths:[[[180,-180],[180,180]]],spatialReference:n.WGS84},minus180Line:{paths:[[[-180,-180],[-180,180]]],spatialReference:n.WGS84}}};function Z(t,e){return Math.ceil((t-e)/(2*e))}function $(t,e){const[n,s]=e.valid,i=2*s;let a,r=0;return t>s?(a=Math.ceil(Math.abs(t-s)/i),t-=a*i,r=a):t<n&&(a=Math.ceil(Math.abs(t-n)/i),t+=a*i,r=-a),{x:t,frameId:r}}function _(t,e){const{xmin:n,ymin:s,xmax:i,ymax:a}=e;return tt(t,n,s)&&tt(t,n,a)&&tt(t,i,a)&&tt(t,i,s)}function tt(t,e,n){return e>=t.xmin&&e<=t.xmax&&n>=t.ymin&&n<=t.ymax}function et(t,e,n){if(Array.isArray(t)){const s=t[0];if(s>e){const n=Z(s,e);t[0]=s+n*(-2*e)}else if(s<n){const e=Z(s,n);t[0]=s+e*(-2*n)}}else{const s=t.x;if(s>e){const n=Z(s,e);t.x+=n*(-2*e)}else if(s<n){const e=Z(s,n);t.x+=e*(-2*n)}}return t}class nt{cut(t,e){let n;if(t.rings)this.closed=!0,n=t.rings,this.minPts=4;else{if(!t.paths)return null;this.closed=!1,n=t.paths,this.minPts=2}const s=n.length,i=-2*e;for(let a=0;a<s;a++){const t=n[a];if(t&&t.length>=this.minPts){const e=[];for(const n of t)e.push([n[0]+i,n[1]]);n.push(e)}}return this.closed?t.rings=n:t.paths=n,t}}export{B as D,G as E,U as F,Y as G,D as K,H as O,Q as V,j as X,z};
