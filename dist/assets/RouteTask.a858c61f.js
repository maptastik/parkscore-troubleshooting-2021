var e=Object.defineProperty,r=Object.prototype.hasOwnProperty,t=Object.getOwnPropertySymbols,s=Object.prototype.propertyIsEnumerable,o=(r,t,s)=>t in r?e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,i=(e,i)=>{for(var a in i||(i={}))r.call(i,a)&&o(e,a,i[a]);if(t)for(var a of t(i))s.call(i,a)&&o(e,a,i[a]);return e};import{e as a,y as n,A as l,i as p,a as u,b as c,l as y,eI as f,U as m,ai as h,fg as d}from"./vendor.1ee57f36.js";import{c as B,n as g,e as b}from"./NAMessage.d2825902.js";import{c as v}from"./DirectionsFeatureSet.df2282f9.js";import"./GPMessage.9782015f.js";let R=class extends u{constructor(e){super(e),this.directions=null,this.route=null,this.routeName=null,this.stops=null}};a([n({type:v,json:{write:!0}})],R.prototype,"directions",void 0),a([n({type:l,json:{write:!0}})],R.prototype,"route",void 0),a([n({type:String,json:{write:!0}})],R.prototype,"routeName",void 0),a([n({type:[l],json:{write:!0}})],R.prototype,"stops",void 0),R=a([p("esri.tasks.support.RouteResult")],R);var O=R;function N(e){return e&&y.fromJSON(e).features.map((e=>e))}let j=class extends u{constructor(e){super(e),this.barriers=null,this.messages=null,this.pointBarriers=null,this.polylineBarriers=null,this.polygonBarriers=null,this.routeResults=null}readPointBarriers(e,r){return N(r.barriers||r.pointBarriers)}readPolylineBarriers(e){return N(e)}readPolygonBarriers(e){return N(e)}};a([n({aliasOf:"pointBarriers"})],j.prototype,"barriers",void 0),a([n({type:[B]})],j.prototype,"messages",void 0),a([n({type:[l]})],j.prototype,"pointBarriers",void 0),a([c("pointBarriers",["barriers","pointBarriers"])],j.prototype,"readPointBarriers",null),a([n({type:[l]})],j.prototype,"polylineBarriers",void 0),a([c("polylineBarriers")],j.prototype,"readPolylineBarriers",null),a([n({type:[l]})],j.prototype,"polygonBarriers",void 0),a([c("polygonBarriers")],j.prototype,"readPolygonBarriers",null),a([n({type:[O]})],j.prototype,"routeResults",void 0),j=a([p("esri.tasks.support.RouteResultsContainer")],j);var A=j;const P=b({accumulateAttributes:{name:"accumulateAttributeNames"},attributeParameterValues:!0,directionsTimeAttribute:{name:"directionsTimeAttributeName"},impedanceAttribute:{name:"impedanceAttributeName"},outSpatialReference:{name:"outSR",getter:e=>e.outSpatialReference.wkid},pointBarriers:{name:"barriers"},polylineBarriers:!0,polygonBarriers:!0,restrictionAttributes:{name:"restrictionAttributeNames"},stops:!0,travelMode:!0});let S=class extends(g(d)){constructor(e){super(e)}solve(e,r){const t=[],s=[],o={},a={};return e.stops&&e.stops.features&&this._collectGeometries(e.stops.features,s,"stops.features",o),e.pointBarriers&&e.pointBarriers.features&&this._collectGeometries(e.pointBarriers.features,s,"pointBarriers.features",o),e.polylineBarriers&&e.polylineBarriers.features&&this._collectGeometries(e.polylineBarriers.features,s,"polylineBarriers.features",o),e.polygonBarriers&&e.polygonBarriers.features&&this._collectGeometries(e.polygonBarriers.features,s,"polygonBarriers.features",o),f(s).then((e=>{for(const r in o){const s=o[r];t.push(r),a[r]=e.slice(s[0],s[1])}return this._isInputGeometryZAware(a,t)?this.getServiceDescription():m({dontCheck:!0})})).then((s=>{("dontCheck"in s?s.dontCheck:s.hasZ)||this._dropZValuesOffInputGeometry(a,t);for(const r in a)a[r].forEach(((t,s)=>{e.get(r)[s].geometry=t}));let o={query:i(i(i({},this.parsedUrl.query),{f:"json"}),P.toQueryParams(e))};(this.requestOptions||r)&&(o=i(i(i({},this.requestOptions),r),o));const{path:n}=this.parsedUrl,l="/solve",p=n.endsWith(l)?n:n+l;return h(p,o)})).then((e=>this._handleSolveResponse(e)))}_collectGeometries(e,r,t,s){s[t]=[r.length,r.length+e.length],e.forEach((e=>{r.push(e.geometry)}))}_handleSolveResponse(e){const r=[],t=[],{directions:s=[],routes:{features:o=[],spatialReference:i=null}={},stops:{features:a=[],spatialReference:n=null}={},barriers:l,polygonBarriers:p,polylineBarriers:u,messages:c}=e.data,y="esri.tasks.RouteTask.NULL_ROUTE_NAME";let f,m,h=!0;const d=o&&i||a&&n||l&&l.spatialReference||p&&p.spatialReference||u&&u.spatialReference;s.forEach((e=>{r.push(f=e.routeName),t[f]={directions:e}})),o.forEach((e=>{-1===r.indexOf(f=e.attributes.Name)&&(r.push(f),t[f]={}),e.geometry&&(e.geometry.spatialReference=d),t[f].route=e})),a.forEach((e=>{m=e.attributes,-1===r.indexOf(f=m.RouteName||y)&&(r.push(f),t[f]={}),f!==y&&(h=!1),e.geometry&&(e.geometry.spatialReference=d),null==t[f].stops&&(t[f].stops=[]),t[f].stops.push(e)})),a.length>0&&!0===h&&(t[r[0]].stops=t[y].stops,delete t[y],r.splice(r.indexOf(y),1));const B=r.map((e=>(t[e].routeName=e===y?null:e,t[e])));return A.fromJSON({routeResults:B,pointBarriers:l,polygonBarriers:p,polylineBarriers:u,messages:c})}};S=a([p("esri.tasks.RouteTask")],S);var _=S;export default _;
