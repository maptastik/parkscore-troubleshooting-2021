import{dn as t,dp as i,dq as n,c0 as e,dr as a,ds as r,dt as s,du as h,dv as o}from"./vendor.1ee57f36.js";import{t as l}from"./json.9d10e1a3.js";import{r as m}from"./quickselect.53c6798b.js";const c=[0,0];function u(t,i){if(!i)return null;if("x"in i){const n={x:0,y:0};return[n.x,n.y]=t(i.x,i.y,c),null!=i.z&&(n.z=i.z),null!=i.m&&(n.m=i.m),n}if("xmin"in i){const n={xmin:0,ymin:0,xmax:0,ymax:0};return[n.xmin,n.ymin]=t(i.xmin,i.ymin,c),[n.xmax,n.ymax]=t(i.xmax,i.ymax,c),i.hasZ&&(n.zmin=i.zmin,n.zmax=i.zmax,n.hasZ=!0),i.hasM&&(n.mmin=i.mmin,n.mmax=i.mmax,n.hasM=!0),n}return"rings"in i?{rings:f(i.rings,t),hasM:i.hasM,hasZ:i.hasZ}:"paths"in i?{paths:f(i.paths,t),hasM:i.hasM,hasZ:i.hasZ}:"points"in i?{points:x(i.points,t),hasM:i.hasM,hasZ:i.hasZ}:void 0}function f(t,i){const n=[];for(const e of t)n.push(x(e,i));return n}function x(t,i){const n=[];for(const e of t){const t=i(e[0],e[1],[0,0]);n.push(t),e.length>2&&t.push(e[2]),e.length>3&&t.push(e[3])}return n}async function p(t,i){if(!i)return;const n=Array.isArray(t)?t.map((t=>{var i;return null==(i=t.geometry)?void 0:i.spatialReference})):[t];await o(n.map((t=>({source:t,dest:i}))))}const d=u.bind(null,t),_=u.bind(null,i);function g(t,i,e){return t?(e||(e=i,i=t.spatialReference),h(i)&&h(e)&&!n(i,e)?a(i,e)?r(e)?d(t):_(t):s(l,[t],i,e,null)[0]:t):t}const M=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(t,i,a){!t||!t.length||!i||!a||n(i,a);const r={geometries:t,inSpatialReference:i,outSpatialReference:a,resolve:null};return this._jobs.push(r),e((t=>{r.resolve=t,null===this._timer&&(this._timer=setTimeout(this._process,10))}))}_process(){this._timer=null;const t=this._jobs.shift();if(!t)return;const{geometries:i,inSpatialReference:n,outSpatialReference:e,resolve:h}=t;a(n,e)?r(e)?h(i.map(d)):h(i.map(_)):h(s(l,i,n,e,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};async function X(t,i,n){return M.push(t,i,n)}function Y(t,i){if(!(this instanceof Y))return new Y(t,i);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),i&&("function"==typeof i?this.toBBox=i:this._initFormat(i)),this.clear()}function v(t,i,n){if(!n)return i.indexOf(t);for(var e=0;e<i.length;e++)if(n(t,i[e]))return e;return-1}function B(t,i){y(t,0,t.children.length,i,t)}function y(t,i,n,e,a){a||(a=E(null)),a.minX=1/0,a.minY=1/0,a.maxX=-1/0,a.maxY=-1/0;for(var r,s=i;s<n;s++)r=t.children[s],b(a,t.leaf?e(r):r);return a}function b(t,i){return t.minX=Math.min(t.minX,i.minX),t.minY=Math.min(t.minY,i.minY),t.maxX=Math.max(t.maxX,i.maxX),t.maxY=Math.max(t.maxY,i.maxY),t}function j(t,i){return t.minX-i.minX}function S(t,i){return t.minY-i.minY}function R(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Z(t){return t.maxX-t.minX+(t.maxY-t.minY)}function w(t,i){return t.minX<=i.minX&&t.minY<=i.minY&&i.maxX<=t.maxX&&i.maxY<=t.maxY}function z(t,i){return i.minX<=t.maxX&&i.minY<=t.maxY&&i.maxX>=t.minX&&i.maxY>=t.minY}function E(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function F(t,i,n,e,a){for(var r,s=[i,n];s.length;)(n=s.pop())-(i=s.pop())<=e||(r=i+Math.ceil((n-i)/e/2)*e,m(t,r,i,n,a),s.push(i,r,r,n))}Y.prototype={all:function(){return this._all(this.data,[])},search:function(t){var i=this.data,n=[],e=this.toBBox;if(!z(t,i))return n;for(var a,r,s,h,o=[];i;){for(a=0,r=i.children.length;a<r;a++)s=i.children[a],z(t,h=i.leaf?e(s):s)&&(i.leaf?n.push(s):w(t,h)?this._all(s,n):o.push(s));i=o.pop()}return n},collides:function(t){var i=this.data,n=this.toBBox;if(!z(t,i))return!1;for(var e,a,r,s,h=[];i;){for(e=0,a=i.children.length;e<a;e++)if(r=i.children[e],z(t,s=i.leaf?n(r):r)){if(i.leaf||w(t,s))return!0;h.push(r)}i=h.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0,n=t.length;i<n;i++)this.insert(t[i]);return this}var e=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){var a=this.data;this.data=e,e=a}this._insert(e,this.data.height-e.height-1,!0)}else this.data=e;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=E([]),this},remove:function(t,i){if(!t)return this;for(var n,e,a,r,s=this.data,h=this.toBBox(t),o=[],l=[];s||o.length;){if(s||(s=o.pop(),e=o[o.length-1],n=l.pop(),r=!0),s.leaf&&-1!==(a=v(t,s.children,i)))return s.children.splice(a,1),o.push(s),this._condense(o),this;r||s.leaf||!w(s,h)?e?(n++,s=e.children[n],r=!1):s=null:(o.push(s),l.push(n),n=0,e=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:j,compareMinY:S,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,i){for(var n=[];t;)t.leaf?i.push.apply(i,t.children):n.push.apply(n,t.children),t=n.pop();return i},_build:function(t,i,n,e){var a,r=n-i+1,s=this._maxEntries;if(r<=s)return B(a=E(t.slice(i,n+1)),this.toBBox),a;e||(e=Math.ceil(Math.log(r)/Math.log(s)),s=Math.ceil(r/Math.pow(s,e-1))),(a=E([])).leaf=!1,a.height=e;var h,o,l,m,c=Math.ceil(r/s),u=c*Math.ceil(Math.sqrt(s));for(F(t,i,n,u,this.compareMinX),h=i;h<=n;h+=u)for(F(t,h,l=Math.min(h+u-1,n),c,this.compareMinY),o=h;o<=l;o+=c)m=Math.min(o+c-1,l),a.children.push(this._build(t,o,m,e-1));return B(a,this.toBBox),a},_chooseSubtree:function(t,i,n,e){for(var a,r,s,h,o,l,m,c,u,f;e.push(i),!i.leaf&&e.length-1!==n;){for(m=c=1/0,a=0,r=i.children.length;a<r;a++)o=R(s=i.children[a]),u=t,f=s,(l=(Math.max(f.maxX,u.maxX)-Math.min(f.minX,u.minX))*(Math.max(f.maxY,u.maxY)-Math.min(f.minY,u.minY))-o)<c?(c=l,m=o<m?o:m,h=s):l===c&&o<m&&(m=o,h=s);i=h||i.children[0]}return i},_insert:function(t,i,n){var e=this.toBBox,a=n?t:e(t),r=[],s=this._chooseSubtree(a,this.data,i,r);for(s.children.push(t),b(s,a);i>=0&&r[i].children.length>this._maxEntries;)this._split(r,i),i--;this._adjustParentBBoxes(a,r,i)},_split:function(t,i){var n=t[i],e=n.children.length,a=this._minEntries;this._chooseSplitAxis(n,a,e);var r=this._chooseSplitIndex(n,a,e),s=E(n.children.splice(r,n.children.length-r));s.height=n.height,s.leaf=n.leaf,B(n,this.toBBox),B(s,this.toBBox),i?t[i-1].children.push(s):this._splitRoot(n,s)},_splitRoot:function(t,i){this.data=E([t,i]),this.data.height=t.height+1,this.data.leaf=!1,B(this.data,this.toBBox)},_chooseSplitIndex:function(t,i,n){var e,a,r,s,h,o,l,m,c,u,f,x,p,d;for(o=l=1/0,e=i;e<=n-i;e++)c=a=y(t,0,e,this.toBBox),u=r=y(t,e,n,this.toBBox),void 0,void 0,void 0,void 0,f=Math.max(c.minX,u.minX),x=Math.max(c.minY,u.minY),p=Math.min(c.maxX,u.maxX),d=Math.min(c.maxY,u.maxY),s=Math.max(0,p-f)*Math.max(0,d-x),h=R(a)+R(r),s<o?(o=s,m=e,l=h<l?h:l):s===o&&h<l&&(l=h,m=e);return m},_chooseSplitAxis:function(t,i,n){var e=t.leaf?this.compareMinX:j,a=t.leaf?this.compareMinY:S;this._allDistMargin(t,i,n,e)<this._allDistMargin(t,i,n,a)&&t.children.sort(e)},_allDistMargin:function(t,i,n,e){t.children.sort(e);var a,r,s=this.toBBox,h=y(t,0,i,s),o=y(t,n-i,n,s),l=Z(h)+Z(o);for(a=i;a<n-i;a++)r=t.children[a],b(h,t.leaf?s(r):r),l+=Z(h);for(a=n-i-1;a>=i;a--)r=t.children[a],b(o,t.leaf?s(r):r),l+=Z(o);return l},_adjustParentBBoxes:function(t,i,n){for(var e=n;e>=0;e--)b(i[e],t)},_condense:function(t){for(var i,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(i=t[n-1].children).splice(i.indexOf(t[n]),1):this.clear():B(t[n],this.toBBox)},_initFormat:function(t){var i=["return a"," - b",";"];this.compareMinX=new Function("a","b",i.join(t[0])),this.compareMinY=new Function("a","b",i.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};export{p as f,g,Y as i,X as j};
