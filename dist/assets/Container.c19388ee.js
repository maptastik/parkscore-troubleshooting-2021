var t=Object.defineProperty,e=Object.prototype.hasOwnProperty,r=Object.getOwnPropertySymbols,n=Object.prototype.propertyIsEnumerable,s=(e,r,n)=>r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,i=(t,i)=>{for(var a in i||(i={}))e.call(i,a)&&s(t,a,i[a]);if(r)for(var a of r(i))n.call(i,a)&&s(t,a,i[a]);return t};import{dg as a,dh as c,di as o,m as u,dj as l,dk as h,dl as f,g as p,s as d,dm as g,r as m,cJ as _}from"./vendor.1ee57f36.js";import{r as y}from"./mat4f32.65c405e6.js";class v{constructor(t,e,r){this.strength=t,this.radius=e,this.threshold=r,this.type="bloom"}interpolate(t,e,r){this.strength=C(t.strength,e.strength,r),this.radius=C(t.radius,e.radius,r),this.threshold=C(t.threshold,e.threshold,r)}clone(){return new v(this.strength,this.radius,this.threshold)}}class w{constructor(t){this.radius=t,this.type="blur"}interpolate(t,e,r){this.radius=Math.round(C(t.radius,e.radius,r))}clone(){return new w(this.radius)}}class b{constructor(t,e){this.type=t,this.amount=e,"invert"!==this.type&&"grayscale"!==this.type&&"sepia"!==this.type||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,e,r){this.amount=C(t.amount,e.amount,r),this._updateMatrix()}clone(){return new b(this.type,this.amount)}_updateMatrix(){const t=this._colorMatrix||y();switch(this.type){case"brightness":this._colorMatrix=((t,e)=>{const r=c(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return a(r,r)})(t,this.amount);break;case"contrast":this._colorMatrix=((t,e)=>{const r=c(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return a(r,r)})(t,this.amount);break;case"grayscale":this._colorMatrix=((t,e)=>{const r=1-e,n=c(t,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return a(n,n)})(t,this.amount);break;case"invert":this._colorMatrix=((t,e)=>{const r=1-2*e,n=c(t,r,0,0,e,0,r,0,e,0,0,r,e,0,0,0,1);return a(n,n)})(t,this.amount);break;case"saturate":this._colorMatrix=((t,e)=>{const r=c(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return a(r,r)})(t,this.amount);break;case"sepia":this._colorMatrix=((t,e)=>{const r=1-e,n=c(t,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return a(n,n)})(t,this.amount)}}}class A{constructor(t,e,r,n){this.offsetX=t,this.offsetY=e,this.blurRadius=r,this.color=n,this.type="drop-shadow"}interpolate(t,e,r){this.offsetX=C(t.offsetX,e.offsetX,r),this.offsetY=C(t.offsetY,e.offsetY,r),this.blurRadius=C(t.blurRadius,e.blurRadius,r),this.color[0]=Math.round(C(t.color[0],e.color[0],r)),this.color[1]=Math.round(C(t.color[1],e.color[1],r)),this.color[2]=Math.round(C(t.color[2],e.color[2],r)),this.color[3]=C(t.color[3],e.color[3],r)}clone(){return new A(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}}class x{constructor(t){this.angle=t,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,e,r){this.angle=C(t.angle,e.angle,r),this._updateMatrix()}clone(){return new x(this.angle)}_updateMatrix(){const t=this._colorMatrix||y();this._colorMatrix=((t,e)=>{const r=Math.sin(e*Math.PI/180),n=Math.cos(e*Math.PI/180),s=c(t,.213+.787*n-.213*r,.715-.715*n-.715*r,.072-.072*n+.928*r,0,.213-.213*n+.143*r,.715+.285*n+.14*r,.072-.072*n-.283*r,0,.213-.213*n-.787*r,.715-.715*n+.715*r,.072+.928*n+.072*r,0,0,0,0,1);return a(s,s)})(t,this.angle)}}class M{constructor(t){this.amount=t,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(t,e,r){this.amount=C(t.amount,e.amount,r)}clone(){return new M(this.amount)}}function C(t,e,r){return t+(e-t)*r}var F=o((function(t){t.exports&&(t.exports=function(){function t(e,r,n,s){this.message=e,this.expected=r,this.found=n,this.location=s,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t)}return function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}(t,Error),t.buildMessage=function(t,e){var r,n={literal:function(t){return'"'+i(t.text)+'"'},class:function(t){var e,r="";for(e=0;e<t.parts.length;e++)r+=t.parts[e]instanceof Array?a(t.parts[e][0])+"-"+a(t.parts[e][1]):a(t.parts[e]);return"["+(t.inverted?"^":"")+r+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function s(t){return t.charCodeAt(0).toString(16).toUpperCase()}function i(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+s(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+s(t)}))}function a(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+s(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+s(t)}))}function c(t){return n[t.type](t)}return"Expected "+function(t){var e,r,n=new Array(t.length);for(e=0;e<t.length;e++)n[e]=c(t[e]);if(n.sort(),n.length>0){for(e=1,r=1;e<n.length;e++)n[e-1]!==n[e]&&(n[r]=n[e],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(t)+" but "+(((r=e)?'"'+i(r)+'"':"end of input")+" found.")},{SyntaxError:t,parse:function(e,r){r=void 0!==r?r:{};var n,s,i,a,c={},o={start:vt},u=vt,l=gt("none"),h="none",f=pt("none",!1),p=pt(")",!1),d=",",g=pt(",",!1),m=function(t,e){return e.length>0?function(t,e,r){return[t].concat(function(t,e){return t.map((function(t){return t[e]}))}(e,r))}(t,e,3):[t]},_=gt("whitespace"),y=/^[ \t\n\r]/,v=dt([" ","\t","\n","\r"],!1,!1),w=gt("function"),b=pt("(",!1),A=gt("identifier"),x=/^[a-z\-]/,M=dt([["a","z"],"-"],!1,!1),C=gt("percentage"),F=pt("%",!1),E=gt("length"),R="px",S=pt("px",!1),T="cm",k=pt("cm",!1),L="mm",O=pt("mm",!1),$="in",j=pt("in",!1),P="pt",q=pt("pt",!1),I="pc",X=pt("pc",!1),Y=gt("angle"),z="deg",D=pt("deg",!1),J="rad",N=pt("rad",!1),U="grad",B=pt("grad",!1),G="turn",H=pt("turn",!1),K=gt("number"),Q=gt("color"),V=pt("#",!1),W=/^[0-9a-fA-F]/,Z=dt([["0","9"],["a","f"],["A","F"]],!1,!1),tt=/^[+\-]/,et=dt(["+","-"],!1,!1),rt=/^[0-9]/,nt=dt([["0","9"]],!1,!1),st=pt(".",!1),it=pt("e",!1),at=0,ct=0,ot=[{line:1,column:1}],ut=0,lt=[],ht=0;if("startRule"in r){if(!(r.startRule in o))throw new Error("Can't start parsing from rule \""+r.startRule+'".');u=o[r.startRule]}function ft(){return e.substring(ct,at)}function pt(t,e){return{type:"literal",text:t,ignoreCase:e}}function dt(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function gt(t){return{type:"other",description:t}}function mt(t){var r,n=ot[t];if(n)return n;for(r=t-1;!ot[r];)r--;for(n={line:(n=ot[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return ot[t]=n,n}function _t(t,e){var r=mt(t),n=mt(e);return{start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function yt(t){at<ut||(at>ut&&(ut=at,lt=[]),lt.push(t))}function vt(){var t,r,n;return ht++,r=at,At()!==c?(e.substr(at,4)===h?(n=h,at+=4):(n=c,0===ht&&yt(f)),n!==c&&At()!==c?(ct=r,r=[]):(at=r,r=c)):(at=r,r=c),ht--,r===c&&0===ht&&yt(l),(t=r)===c&&(t=function(){var t,e;if(t=[],(e=wt())!==c)for(;e!==c;)t.push(e),e=wt();else t=c;return t}()),t}function wt(){var t,r,n,s;return t=at,At()!==c&&(r=function(){var t,r,n;return ht++,t=at,(r=xt())!==c?(40===e.charCodeAt(at)?(n="(",at++):(n=c,0===ht&&yt(b)),n!==c?(ct=t,t=r=r):(at=t,t=c)):(at=t,t=c),ht--,t===c&&(r=c,0===ht&&yt(w)),t}())!==c&&At()!==c?((n=function(){var t,r,n,s,i,a,o,u;if(t=at,(r=bt())!==c){for(n=[],s=at,(i=At())!==c?(44===e.charCodeAt(at)?(a=d,at++):(a=c,0===ht&&yt(g)),a===c&&(a=null),a!==c&&(o=At())!==c&&(u=bt())!==c?s=i=[i,a,o,u]:(at=s,s=c)):(at=s,s=c);s!==c;)n.push(s),s=at,(i=At())!==c?(44===e.charCodeAt(at)?(a=d,at++):(a=c,0===ht&&yt(g)),a===c&&(a=null),a!==c&&(o=At())!==c&&(u=bt())!==c?s=i=[i,a,o,u]:(at=s,s=c)):(at=s,s=c);n!==c?(ct=t,t=r=m(r,n)):(at=t,t=c)}else at=t,t=c;return t}())===c&&(n=null),n!==c&&At()!==c?(41===e.charCodeAt(at)?(s=")",at++):(s=c,0===ht&&yt(p)),s!==c&&At()!==c?(ct=t,t=function(t,e){return{type:"function",name:t,parameters:e||[]}}(r,n)):(at=t,t=c)):(at=t,t=c)):(at=t,t=c),t}function bt(){var t,r;return t=at,(r=function(){var t,r,n;return ht++,t=at,At()!==c&&(r=Mt())!==c?(37===e.charCodeAt(at)?(n="%",at++):(n=c,0===ht&&yt(F)),n!==c?(ct=t,t=function(t){return{value:t,unit:"%"}}(r)):(at=t,t=c)):(at=t,t=c),ht--,t===c&&0===ht&&yt(C),t}())===c&&(r=function(){var t,r,n;return ht++,t=at,At()!==c&&(r=Mt())!==c?(e.substr(at,2)===R?(n=R,at+=2):(n=c,0===ht&&yt(S)),n!==c?(ct=t,t=function(t){return{value:t,unit:"px"}}(r)):(at=t,t=c)):(at=t,t=c),t===c&&(t=at,At()!==c&&(r=Mt())!==c?(e.substr(at,2)===T?(n=T,at+=2):(n=c,0===ht&&yt(k)),n!==c?(ct=t,t=function(t){return{value:t,unit:"cm"}}(r)):(at=t,t=c)):(at=t,t=c),t===c&&(t=at,At()!==c&&(r=Mt())!==c?(e.substr(at,2)===L?(n=L,at+=2):(n=c,0===ht&&yt(O)),n!==c?(ct=t,t=function(t){return{value:t,unit:"mm"}}(r)):(at=t,t=c)):(at=t,t=c),t===c&&(t=at,At()!==c&&(r=Mt())!==c?(e.substr(at,2)===$?(n=$,at+=2):(n=c,0===ht&&yt(j)),n!==c?(ct=t,t=function(t){return{value:t,unit:"in"}}(r)):(at=t,t=c)):(at=t,t=c),t===c&&(t=at,At()!==c&&(r=Mt())!==c?(e.substr(at,2)===P?(n=P,at+=2):(n=c,0===ht&&yt(q)),n!==c?(ct=t,t=function(t){return{value:t,unit:"pt"}}(r)):(at=t,t=c)):(at=t,t=c),t===c&&(t=at,At()!==c&&(r=Mt())!==c?(e.substr(at,2)===I?(n=I,at+=2):(n=c,0===ht&&yt(X)),n!==c?(ct=t,t=function(t){return{value:t,unit:"pc"}}(r)):(at=t,t=c)):(at=t,t=c)))))),ht--,t===c&&0===ht&&yt(E),t}())===c&&(r=function(){var t,r,n;return ht++,t=at,(r=Mt())!==c?(e.substr(at,3)===z?(n=z,at+=3):(n=c,0===ht&&yt(D)),n!==c?(ct=t,t=r=function(t){return{value:t,unit:"deg"}}(r)):(at=t,t=c)):(at=t,t=c),t===c&&(t=at,(r=Mt())!==c?(e.substr(at,3)===J?(n=J,at+=3):(n=c,0===ht&&yt(N)),n!==c?(ct=t,t=r=function(t){return{value:t,unit:"rad"}}(r)):(at=t,t=c)):(at=t,t=c),t===c&&(t=at,(r=Mt())!==c?(e.substr(at,4)===U?(n=U,at+=4):(n=c,0===ht&&yt(B)),n!==c?(ct=t,t=r=function(t){return{value:t,unit:"grad"}}(r)):(at=t,t=c)):(at=t,t=c),t===c&&(t=at,(r=Mt())!==c?(e.substr(at,4)===G?(n=G,at+=4):(n=c,0===ht&&yt(H)),n!==c?(ct=t,t=r=function(t){return{value:t,unit:"turn"}}(r)):(at=t,t=c)):(at=t,t=c)))),ht--,t===c&&(r=c,0===ht&&yt(Y)),t}())===c&&(r=function(){var t,e;return ht++,t=at,At()!==c&&(e=Mt())!==c?(ct=t,t=function(t){return{value:t,unit:null}}(e)):(at=t,t=c),ht--,t===c&&0===ht&&yt(K),t}()),r!==c&&(ct=t,r=function(t){return{type:"quantity",value:t.value,unit:t.unit}}(r)),(t=r)===c&&(t=at,(r=function(){var t,r,n,s;if(ht++,t=at,35===e.charCodeAt(at)?(r="#",at++):(r=c,0===ht&&yt(V)),r!==c){if(n=[],W.test(e.charAt(at))?(s=e.charAt(at),at++):(s=c,0===ht&&yt(Z)),s!==c)for(;s!==c;)n.push(s),W.test(e.charAt(at))?(s=e.charAt(at),at++):(s=c,0===ht&&yt(Z));else n=c;n!==c?(ct=t,t=r={type:"hex",value:ft()}):(at=t,t=c)}else at=t,t=c;return t===c&&(t=at,(r=wt())!==c&&(ct=t,r=function(t){return{type:"function",value:t}}(r)),(t=r)===c&&(t=at,(r=xt())!==c&&(ct=t,r={type:"named",value:ft()}),t=r)),ht--,t===c&&(r=c,0===ht&&yt(Q)),t}())!==c&&(ct=t,r=function(t){return{type:"color",colorType:t.type,value:t.value}}(r)),t=r),t}function At(){var t,r;for(ht++,t=[],y.test(e.charAt(at))?(r=e.charAt(at),at++):(r=c,0===ht&&yt(v));r!==c;)t.push(r),y.test(e.charAt(at))?(r=e.charAt(at),at++):(r=c,0===ht&&yt(v));return ht--,t===c&&(r=c,0===ht&&yt(_)),t}function xt(){var t,r,n;if(ht++,t=at,r=[],x.test(e.charAt(at))?(n=e.charAt(at),at++):(n=c,0===ht&&yt(M)),n!==c)for(;n!==c;)r.push(n),x.test(e.charAt(at))?(n=e.charAt(at),at++):(n=c,0===ht&&yt(M));else r=c;return r!==c&&(ct=t,r=ft()),ht--,(t=r)===c&&(r=c,0===ht&&yt(A)),t}function Mt(){var t,r,n,s,i,a,o,u;if(t=at,tt.test(e.charAt(at))?(r=e.charAt(at),at++):(r=c,0===ht&&yt(et)),r===c&&(r=null),r!==c){for(n=at,s=[],rt.test(e.charAt(at))?(i=e.charAt(at),at++):(i=c,0===ht&&yt(nt));i!==c;)s.push(i),rt.test(e.charAt(at))?(i=e.charAt(at),at++):(i=c,0===ht&&yt(nt));if(s!==c)if(46===e.charCodeAt(at)?(i=".",at++):(i=c,0===ht&&yt(st)),i!==c){if(a=[],rt.test(e.charAt(at))?(o=e.charAt(at),at++):(o=c,0===ht&&yt(nt)),o!==c)for(;o!==c;)a.push(o),rt.test(e.charAt(at))?(o=e.charAt(at),at++):(o=c,0===ht&&yt(nt));else a=c;a!==c?n=s=[s,i,a]:(at=n,n=c)}else at=n,n=c;else at=n,n=c;if(n===c)if(n=[],rt.test(e.charAt(at))?(s=e.charAt(at),at++):(s=c,0===ht&&yt(nt)),s!==c)for(;s!==c;)n.push(s),rt.test(e.charAt(at))?(s=e.charAt(at),at++):(s=c,0===ht&&yt(nt));else n=c;if(n!==c){if(s=at,101===e.charCodeAt(at)?(i="e",at++):(i=c,0===ht&&yt(it)),i!==c)if(tt.test(e.charAt(at))?(a=e.charAt(at),at++):(a=c,0===ht&&yt(et)),a===c&&(a=null),a!==c){if(o=[],rt.test(e.charAt(at))?(u=e.charAt(at),at++):(u=c,0===ht&&yt(nt)),u!==c)for(;u!==c;)o.push(u),rt.test(e.charAt(at))?(u=e.charAt(at),at++):(u=c,0===ht&&yt(nt));else o=c;o!==c?s=i=[i,a,o]:(at=s,s=c)}else at=s,s=c;else at=s,s=c;s===c&&(s=null),s!==c?(ct=t,t=r=parseFloat(ft())):(at=t,t=c)}else at=t,t=c}else at=t,t=c;return t}if((n=u())!==c&&at===e.length)return n;throw n!==c&&at<e.length&&yt({type:"end"}),s=lt,i=ut<e.length?e.charAt(ut):null,a=ut<e.length?_t(ut,ut+1):_t(ut,ut),new t(t.buildMessage(s,i),s,i,a)}}}())}));function E(t){let e;try{e=t?F.parse(t):[]}catch(n){return{input:t,parsedFunctions:[],effects:[],error:new u("effect:invalid-syntax","Invalid effect syntax",{input:t,error:n})}}const r={input:t,parsedFunctions:e,effects:[],error:null};try{for(const t of e)r.effects.push(R(t))}catch(s){r.effects.length=0,r.error=s}return r}function R(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return function(t){let e=1;return S(t.parameters,1),1===t.parameters.length&&(e=$(t.parameters[0])),new b(t.name,e)}(t);case"opacity":return function(t){let e=1;return S(t.parameters,1),1===t.parameters.length&&(e=$(t.parameters[0])),new M(e)}(t);case"hue-rotate":return function(t){let e=0;var r;return S(t.parameters,1),1===t.parameters.length&&(function(t){if("quantity"!==t.type||(0!==t.value||null!==t.unit)&&null==L[t.unit])throw new u("effect:type-error",`Expected <angle>, Actual: ${T(t)}`,{term:t})}(r=t.parameters[0]),e=r.value*L[r.unit]||0),new x(e)}(t);case"blur":return function(t){let e=0;return S(t.parameters,1),1===t.parameters.length&&(e=j(t.parameters[0]),k(e,t.parameters[0])),new w(e)}(t);case"drop-shadow":return function(t){const e=[];let r;for(const n of t.parameters)if("color"===n.type){if(e.length&&Object.freeze(e),r)throw new u("effect:type-error","Accepts only one color",{});r=P(n)}else{const t=j(n);if(Object.isFrozen(e))throw new u("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(t),3===e.length&&k(t,n)}if(e.length<2||e.length>3)throw new u("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new A(e[0],e[1],e[2]||0,r||q("black"))}(t);case"bloom":return function(t){let e=1,r=0,n=0;return S(t.parameters,3),t.parameters[0]&&(e=$(t.parameters[0])),t.parameters[1]&&(r=j(t.parameters[1]),k(r,t.parameters[1])),t.parameters[2]&&(n=$(t.parameters[2])),new v(e,r,n)}(t)}}catch(e){throw e.details.filter=t,e}throw new u("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function S(t,e){if(t.length>e)throw new u("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function T(t){return"color"===t.type?"<color>":O[t.unit]?"<length>":L[t.unit]?"<angle>":"%"===t.unit?"<percentage>":"<double>"}function k(t,e){if(t<0)throw new u("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}const L={deg:1,grad:.9,rad:180/Math.PI,turn:360},O={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/73};function $(t){!function(t){if("quantity"!==t.type||null!==t.unit&&"%"!==t.unit)throw new u("effect:type-error",`Expected <double> or <percentage>, Actual: ${T(t)}`,{term:t})}(t);const e=t.value;return k(e,t),"%"===t.unit?.01*e:e}function j(t){return function(t){if("quantity"!==t.type||(0!==t.value||null!==t.unit)&&null==O[t.unit])throw new u("effect:type-error",`Expected <length>, Actual: ${T(t)}`,{term:t})}(t),t.value*O[t.unit]||0}function P(t){switch(t.colorType){case"hex":return h(t.value);case"named":return q(t.value);case"function":return function(t){if(S(t.parameters,4),I.test(t.name))return[$(t.parameters[0]),$(t.parameters[1]),$(t.parameters[2]),t.parameters[3]?$(t.parameters[3]):1];if(X.test(t.name))return l(function(t){return function(t){if("quantity"!==t.type||null!==t.unit)throw new u("effect:type-error",`Expected <double>, Actual: ${T(t)}`,{term:t})}(t),k(t.value,t),t.value}(t.parameters[0]),$(t.parameters[1]),$(t.parameters[2]),t.parameters[3]?$(t.parameters[3]):1);throw new u("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}(t.value)}}function q(t){const e=f(t);if(!e)throw new u("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return e}const I=/^rgba?/i,X=/^hsla?/i;function Y(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new b(t.type,0);case"saturate":case"brightness":case"contrast":return new b(t.type,1);case"opacity":return new M(1);case"hue-rotate":return new x(0);case"blur":return new w(0);case"drop-shadow":return new A(0,0,0,[...g("transparent")]);case"bloom":return new v(0,0,0)}}function z(t,e){const r=t.length>e.length?t:e;return(t.length>e.length?e:t).every(((t,e)=>t.type===r[e].type))}function D(t,e){const r=t.length>e.length?t:e,n=t.length>e.length?e:t;for(let s=n.length;s<r.length;s++)n.push(Y(r[s]))}function J(t,e,r){return t+(e-t)*r}class N{constructor(t=200){this.duration=t,this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this._effect="",this._effects=[],this._scale=0}get effect(){return this._effect}set effect(t){if(t=t||"",this._effect===t)return;this._effect=t;const e=function(t){if(!t)return[];if("string"==typeof t){const e=E(t);return e.error?e.error:[{scale:-1,effects:e.effects}]}const e=[];for(const r of t){if(!isFinite(r.scale)||r.scale<=0)return new u("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});const t=E(r.value);if(t.error)return t.error;e.push({scale:r.scale,effects:t.effects})}e.sort(((t,e)=>e.effects.length-t.effects.length));for(let r=0;r<e.length-1;r++){if(!z(e[r].effects,e[r+1].effects))return new u("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[r].effects,b:e[r+1].effects});D(e[r].effects,e[r+1].effects)}return e.sort(((t,e)=>e.scale-t.scale)),e}(t);Array.isArray(e)?this._transitionTo(e):(this._transitionTo([]),p.getLogger("esri.views.layers.effects.EffectList").warn("Invalid Effect",{effect:t,error:e}))}get hasEffects(){return this.transitioning||!!this._effects.length}get effects(){return this._effects}get scale(){return this._scale}get transitioning(){return null!==this._to}transitionStep(t,e){this._applyTimeTransition(t),this._updateForScale(e)}_transitionTo(t){this.scale>0&&function(t,e,r){var n,s,i,a;return null==(n=t[0])||!n.effects||null==(s=e[0])||!s.effects||!((-1===(null==(i=t[0])?void 0:i.scale)||-1===(null==(a=e[0])?void 0:a.scale))&&(t.length>1||e.length>1)&&r<=0)&&z(t[0].effects,e[0].effects)}(this._current,t,this.scale)?(this._final=t,this._to=d(t),function(t,e,r){var n,s;const i=t.length>e.length?t:e,a=t.length>e.length?e:t,c=a[a.length-1],o=null!=(n=null==c?void 0:c.scale)?n:r,u=null!=(s=null==c?void 0:c.effects)?s:[];for(let l=a.length;l<i.length;l++)a.push({scale:o,effects:[...u]});for(let l=0;l<i.length;l++)a[l].scale=-1===a[l].scale?r:a[l].scale,i[l].scale=-1===i[l].scale?r:i[l].scale,D(a[l].effects,i[l].effects)}(this._current,this._to,this.scale),this._from=d(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=t),this._effects=this._current[0]?d(this._current[0].effects):[]}_applyTimeTransition(t){if(!this._to)return;this._time+=t;const e=Math.min(1,this._time/this.duration);for(let r=0;r<this._current.length;r++){const t=this._current[r],n=this._from[r],s=this._to[r];t.scale=J(n.scale,s.scale,e);for(let r=0;r<t.effects.length;r++){const i=t.effects[r],a=n.effects[r],c=s.effects[r];i.interpolate(a,c,e)}}1===e&&(this._current=this._final,this._effects=this._current[0]?d(this._current[0].effects):[],this._from=this._to=this._final=null)}_updateForScale(t){if(0===this._current.length)return;this._scale=t;const e=this._current,r=this._current.length-1;let n,s,i=1;if(1===e.length||t>=e[0].scale)s=n=e[0].effects;else if(t<=e[r].scale)s=n=e[r].effects;else for(let a=0;a<r;a++){const r=e[a],c=e[a+1];if(r.scale>=t&&c.scale<=t){i=(t-r.scale)/(c.scale-r.scale),n=r.effects,s=c.effects;break}}for(let a=0;a<this._effects.length;a++)this._effects[a].interpolate(n[a],s[a],i)}}const U=m("mapview-transitions-duration");class B extends _{constructor(){super(...arguments),this._childrenSet=new Set,this.children=[],this._effectList=null}get blendMode(){return this._blendMode}set blendMode(t){this._blendMode=t,this.requestRender()}get clips(){return this._clips}set clips(t){this._clips=t,this.children.forEach((e=>e.clips=t))}get computedEffects(){var t,e;return null!=(t=null==(e=this._effectList)?void 0:e.effects)?t:null}get effect(){var t,e;return null!=(t=null==(e=this._effectList)?void 0:e.effect)?t:""}set effect(t){(this._effectList||t)&&(this._effectList||(this._effectList=new N(U)),this._effectList.effect=t,this.requestRender())}updateTransitionProperties(t,e){super.updateTransitionProperties(t,e),this._effectList&&(this._effectList.transitionStep(t,e),this._effectList.transitioning&&this.requestRender())}doRender(t){const e=this.createRenderParams(t);this.renderChildren(e)}addChild(t){return this.addChildAt(t,this.children.length)}addChildAt(t,e=this.children.length){if(!t)return t;if(this.contains(t))return t;const r=t.parent;return r&&r!==this&&r.removeChild(t),e>=this.children.length?this.children.push(t):this.children.splice(e,0,t),this._childrenSet.add(t),t.parent=this,t.stage=this.stage,this!==this.stage&&(t.clips=this.clips),this.requestRender(),t}contains(t){return this._childrenSet.has(t)}removeAllChildren(){this._childrenSet.clear();for(const t of this.children)this!==this.stage&&(t.clips=null),t.stage=null,t.parent=null;this.children.length=0}removeChild(t){return this.contains(t)?this.removeChildAt(this.children.indexOf(t)):t}removeChildAt(t){let e;return t<0||t>=this.children.length?null:(e=this.children.splice(t,1)[0],this._childrenSet.delete(e),this!==this.stage&&(e.clips=null),e.stage=null,e.parent=null,e)}sortChildren(t){return this.children.sort(t)}onAttach(){super.onAttach();const t=this.stage;for(const e of this.children)e.stage=t}onDetach(){super.onDetach();for(const t of this.children)t.stage=null}renderChildren(t){for(const e of this.children)e.beforeRender(t);for(const e of this.children)e.processRender(t);for(const e of this.children)e.afterRender(t)}createRenderParams(t){return i(i({},t),{blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:t.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition})}}export{N as P,B as r};
