var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,i=Object.getOwnPropertySymbols,r=Object.prototype.propertyIsEnumerable,s=(t,i,r)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r,n=(e,n)=>{for(var a in n||(n={}))t.call(n,a)&&s(e,a,n[a]);if(i)for(var a of i(n))r.call(n,a)&&s(e,a,n[a]);return e};import{e as a,y as l,i as o,a as c,b as d,o as u,u as p,d as y,c as h,s as m,j as f,f as g,g as b,h as v,p as w,k as _,U as L,t as S,l as I,O as x,m as M,z as E,n as C,q as k,x as A,w as F,r as T,v as R,A as O,B as D,E as P,C as z,D as V,F as j,G as N,H as B,I as q,J as G,K as $,L as U,M as H,N as W,P as Z,Q,R as J,S as Y,T as K,V as X,W as ee,X as te,Y as ie,Z as re,_ as se,$ as ne,a0 as ae,a1 as le,a2 as oe,a3 as ce,a4 as de,a5 as ue,a6 as pe,a7 as ye,a8 as he,a9 as me,aa as fe,ab as ge,ac as be,ad as ve,ae as we,af as _e,ag as Le,ah as Se,ai as Ie,aj as xe,ak as Me,al as Ee,am as Ce,an as ke,ao as Ae,ap as Fe,aq as Te,ar as Re,as as Oe,at as De,au as Pe,av as ze,aw as Ve,ax as je,ay as Ne,az as Be,aA as qe,aB as Ge,aC as $e,aD as Ue,aE as He,aF as We,aG as Ze,aH as Qe,aI as Je,aJ as Ye,aK as Ke,aL as Xe,aM as et,aN as tt,aO as it,aP as rt,aQ as st,aR as nt,aS as at,aT as lt,aU as ot,aV as ct,aW as dt,aX as ut,aY as pt,aZ as yt,a_ as ht,a$ as mt,b0 as ft,b1 as gt,b2 as bt,b3 as vt,b4 as wt,b5 as _t,b6 as Lt,b7 as St,b8 as It,b9 as xt,ba as Mt,bb as Et,bc as Ct,bd as kt,be as At,bf as Ft,bg as Tt,bh as Rt,bi as Ot,bj as Dt,bk as Pt,bl as zt,bm as Vt,bn as jt,bo as Nt,bp as Bt,bq as qt,br as Gt,bs as $t,bt as Ut,bu as Ht,bv as Wt,bw as Zt,bx as Qt,by as Jt,bz as Yt,bA as Kt,bB as Xt,bC as ei,bD as ti}from"./vendor.1ee57f36.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(i){const r=new URL(e,location),s=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((i,n)=>{const a=new URL(e,r);if(self[t].moduleMap[a])return i(self[t].moduleMap[a]);const l=new Blob([`import * as m from '${a}';`,`${t}.moduleMap['${a}']=m;`],{type:"text/javascript"}),o=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(l),onerror(){n(new Error(`Failed to import: ${e}`)),s(o)},onload(){i(self[t].moduleMap[a]),s(o)}});document.head.appendChild(o)})),self[t].moduleMap={}}}("/assets/");var ii;let ri=ii=class extends c{constructor(e){super(e),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new ii({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};a([l({type:String,json:{write:!0}})],ri.prototype,"expression",void 0),a([l({type:String,json:{write:!0}})],ri.prototype,"name",void 0),a([l({type:["boolean"],json:{write:!0}})],ri.prototype,"returnType",void 0),a([l({type:String,json:{write:!0}})],ri.prototype,"title",void 0),ri=ii=a([o("esri.form.ExpressionInfo")],ri);var si=ri;const ni=e=>{let t=class extends e{constructor(){super(...arguments),this.description=null,this.label=null,this.visibilityExpression=null}};return a([l({type:String,json:{write:!0}})],t.prototype,"description",void 0),a([l({type:String,json:{write:!0}})],t.prototype,"label",void 0),a([l({type:String,json:{write:!0}})],t.prototype,"visibilityExpression",void 0),t=a([o("esri.form.elements.ElementMixin")],t),t};let ai=class extends(ni(c)){constructor(e){super(e),this.type=null}};var li;a([l()],ai.prototype,"type",void 0),ai=a([o("esri.form.elements.Element")],ai);let oi=li=class extends c{constructor(e){super(e),this.type=null}clone(){return new li({type:this.type})}};a([l({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],oi.prototype,"type",void 0),oi=li=a([o("esri.form.elements.inputs.AttachmentInput")],oi);var ci,di=oi;let ui=ci=class extends ai{constructor(e){super(e),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new ci({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};a([l({type:String,json:{write:!0}})],ui.prototype,"attachmentKeyword",void 0),a([l({type:Boolean,json:{default:!0,write:!0}})],ui.prototype,"editable",void 0),a([l({type:di,json:{read:{source:"inputType"},write:{target:"inputType"}}})],ui.prototype,"input",void 0),a([l({type:["attachment"],json:{read:!1,write:!0}})],ui.prototype,"type",void 0),ui=ci=a([o("esri.form.elements.AttachmentElement")],ui);var pi=ui;let yi=class extends c{constructor(e){super(e),this.type=null}};a([l()],yi.prototype,"type",void 0),yi=a([o("esri.form.elements.inputs.Input")],yi);var hi,mi=yi;let fi=hi=class extends mi{constructor(e){super(e),this.type="barcode-scanner"}clone(){return new hi}};a([l({type:["barcode-scanner"],json:{read:!1,write:!0}})],fi.prototype,"type",void 0),fi=hi=a([o("esri.form.elements.inputs.BarcodeScannerInput")],fi);var gi,bi=fi;let vi=gi=class extends mi{constructor(e){super(e),this.type="combo-box"}clone(){return new gi}};a([l({type:["combo-box"],json:{read:!1,write:!0}})],vi.prototype,"type",void 0),vi=gi=a([o("esri.form.elements.inputs.ComboBoxInput")],vi);var wi,_i=vi;function Li(e){return null!=e?new Date(e):null}function Si(e){return e?e.getTime():null}let Ii=wi=class extends mi{constructor(e){super(e),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(e,t){return Li(t.max)}writeMax(e,t){t.max=Si(e)}readMin(e,t){return Li(t.min)}writeMin(e,t){t.min=Si(e)}clone(){return new wi({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})}};a([l({type:Boolean,json:{write:!0,default:!1}})],Ii.prototype,"includeTime",void 0),a([l({type:Date,json:{type:Number,write:!0}})],Ii.prototype,"max",void 0),a([d("max")],Ii.prototype,"readMax",null),a([u("max")],Ii.prototype,"writeMax",null),a([l({type:Date,json:{type:Number,write:!0}})],Ii.prototype,"min",void 0),a([d("min")],Ii.prototype,"readMin",null),a([u("min")],Ii.prototype,"writeMin",null),a([l({type:["datetime-picker"],json:{read:!1,write:!0}})],Ii.prototype,"type",void 0),Ii=wi=a([o("esri.form.elements.inputs.DateTimePickerInput")],Ii);var xi,Mi=Ii;let Ei=xi=class extends mi{constructor(e){super(e),this.type="radio-buttons"}clone(){return new xi}};a([l({type:["radio-buttons"],json:{read:!1,write:!0}})],Ei.prototype,"type",void 0),Ei=xi=a([o("esri.form.elements.inputs.RadioButtonsInput")],Ei);var Ci,ki=Ei;let Ai=Ci=class extends mi{constructor(e){super(e),this.maxLength=null,this.minLength=0,this.type=null}clone(){return new Ci({maxLength:this.maxLength,minLength:this.minLength,type:this.type})}};a([l({type:Number,json:{write:!0}})],Ai.prototype,"maxLength",void 0),a([l({type:Number,json:{default:0,write:!0}})],Ai.prototype,"minLength",void 0),a([l()],Ai.prototype,"type",void 0),Ai=Ci=a([o("esri.form.elements.inputs.support.TextInput")],Ai);var Fi=Ai;let Ti=class extends Fi{constructor(e){super(e),this.type="text-area"}};a([l({type:["text-area"],json:{read:!1,write:!0}})],Ti.prototype,"type",void 0),Ti=a([o("esri.form.elements.inputs.TextAreaInput")],Ti);var Ri=Ti;let Oi=class extends Fi{constructor(e){super(e),this.type="text-box"}};a([l({type:["text-box"],json:{read:!1,write:!0}})],Oi.prototype,"type",void 0),Oi=a([o("esri.form.elements.inputs.TextBoxInput")],Oi);const Di={base:mi,key:"type",typeMap:{"barcode-scanner":bi,"combo-box":_i,"datetime-picker":Mi,"radio-buttons":ki,"text-area":Ri,"text-box":Oi}};var Pi;let zi=Pi=class extends ai{constructor(e){super(e),this.domain=null,this.editable=!0,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field"}clone(){return new Pi({description:this.description,domain:this.domain,editable:this.editable,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,visibilityExpression:this.visibilityExpression})}};a([l({types:p,json:{read:{reader:y},write:!0}})],zi.prototype,"domain",void 0),a([l({type:Boolean,json:{default:!0,write:!0}})],zi.prototype,"editable",void 0),a([l({type:String,json:{write:!0}})],zi.prototype,"fieldName",void 0),a([l({type:String,json:{write:!0}})],zi.prototype,"hint",void 0),a([l({types:Di,json:{read:{source:"inputType"},write:{target:"inputType"}}})],zi.prototype,"input",void 0),a([l({type:String,json:{write:!0}})],zi.prototype,"requiredExpression",void 0),a([l({type:String,json:{read:!1,write:!0}})],zi.prototype,"type",void 0),zi=Pi=a([o("esri.form.elements.FieldElement")],zi);var Vi,ji=zi;let Ni=Vi=class extends ai{constructor(e){super(e),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new Vi({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:m(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};a([l({type:Number,json:{write:!0}})],Ni.prototype,"displayCount",void 0),a([l({type:["list"],json:{write:!0}})],Ni.prototype,"displayType",void 0),a([l({type:Boolean,json:{default:!0,write:!0}})],Ni.prototype,"editable",void 0),a([l({type:[h],json:{write:!0}})],Ni.prototype,"orderByFields",void 0),a([l({type:Number,json:{write:!0}})],Ni.prototype,"relationshipId",void 0),a([l({type:["relationship"],json:{read:!1,write:!0}})],Ni.prototype,"type",void 0),Ni=Vi=a([o("esri.form.elements.RelationshipElement")],Ni);var Bi,qi=Ni;function Gi(e){return{typesWithGroup:{base:ai,key:"type",typeMap:{attachment:pi,field:ji,group:e,relationship:qi}},typesWithoutGroup:{base:ai,key:"type",typeMap:{attachment:pi,field:ji,relationship:qi}}}}function $i(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((e=>r[e.type])).map((e=>r[e.type].fromJSON(e)))}function Ui(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((e=>r[e.type])).map((e=>e.toJSON()))}function Hi(e,t,i=!0){return e?e.map((e=>f(i?t.typesWithGroup:t.typesWithoutGroup,e))):null}let Wi=Bi=class extends ai{constructor(e){super(e),this.elements=null,this.initialState="expanded",this.type="group"}castElements(e){return Hi(e,Zi,!1)}readElements(e,t){return $i(t.formElements,Zi,!1)}writeElements(e,t){t.formElements=Ui(e,Zi,!1)}clone(){return new Bi({description:this.description,elements:m(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};a([l({json:{write:!0}})],Wi.prototype,"elements",void 0),a([g("elements")],Wi.prototype,"castElements",null),a([d("elements",["formElements"])],Wi.prototype,"readElements",null),a([u("elements")],Wi.prototype,"writeElements",null),a([l({type:["collapsed","expanded"],json:{default:"expanded",write:!0}})],Wi.prototype,"initialState",void 0),a([l({type:String,json:{read:!1,write:!0}})],Wi.prototype,"type",void 0),Wi=Bi=a([o("esri.form.elements.GroupElement")],Wi);const Zi=Gi(Wi);var Qi;const Ji=Gi(Wi);let Yi=Qi=class extends c{constructor(e){super(e),this.description=null,this.elements=null,this.expressionInfos=null,this.title=null}castElements(e){return Hi(e,Ji)}readElements(e,t){return $i(t.formElements,Ji)}writeElements(e,t){t.formElements=Ui(e,Ji)}clone(){return new Qi({description:this.description,expressionInfos:m(this.expressionInfos),elements:m(this.elements),title:this.title})}};a([l({type:String,json:{write:!0}})],Yi.prototype,"description",void 0),a([l({json:{write:!0}})],Yi.prototype,"elements",void 0),a([g("elements")],Yi.prototype,"castElements",null),a([d("elements",["formElements"])],Yi.prototype,"readElements",null),a([u("elements")],Yi.prototype,"writeElements",null),a([l({type:[si],json:{write:!0}})],Yi.prototype,"expressionInfos",void 0),a([l({type:String,json:{write:!0}})],Yi.prototype,"title",void 0),Yi=Qi=a([o("esri.form.FormTemplate")],Yi);var Ki=Yi;let Xi=0;const er=b.getLogger("esri.layers.graphics.sources.MemorySource");let tr=class extends(v.LoadableMixin(w(P))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const t=_(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),L(this)}destroy(){var e;null==(e=this._connection)||e.close(),this._connection=null}get workerGeometryType(){const e=this.layer&&this.layer.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then((()=>this._applyEdits(e)))}openPorts(){return this.load().then((()=>this._connection.openPorts()))}async queryFeatures(e,t={}){await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);S(e,this.layer.spatialReference,i);const r=I.fromJSON(i);if(!this._requiresClientGraphicMapping())return r;const s=this.layer.objectIdField;for(const n of r.features){const e=n.attributes[s],t=this._idToClientGraphic.get(e);t&&(n.geometry=t.geometry)}return r.geometryType=this.layer.geometryType,r}async queryFeaturesJSON(e,t={}){if(this._requiresClientGraphicMapping())return x(new M("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)"));await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return S(e,this.layer.spatialReference,i),i}queryFeatureCount(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t)))}queryObjectIds(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t)))}queryExtent(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t))).then((e=>({count:e.count,extent:E.fromJSON(e.extent)})))}_applyEdits(e){if(!this._connection)throw new M("feature-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField;let i=null;const r=[],s=[],n=e=>"objectId"in e&&null!=e.objectId?e.objectId:"attributes"in e&&null!=e.attributes[t]?e.attributes[t]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const l of e.deleteFeatures){const e=n(l);null!=e&&r.push(e)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures)for(const l of e.updateFeatures)if(s.push(this._serializeFeature(l)),a){const e=n(l);null!=e&&a.set(e,l)}return C(i?i.features:null,s,this.layer.spatialReference),this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:s,deletes:r}).then((({fullExtent:e,featureEditResults:t})=>{if(this.fullExtent=e,i&&i.finish(t.uidToObjectId),this._idToClientGraphic){if(a)for(const e of t.updateResults){if(!e.success)continue;const t=a.get(e.objectId);null!=t&&this._addIdToClientGraphic(t)}for(const e of t.deleteResults)e.success&&this._idToClientGraphic.delete(e.objectId)}return this._createEditsResult(t)}))}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new M("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_prepareAddFeatures(e){const t=new Map,i=new Array(e.length);let r=null;for(let n=0;n<e.length;n++){const s=e[n],a=this._serializeFeature(s);!r&&_(s.geometry)&&(r=s.geometry.type),i[n]=a,t.set(`${a.uid}`,s)}const s=this;return{features:i,inferredGeometryType:r,finish(e){const i=s.sourceJSON.objectIdField;for(const r in e){const n=e[r],a=t.get(r);a&&(a.attributes||(a.attributes={}),-1===n?delete a.attributes[i]:a.attributes[i]=n,s._addIdToClientGraphic(a))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const t=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[t];null!=i&&this._idToClientGraphic.set(i,e)}_requiresClientGraphicMapping(){const e=this.layer.geometryType||this.sourceJSON.geometryType;return this._geometryTypeRequiresClientGraphicMapping(e)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return"mesh"===e||"multipatch"===e||"extent"===e}_serializeFeature(e){const{attributes:t}=e,i=this._geometryForSerialization(e),r=(Xi++).toString();return i?{uid:r,geometry:i.toJSON(),attributes:t}:{uid:r,attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return k(t)?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?A.fromExtent(t.extent):null:t}async _startWorker(e){this._connection=await F("MemorySourceWorker",{strategy:T("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:t,spatialReference:i,objectIdField:r,hasM:s,hasZ:n,timeInfo:a}=this.layer,l="defaults"===this.layer.originOf("spatialReference"),o=this._prepareAddFeatures(this.items);this.on("before-changes",(e=>{er.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),e.preventDefault()}));const c={features:o.features,fields:t&&t.map((e=>e.toJSON())),geometryType:R.toJSON(this.workerGeometryType),hasM:s,hasZ:n,objectIdField:r,spatialReference:l?null:i&&i.toJSON(),timeInfo:a?a.toJSON():null},d=await this._connection.invoke("load",c,{signal:e});for(const p of d.warnings)er.warn(p.message,{layer:this.layer,warning:p});d.featureErrors.length&&er.warn(`Encountered ${d.featureErrors.length} validation errors while loading features`,d.featureErrors);const u=d.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(o.inferredGeometryType)&&(u.geometryType=R.toJSON(o.inferredGeometryType)),"mesh"!==u.geometryType&&"mesh"!==this.layer.geometryType||(u.hasZ=!0),this.sourceJSON=u,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),o.finish(d.assignedObjectIds)}};var ir;a([(ir={Type:O,ensureType:D(O)},(e,t)=>{e[t]=ir})],tr.prototype,"itemType",void 0),a([l()],tr.prototype,"type",void 0),a([l({constructOnly:!0})],tr.prototype,"layer",void 0),a([l({readOnly:!0,dependsOn:["layer.geometryType"]})],tr.prototype,"workerGeometryType",null),a([l()],tr.prototype,"sourceJSON",void 0),tr=a([o("esri.layers.graphics.sources.MemorySource")],tr);var rr,sr=tr;let nr=rr=class extends c{constructor(e){super(e)}clone(){const{name:e,fields:t,isAscending:i,isUnique:r,description:s}=this;return new rr({name:e,fields:t,isAscending:i,isUnique:r,description:s})}};a([l({constructOnly:!0})],nr.prototype,"name",void 0),a([l({constructOnly:!0})],nr.prototype,"fields",void 0),a([l({constructOnly:!0})],nr.prototype,"isAscending",void 0),a([l({constructOnly:!0})],nr.prototype,"isUnique",void 0),a([l({constructOnly:!0})],nr.prototype,"description",void 0),nr=rr=a([o("esri.layers.support.FeatureIndex")],nr);const ar=b.getLogger("esri.layers.support.fieldProperties");function lr(){return{fields:{type:[z],value:null},outFields:{type:[String],dependsOn:["fields"],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e||!e.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const t of e)V(this.fields,t)||ar.error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e});return j(this.fields,e)}}}}const or=/\[([^\[\]]+)\]/gi;function cr(e,t,i){return e?e.map((e=>{const r=new N;if(r.read(e,i),r.labelExpression){const e=t.fields||t.layerDefinition&&t.layerDefinition.fields||this.fields;r.labelExpression=r.labelExpression.replace(or,((t,i)=>`[${function(e,t){if(!t)return e;const i=e.toLowerCase();for(let r=0;r<t.length;r++){const e=t[r].name;if(e.toLowerCase()===i)return e}return e}(i,e)}]`))}return r})):null}const dr=new B({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),ur=new B({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let pr=class extends c{constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};a([l({json:{read:dr.read,write:dr.write}})],pr.prototype,"cardinality",void 0),a([l({json:{read:!0,write:!0}})],pr.prototype,"composite",void 0),a([l({json:{read:!0,write:!0}})],pr.prototype,"id",void 0),a([l({json:{read:!0,write:!0}})],pr.prototype,"keyField",void 0),a([l({json:{read:!0,write:!0}})],pr.prototype,"keyFieldInRelationshipTable",void 0),a([l({json:{read:!0,write:!0}})],pr.prototype,"name",void 0),a([l({json:{read:!0,write:!0}})],pr.prototype,"relatedTableId",void 0),a([l({json:{read:!0,write:!0}})],pr.prototype,"relationshipTableId",void 0),a([l({json:{read:ur.read,write:ur.write}})],pr.prototype,"role",void 0),pr=a([o("esri.layers.support.Relationship")],pr);var yr=pr;async function hr(e,t,i){const r=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(r&&"unique-value"===r.type&&r.styleOrigin){const s=await q(r.populateFromStyle());if(G(i),!1===s.ok){const i=s.error;t&&t.messages&&t.messages.push(new $("renderer:style-reference",`Failed to create unique value renderer from style reference: ${i.message}`,{error:i,context:t})),e.clear("renderer",t.origin)}}}const mr=new B({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),fr={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"},gr="FeatureLayer",br=b.getLogger("esri.layers.FeatureLayer");function vr(e){return e&&e instanceof P}function wr(e,t,i){return!!(e&&e.hasOwnProperty(t)?e[t]:i)}function _r(e,t,i){return e&&e.hasOwnProperty(t)?e[t]:i}const Lr=lr();function Sr(e,t,i){const r=!(null==i||!i.writeLayerSchema);return{enabled:r,ignoreOrigin:r}}let Ir=class extends(U(H(W(Z(Q(J(Y(K(X(He)))))))))){constructor(...e){super(...e),this._handles=new ee,this.capabilities=null,this.charts=null,this.copyright=null,this.displayField=null,this.definitionExpression=null,this.dynamicDataSource=null,this.editFieldsInfo=null,this.editingEnabled=!0,this.editingInfo=null,this.elevationInfo=null,this.featureReduction=null,this.fields=null,this.formTemplate=null,this.fullExtent=null,this.gdbVersion=null,this.geometryProperties=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.layerId=void 0,this.legendEnabled=!0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.screenSizePerspectiveEnabled=!0,this.serviceDefinitionExpression=null,this.spatialReference=te.WGS84,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.trackIdField=null,this.type="feature",this.typeIdField=null,this.types=null,this.indexes=new(P.ofType(nr)),this.userIsAdmin=!1,this.version=void 0,this.visible=!0}destroy(){var e;null==(e=this.source)||e.destroy(),this._handles&&(this._handles.destroy(),this._handles=null)}normalizeCtorArgs(e,t){return"string"==typeof e?n({url:e},t):e}load(e){const t=_(e)?e.signal:null;if(this.portalItem&&this.portalItem.loaded&&this.source)return void this.addResolvingPromise(this.createGraphicsSource(t).then((e=>this._initLayerProperties(e))));const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch((e=>e)).then((async()=>{if(this.url&&null==this.layerId&&/FeatureServer|MapServer\/*$/i.test(this.url)){const e=await this._fetchFirstLayerId(t);null!=e&&(this.layerId=e)}if(!this.url&&!this._hasMemorySource())throw new M("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this._initLayerProperties(await this.createGraphicsSource(t))}));return this.addResolvingPromise(i),L(this)}readCapabilities(e,t){return t=t.layerDefinition||t,{attachment:this._readAttachmentCapabilities(t.attachmentProperties),data:this._readDataCapabilities(t),metadata:this._readMetadataCapabilities(t),operations:this._readOperationsCapabilities(t.capabilities||e,t),query:this._readQueryCapabilities(t),queryRelated:this._readQueryRelatedCapabilities(t),editing:this._readEditingCapabilities(t)}}get createQueryVersion(){return this.definitionExpression,this.dynamicDataSource,this.timeExtent,this.timeOffset,this.geometryType,this.gdbVersion,this.historicMoment,this.returnZ,this.capabilities,this.returnM,(this._get("createQueryVersion")||0)+1}readEditingEnabled(e,t){return this._readEditingEnabled(t,!1)}readEditingEnabledFromWebMap(e,t,i){return this._readEditingEnabled(t,!0,i)}writeEditingEnabled(e,t){this._writeEditingEnabled(e,t,!1)}writeEditingEnabledToWebMap(e,t,i,r){this._writeEditingEnabled(e,t,!0,r)}readEditingInfo(e,t){const{editingInfo:i}=t;return i?{lastEditDate:null!=i.lastEditDate?new Date(i.lastEditDate):null}:null}readFeatureReduction(e,t){return ie(e,t)}writeWebSceneFeatureReduction(e,t,i,r){re(e,t,"layerDefinition.featureReduction",r)}get fieldsIndex(){return new se(this.fields||[])}readIsTable(e,t){return"Table"===(t=t&&t.layerDefinition||t).type||!t.geometryType}writeIsTable(e,t,i,r){null!=r&&r.writeLayerSchema&&ne(i,e?"Table":"Feature Layer",t)}readMinScale(e,t){return t.effectiveMinScale||e||0}readMaxScale(e,t){return t.effectiveMaxScale||e||0}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields)for(const i of t.fields)if("esriFieldTypeGlobalID"===i.type)return i.name}readObjectIdFieldFromService(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields)for(const i of t.fields)if("esriFieldTypeOID"===i.type)return i.name}get parsedUrl(){const e=this.url?ae(this.url):null;return null!=e&&(null!=this.dynamicDataSource?e.path=le(e.path,"dynamicLayer"):null!=this.layerId&&(e.path=le(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){oe(e,this.fields),this._set("renderer",e)}readRenderer(e,t,i){const r=(t=t.layerDefinition||t).drawingInfo&&t.drawingInfo.renderer||void 0;if(r){const e=ce(r,t,i)||void 0;return e||br.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:i}),e}if(t.defaultSymbol)return t.types&&t.types.length?new de({defaultSymbol:xr(t.defaultSymbol,t,i),field:t.typeIdField,uniqueValueInfos:t.types.map((e=>({id:e.id,symbol:xr(e.symbol,e,i)})))}):new ue({symbol:xr(t.defaultSymbol,t,i)})}set source(e){const t=this._get("source");t!==e&&(vr(t)&&this._resetMemorySource(t),vr(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof P?new sr({layer:this,items:e}):e:null}readSource(e,t){const i=I.fromJSON(t.featureSet);return new sr({layer:this,items:i&&i.features||[]})}readServiceDefinitionExpression(e,t){return t.definitionQuery||t.definitionExpression}readTemplates(e,t){const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e=e&&e.map((e=>pe.fromJSON(e))),this._fixTemplates(e,r),this._fixTemplates(e,s),e}readTitle(e,t){const i=t.layerDefinition&&t.layerDefinition.name||t.name,r=t.title||t.layerDefinition&&t.layerDefinition.title;if(i){const e=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return this.url?ye(this.url,i):i;let t=i;if(!t&&this.url){const e=he(this.url);_(e)&&(t=e.title)}if(!t)return;return"item-title-and-service-name"===this.sublayerTitleMode&&e&&e!==t&&(t=e+" - "+t),me(t)}if("item-title"===this.sublayerTitleMode&&r)return r}readTitleFromWebMap(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name}readTypeIdField(e,t){let i=(t=t.layerDefinition||t).typeIdField;if(i){const e=fe(t.fields,i);e&&(i=e.name)}return i}readTypes(e,t){e=(t=t.layerDefinition||t).types;const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e&&e.map((e=>(e=ge.fromJSON(e),this._fixTemplates(e.templates,r),this._fixTemplates(e.templates,s),e)))}set url(e){const t=be(this,e,br);this._set("url",t.url),null!=t.layerId&&this._set("layerId",t.layerId)}writeUrl(e,t,i,r){ve(this,e,null,t,r)}readVersion(e,t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}readVisible(e,t){return t.layerDefinition&&null!=t.layerDefinition.defaultVisibility?!!t.layerDefinition.defaultVisibility:null!=t.visibility?!!t.visibility:void 0}addAttachment(e,t){return this.load().then((()=>this._checkAttachmentSupport(e))).then((()=>{if(!("addAttachment"in this.source))throw new M(gr,"Layer source does not support addAttachment capability");return this.source.addAttachment(e,t)}))}updateAttachment(e,t,i){return this.load().then((()=>this._checkAttachmentSupport(e))).then((()=>{if(!("updateAttachment"in this.source))throw new M(gr,"Layer source does not support updateAttachment capability");return this.source.updateAttachment(e,t,i)}))}async applyEdits(e,t){const i=await import("./editingSupport.3345c9ad.js");return await this.load(),i.applyEdits(this,this.source,e,t)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return we(this,e)}async createGraphicsSource(e){if(this._hasMemorySource())return this.emit("graphics-source-create",{graphicsSource:this.source}),this.source.load({signal:e});const t=await import("./FeatureLayerSource.fda3bdb6.js");G(e);const i=await new t.default({layer:this}).load({signal:e});return this.emit("graphics-source-create",{graphicsSource:i}),i}createQuery(){const e=new _e,t=this.get("capabilities.data");e.dynamicDataSource=this.dynamicDataSource,e.gdbVersion=this.gdbVersion,e.historicMoment=this.historicMoment,e.returnGeometry=!0,t&&(t.supportsZ&&null!=this.returnZ&&(e.returnZ=this.returnZ),t.supportsM&&null!=this.returnM&&(e.returnM=this.returnM)),e.outFields=["*"],e.where=this.definitionExpression||"1=1";const{timeOffset:i,timeExtent:r}=this;return e.timeExtent=null!=i&&null!=r?r.offset(-i.value,i.unit):r||null,e.multipatchOption="multipatch"===this.geometryType?"xyFootprint":null,e}deleteAttachments(e,t){return this.load().then((()=>this._checkAttachmentSupport(e))).then((()=>{if(!("deleteAttachments"in this.source))throw new M(gr,"Layer source does not support deleteAttachments capability");return this.source.deleteAttachments(e,t)}))}fetchRecomputedExtents(e){return this.load({signal:null==e?void 0:e.signal}).then((()=>{if(this.source.fetchRecomputedExtents)return this.source.fetchRecomputedExtents(e);throw new M(gr,"Layer source does not support fetchUpdates capability")}))}getFeatureType(e){const{typeIdField:t,types:i}=this;if(!t||!e)return null;const r=e.attributes?e.attributes[t]:void 0;if(null==r)return null;let s=null;return i.some((e=>{const{id:t}=e;return null!=t&&(t.toString()===r.toString()&&(s=e),!!s)})),s}getFieldDomain(e,t){const i=t&&t.feature,r=this.getFeatureType(i);if(r){const t=r.domains&&r.domains[e];if(t&&"inherited"!==t.type)return t}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}queryAttachments(e,t){return e=Le.from(e),this.load().then((()=>{if(!this.get("capabilities.data.supportsAttachment"))throw new M(gr,"this layer doesn't support attachments");const{attachmentTypes:t,objectIds:i,globalIds:r,num:s,size:n,start:a,where:l}=e;if(!this.get("capabilities.operations.supportsQueryAttachments")){const o=i&&i.length>1,c=t&&t.length,d=r&&r.length,u=n&&n.length;if(o||c||d||u||s||a||l)throw new M(gr,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",e)}if(!(i&&i.length||l))throw new M(gr,"'objectIds' or 'where' are required to perform attachment query",e);if(!("queryAttachments"in this.source))throw new M(gr,"Layer source does not support queryAttachments capability",e);return this.source.queryAttachments(e)}))}queryFeatures(e,t){return this.load().then((()=>this.source.queryFeatures(_e.from(e)||this.createQuery(),t))).then((e=>{if(e&&e.features)for(const t of e.features)t.layer=t.sourceLayer=this;return e}))}queryObjectIds(e,t){return this.load().then((()=>{if(this.source.queryObjectIds)return this.source.queryObjectIds(_e.from(e)||this.createQuery(),t);throw new M(gr,"Layer source does not support queryObjectIds capability")}))}queryFeatureCount(e,t){return this.load().then((()=>{if(this.source.queryFeatureCount)return this.source.queryFeatureCount(_e.from(e)||this.createQuery(),t);throw new M(gr,"Layer source does not support queryFeatureCount capability")}))}queryExtent(e,t){return this.load().then((()=>{if(this.source.queryExtent)return this.source.queryExtent(_e.from(e)||this.createQuery(),t);throw new M(gr,"Layer source does not support queryExtent capability")}))}queryRelatedFeatures(e,t){return this.load().then((()=>{if("queryRelatedFeatures"in this.source)return this.source.queryRelatedFeatures(Se.from(e),t);throw new M(gr,"Layer source does not support queryRelatedFeatures capability")}))}queryRelatedFeaturesCount(e,t){return this.load().then((()=>{if("queryRelatedFeaturesCount"in this.source)return this.source.queryRelatedFeaturesCount(Se.from(e),t);throw new M(gr,"Layer source does not support queryRelatedFeaturesCount capability")}))}read(e,t){const i=e.featureCollection;if(i){const e=i.layers;e&&1===e.length&&(super.read(e[0],t),null!=i.showLegend&&super.read({showLegend:i.showLegend},t))}super.read(e,t),t&&"service"===t.origin&&this.revert(["objectIdField","fields","timeInfo","spatialReference"],"service")}write(e,t){var i,r;const s=(t=n(n({},t),{writeLayerSchema:null!=(i=null==(r=t)?void 0:r.writeLayerSchema)?i:this._hasMemorySource()})).origin,a=t.layerContainerType,l=t.messages;if(this.isTable){if("web-scene"===s||"web-map"===s&&"tables"!==a)return l&&l.push(new M("layer:unsupported",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Table source cannot be written to web scenes and web maps`,{layer:this})),null;if(this._hasMemorySource())return l&&l.push(new M("layer:unsupported",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using an in-memory Table source cannot be written to web scenes and web maps`,{layer:this})),null}else if(this.loaded&&"web-map"===s&&"tables"===a)return l&&l.push(new M("layer:unsupported",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a non-table source cannot be written to tables in web maps`,{layer:this})),null;return super.write(e,t)}_readEditingEnabled(e,t,i){var r;let s=null==(r=e.layerDefinition)?void 0:r.capabilities;return s?this._hasEditingCapability(s):(s=e.capabilities,!(t&&"web-map"===(null==i?void 0:i.origin)&&!this._hasMemorySource()&&s)||this._hasEditingCapability(s))}_hasEditingCapability(e){return e.toLowerCase().split(",").map((e=>e.trim())).includes("editing")}_writeEditingEnabled(e,t,i,r){e||(ne("layerDefinition.capabilities","Query",t),!i||null!=r&&r.writeLayerSchema||(t.capabilities="Query"))}_checkAttachmentSupport(e){const{attributes:t}=e,{objectIdField:i}=this;return this.get("capabilities.data.supportsAttachment")?e?t?t[i]?void 0:x(new M(gr,`feature is missing the identifying attribute ${i}`)):x(new M(gr,"'attributes' are required on a feature to query attachments")):x(new M(gr,"A feature is required to add/delete/update attachments")):x(new M(gr,"this layer doesn't support attachments"))}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}_fetchFirstLayerId(e){return Ie(this.url,{query:n({f:"json"},this.customParameters),responseType:"json",signal:e}).then((e=>{const t=e.data;if(t)return Array.isArray(t.layers)&&t.layers.length>0?t.layers[0].id:Array.isArray(t.tables)&&t.tables.length>0?t.tables[0].id:void 0}))}async _initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",url:this.parsedUrl})),this._verifySource(),this._verifyFields(),oe(this.renderer,this.fields),xe(this.timeInfo,this.fields),hr(this,{origin:"service"})}_verifyFields(){const e=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||-1!==e.search(/\/FeatureServer\//i)||this.fields&&this.fields.some((function(e){return"geometry"===e.type}))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,t){e&&e.forEach((e=>{const i=e.prototype&&e.prototype.attributes;i&&t&&delete i[t]}))}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new M("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new M("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach((e=>{e.layer=this,e.sourceLayer=this})),this._handles.add([e.on("after-add",(e=>{e.item.layer=this,e.item.sourceLayer=this})),e.on("after-remove",(e=>{e.item.layer=null,e.item.sourceLayer=null}))],"fl-source")}_resetMemorySource(e){e.forEach((e=>{e.layer=null,e.sourceLayer=null})),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}_readAttachmentCapabilities(e){const t={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1};return e&&Array.isArray(e)&&e.forEach((e=>{const i=fr[e.name];i&&(t[i]=!!e.isEnabled)})),t}_readDataCapabilities(e){return{isVersioned:wr(e,"isDataVersioned",!1),supportsAttachment:wr(e,"hasAttachments",!1),supportsM:wr(e,"hasM",!1),supportsZ:wr(e,"hasZ",!1)}}_readMetadataCapabilities(e){return{supportsAdvancedFieldProperties:wr(e,"supportsFieldDescriptionProperty",!1)}}_readOperationsCapabilities(e,t){const i=e?e.toLowerCase().split(",").map((e=>e.trim())):[],r=-1!==i.indexOf("editing");let s=r&&-1!==i.indexOf("create"),n=r&&-1!==i.indexOf("delete"),a=r&&-1!==i.indexOf("update");const l=-1!==i.indexOf("changetracking");return r&&!(s||n||a)&&(s=n=a=!0),{supportsCalculate:wr(t,"supportsCalculate",!1),supportsTruncate:wr(t,"supportsTruncate",!1),supportsValidateSql:wr(t,"supportsValidateSql",!1),supportsAdd:s,supportsDelete:n,supportsEditing:r,supportsChangeTracking:l,supportsQuery:-1!==i.indexOf("query"),supportsQueryAttachments:wr(t.advancedQueryCapabilities,"supportsQueryAttachments",!1),supportsResizeAttachments:wr(t,"supportsAttachmentsResizing",!1),supportsSync:-1!==i.indexOf("sync"),supportsUpdate:a,supportsExceedsLimitStatistics:wr(t,"supportsExceedsLimitStatistics",!1)}}_readQueryCapabilities(e){const t=e.advancedQueryCapabilities,i=e.ownershipBasedAccessControlForFeatures,r=e.archivingInfo,s=(e.supportedQueryFormats||"").split(",").reduce(((e,t)=>{const i=t.toLowerCase().trim();return i&&e.add(i),e}),new Set);return{supportsStatistics:wr(t,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:wr(t,"supportsPercentileStatistics",!1),supportsCentroid:wr(t,"supportsReturningGeometryCentroid",!1),supportsDistance:wr(t,"supportsQueryWithDistance",!1),supportsDistinct:wr(t,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:wr(t,"supportsReturningQueryExtent",!1),supportsGeometryProperties:wr(t,"supportsReturningGeometryProperties",!1),supportsHavingClause:wr(t,"supportsHavingClause",!1),supportsOrderBy:wr(t,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:wr(t,"supportsPagination",!1),supportsQuantization:wr(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:wr(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:wr(e,"supportsReturningQueryGeometry",!1),supportsResultType:wr(t,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:wr(t,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:wr(t,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:wr(e,"useStandardizedQueries",!1),supportsQueryByOthers:wr(i,"allowOthersToQuery",!0),supportsHistoricMoment:wr(r,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:s.has("pbf"),supportsDisjointSpatialRelationship:wr(t,"supportsDisjointSpatialRel",!1),supportsCacheHint:wr(t,"supportsQueryWithCacheHint",!1),maxRecordCountFactor:_r(e,"maxRecordCountFactor",void 0),maxRecordCount:_r(e,"maxRecordCount",void 0),standardMaxRecordCount:_r(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:_r(e,"tileMaxRecordCount",void 0)}}_readQueryRelatedCapabilities(e){const t=e.advancedQueryCapabilities,i=wr(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:wr(t,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i}}_readEditingCapabilities(e){const t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:wr(e,"allowGeometryUpdates",!0),supportsGlobalId:wr(e,"supportsApplyEditsWithGlobalIds",!1),supportsRollbackOnFailure:wr(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:wr(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:wr(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:wr(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:wr(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:wr(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:wr(t,"allowOthersToUpdate",!0)}}};a([l({readOnly:!0,json:{read:!1}})],Ir.prototype,"capabilities",void 0),a([d("service","capabilities",["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"])],Ir.prototype,"readCapabilities",null),a([l({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Ir.prototype,"charts",void 0),a([l({readOnly:!0,dependsOn:["definitionExpression","dynamicDataSource","timeExtent","timeOffset","geometryType","gdbVersion","historicMoment","returnZ","capabilities","returnM"]})],Ir.prototype,"createQueryVersion",null),a([l({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],Ir.prototype,"copyright",void 0),a([l({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],Ir.prototype,"displayField",void 0),a([l({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],Ir.prototype,"definitionExpression",void 0),a([l({types:Me,readOnly:!0})],Ir.prototype,"defaultSymbol",void 0),a([l({type:Ee})],Ir.prototype,"dynamicDataSource",void 0),a([l({readOnly:!0})],Ir.prototype,"editFieldsInfo",void 0),a([l({type:Boolean})],Ir.prototype,"editingEnabled",void 0),a([d(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Ir.prototype,"readEditingEnabled",null),a([d("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Ir.prototype,"readEditingEnabledFromWebMap",null),a([u(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Ir.prototype,"writeEditingEnabled",null),a([u("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Ir.prototype,"writeEditingEnabledToWebMap",null),a([l({readOnly:!0})],Ir.prototype,"editingInfo",void 0),a([d("editingInfo")],Ir.prototype,"readEditingInfo",null),a([l(Ce)],Ir.prototype,"elevationInfo",void 0),a([l({types:{key:"type",base:ke,typeMap:{selection:Ae,cluster:Fe}},json:{write:{target:"layerDefinition.featureReduction"}}})],Ir.prototype,"featureReduction",void 0),a([d("featureReduction",["layerDefinition.featureReduction"])],Ir.prototype,"readFeatureReduction",null),a([u("web-scene","featureReduction",{"layerDefinition.featureReduction":{types:Te}})],Ir.prototype,"writeWebSceneFeatureReduction",null),a([l(n(n({},Lr.fields),{json:{read:{source:"layerDefinition.fields"},origins:{service:{read:!0},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:Sr}}}}}))],Ir.prototype,"fields",void 0),a([l({readOnly:!0,dependsOn:["fields"]})],Ir.prototype,"fieldsIndex",null),a([l({type:Ki,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Ir.prototype,"formTemplate",void 0),a([l({type:E,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],Ir.prototype,"fullExtent",void 0),a([l()],Ir.prototype,"gdbVersion",void 0),a([l({readOnly:!0})],Ir.prototype,"geometryProperties",void 0),a([l({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:mr.read},"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:Sr,writer(e,t,i){const r=e?mr.toJSON(e):null;r&&ne(i,r,t)}}}},read:{source:"layerDefinition.geometryType",reader:mr.read}}})],Ir.prototype,"geometryType",void 0),a([l({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],Ir.prototype,"hasM",void 0),a([l({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],Ir.prototype,"hasZ",void 0),a([l({readOnly:!0,type:Re})],Ir.prototype,"heightModelInfo",void 0),a([l({type:Date})],Ir.prototype,"historicMoment",void 0),a([l({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],Ir.prototype,"id",void 0),a([l({readOnly:!0,json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Ir.prototype,"isTable",void 0),a([d("service","isTable",["type","geometryType"]),d("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Ir.prototype,"readIsTable",null),a([u("web-map","isTable")],Ir.prototype,"writeIsTable",null),a([l(Oe)],Ir.prototype,"labelsVisible",void 0),a([l({type:[N],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:cr},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:cr},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],Ir.prototype,"labelingInfo",void 0),a([l(De)],Ir.prototype,"opacity",void 0),a([l({type:Number,json:{origins:{service:{read:{source:"id"}}},read:!1}})],Ir.prototype,"layerId",void 0),a([l(Pe)],Ir.prototype,"legendEnabled",void 0),a([l({type:["show","hide"]})],Ir.prototype,"listMode",void 0),a([l({type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}})],Ir.prototype,"minScale",void 0),a([d("service","minScale",["minScale","effectiveMinScale"])],Ir.prototype,"readMinScale",null),a([l({type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}})],Ir.prototype,"maxScale",void 0),a([d("service","maxScale",["maxScale","effectiveMaxScale"])],Ir.prototype,"readMaxScale",null),a([l({type:String})],Ir.prototype,"globalIdField",void 0),a([d("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"]),d("service","globalIdField",["globalIdField","fields"])],Ir.prototype,"readGlobalIdFieldFromService",null),a([l({type:String,json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:Sr}}}}})],Ir.prototype,"objectIdField",void 0),a([d("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),d("service","objectIdField",["objectIdField","fields"])],Ir.prototype,"readObjectIdFieldFromService",null),a([l({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Ir.prototype,"operationalLayerType",void 0),a([l(Lr.outFields)],Ir.prototype,"outFields",void 0),a([l({readOnly:!0,dependsOn:["layerId","dynamicDataSource"]})],Ir.prototype,"parsedUrl",null),a([l({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Ir.prototype,"path",void 0),a([l(ze)],Ir.prototype,"popupEnabled",void 0),a([l({type:Ve,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Ir.prototype,"popupTemplate",void 0),a([l({readOnly:!0,dependsOn:["fields","title"]})],Ir.prototype,"defaultPopupTemplate",null),a([l({type:[yr],readOnly:!0})],Ir.prototype,"relationships",void 0),a([l({types:je,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:Ne,write:{target:"layerDefinition.drawingInfo.renderer",writer:Be}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,t,i)=>({ignoreOrigin:null==i?void 0:i.writeLayerSchema}),writer:Be}}})],Ir.prototype,"renderer",null),a([d("service","renderer",["drawingInfo.renderer","defaultSymbol"]),d("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Ir.prototype,"readRenderer",null),a([l()],Ir.prototype,"sourceJSON",void 0),a([l({type:Boolean})],Ir.prototype,"returnM",void 0),a([l({type:Boolean})],Ir.prototype,"returnZ",void 0),a([l(qe)],Ir.prototype,"screenSizePerspectiveEnabled",void 0),a([l()],Ir.prototype,"source",null),a([g("source")],Ir.prototype,"castSource",null),a([d("portal-item","source",["featureSet"]),d("web-map","source",["featureSet"])],Ir.prototype,"readSource",null),a([l({readOnly:!0})],Ir.prototype,"serviceDefinitionExpression",void 0),a([d("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],Ir.prototype,"readServiceDefinitionExpression",null),a([l({type:te,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],Ir.prototype,"spatialReference",void 0),a([l({type:[pe]})],Ir.prototype,"templates",void 0),a([d("templates",["editFieldsInfo","creatorField","editorField","templates"])],Ir.prototype,"readTemplates",null),a([l({type:Ge})],Ir.prototype,"timeInfo",void 0),a([l()],Ir.prototype,"title",void 0),a([d("service","title",["name"]),d("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Ir.prototype,"readTitle",null),a([d("web-map","title",["layerDefinition.name","title"])],Ir.prototype,"readTitleFromWebMap",null),a([l({type:String})],Ir.prototype,"sublayerTitleMode",void 0),a([l({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],Ir.prototype,"trackIdField",void 0),a([l({json:{read:!1}})],Ir.prototype,"type",void 0),a([l({type:String})],Ir.prototype,"typeIdField",void 0),a([d("service","typeIdField"),d("typeIdField",["layerDefinition.typeIdField"])],Ir.prototype,"readTypeIdField",null),a([l({type:[ge]})],Ir.prototype,"types",void 0),a([d("service","types",["types"]),d("types",["layerDefinition.types"])],Ir.prototype,"readTypes",null),a([l({readOnly:!0,json:{write:!1}})],Ir.prototype,"serverGens",void 0),a([l({type:P.ofType(nr),readOnly:!0})],Ir.prototype,"indexes",void 0),a([l($e)],Ir.prototype,"url",null),a([u("url")],Ir.prototype,"writeUrl",null),a([l({readOnly:!0})],Ir.prototype,"userIsAdmin",void 0),a([l({json:{origins:{service:{read:!0}},read:!1}})],Ir.prototype,"version",void 0),a([d("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],Ir.prototype,"readVersion",null),a([l({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Ir.prototype,"visible",void 0),a([d("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Ir.prototype,"readVisible",null),Ir=a([o("esri.layers.FeatureLayer")],Ir);const xr=Ue({types:We});var Mr=Ir,Er=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Mr});function Cr(e,t,i,r){return"function"==typeof e?e(t,i,r):e}function kr(e){return[e.r,e.g,e.b,e.a]}function Ar(e,t,i){const r=e=>{let t=e.length;for(;t--;)if(-1===" /-,\n".indexOf(e.charAt(t)))return!1;return!0},s=[];let n=0,a=-1;do{if(a=t.indexOf("[",n),a>=n){if(a>n){const e=t.substr(n,a-n);s.push([e,null,r(e)])}if(n=a+1,a=t.indexOf("]",n),a>=n){if(a>n){const i=e[t.substr(n,a-n)];i&&s.push([null,i,!1])}n=a+1}}}while(-1!==a);if(n<t.length-1){const e=t.substr(n);s.push([e,null,r(e)])}return e=>{let t="",r=null;for(const i of s){const[s,n,a]=i;if(s)a?r=s:(r&&(t+=r,r=null),t+=s);else{const i=e.attributes[n];i&&(r&&(t+=r,r=null),t+=i)}}return Fr(t,i)}}function Fr(e,t){switch("string"!=typeof e&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function Tr(e,t,i,r,s,n,a=!0){const l=t/s,o=i/n,c=Math.ceil(l/2),d=Math.ceil(o/2);for(let u=0;u<n;u++)for(let i=0;i<s;i++){const p=4*(i+(a?n-u-1:u)*s);let y=0,h=0,m=0,f=0,g=0,b=0,v=0;const w=(u+.5)*o;for(let r=Math.floor(u*o);r<(u+1)*o;r++){const s=Math.abs(w-(r+.5))/d,n=(i+.5)*l,a=s*s;for(let o=Math.floor(i*l);o<(i+1)*l;o++){let i=Math.abs(n-(o+.5))/c;const s=Math.sqrt(a+i*i);s>=-1&&s<=1&&(y=2*s*s*s-3*s*s+1,y>0&&(i=4*(o+r*t),v+=y*e[i+3],m+=y,e[i+3]<255&&(y=y*e[i+3]/250),f+=y*e[i],g+=y*e[i+1],b+=y*e[i+2],h+=y))}}r[p]=f/h,r[p+1]=g/h,r[p+2]=b/h,r[p+3]=v/m}}function Rr(e){return e?{r:e[0],g:e[1],b:e[2],a:e[3]/255}:{r:0,g:0,b:0,a:0}}function Or(e){var t;return null==(t=e.data)?void 0:t.symbol}function Dr(e){return"CIMVectorMarker"===e.type||"CIMPictureMarker"===e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type}function Pr(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type}function zr(e){return"CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===e.type||"CIMMarkerPlacementOnLine"===e.type||"CIMMarkerPlacementOnVertices"===e.type}function Vr(e){const t=Or(e);if("CIMTextSymbol"===t.type)return t.height;let i=0;if(t.symbolLayers)for(const s of t.symbolLayers)Dr(s)&&s.size>i?i=s.size:Pr(s)&&s.width>i?i=s.width:"CIMGradientFill"===(r=s).type||"CIMHatchFill"===r.type||"CIMPictureFill"===r.type||"CIMSolidFill"===r.type||r.type;var r;return i}function jr(e,t,i){const r=Or(e),s=Vr(e);0!==s?Nr(r,t/s,!1,i):function(e,t){if("CIMTextSymbol"!==e.type){if(e.symbolLayers)for(const i of e.symbolLayers)switch(i.type){case"CIMPictureMarker":case"CIMVectorMarker":i.size=t;break;case"CIMPictureStroke":case"CIMSolidStroke":i.width=t}}else e.height=t}(r,t)}function Nr(e,t,i,r){if("CIMTextSymbol"!==e.type){if(i&&e.effects)for(const i of e.effects)qr(i,t);if(e.symbolLayers)for(const i of e.symbolLayers)switch(i.type){case"CIMPictureMarker":case"CIMVectorMarker":Br(i,t,r);break;case"CIMPictureStroke":case"CIMSolidStroke":null!=r&&r.preserveOutlineWidth||(i.width*=t);break;case"CIMPictureFill":i.height*=t,i.offsetX*=t,i.offsetY*=t;break;case"CIMHatchFill":Nr(i.lineSymbol,t,!0,n(n({},r),{preserveOutlineWidth:!1})),i.offsetX*=t,i.offsetY*=t,i.separation*=t}}else e.height*=t}function Br(e,t,i){if(e.markerPlacement&&function(e,t){switch(zr(e)&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset*=t,e.offsetAlongLine*=t,e.placementTemplate&&e.placementTemplate.length){const i=e.placementTemplate.map((e=>e*t));e.placementTemplate=i}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset*=t,e.placementTemplate&&e.placementTemplate.length){const i=e.placementTemplate.map((e=>e*t));e.placementTemplate=i}break;case"CIMMarkerPlacementOnLine":e.startPointOffset*=t;break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine*=t;break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition*=t,e.endPosition*=t;break;case"CIMMarkerPlacementPolygonCenter":e.offsetX*=t,e.offsetY*=t;break;case"CIMMarkerPlacementInsidePolygon":e.offsetX*=t,e.offsetY*=t,e.stepX*=t,e.stepY*=t}}(e.markerPlacement,t),e.offsetX*=t,e.offsetY*=t,e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size*=t,"CIMVectorMarker"===e.type&&e.markerGraphics)for(const r of e.markerGraphics)e.scaleSymbolsProportionally||Nr(r.symbol,t,!0,i)}function qr(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width*=t;break;case"CIMGeometricEffectBuffer":e.size*=t;break;case"CIMGeometricEffectCut":e.beginCut*=t,e.endCut*=t,e.middleCut*=t;break;case"CIMGeometricEffectDashes":if(e.customEndingOffset*=t,e.offsetAlongLine*=t,e.dashTemplate&&e.dashTemplate.length){const i=e.dashTemplate.map((e=>e*t));e.dashTemplate=i}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length*=t;break;case"CIMGeometricEffectMove":e.offsetX*=t,e.offsetY*=t;break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset*=t;break;case"CIMGeometricEffectRegularPolygon":e.radius*=t;break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth*=t,e.length*=t,e.toWidth*=t;break;case"CIMGeometricEffectWave":e.amplitude*=t,e.period*=t}}function Gr(e){const t=[];return $r(Or(e),t),t.length?new Ze(Rr(t[0])):null}function $r(e,t){let i;i="CIMTextSymbol"===e.type?e.symbol:e;const r="CIMPolygonSymbol"===e.type;if(i.symbolLayers)for(const s of i.symbolLayers)if(!(s.colorLocked||r&&(Pr(s)||Dr(s)&&s.markerPlacement&&zr(s.markerPlacement))))switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":break;case"CIMVectorMarker":s.markerGraphics.forEach((e=>{$r(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":Ur(t,s.color);break;case"CIMHatchFill":$r(s.lineSymbol,t)}}function Ur(e,t){for(const i of e)if(i.join(".")===t.join("."))return;e.push(t)}function Hr(e,t){t instanceof Ze||(t=new Ze(t)),Wr(Or(e),t)}function Wr(e,t){let i;i="CIMTextSymbol"===e.type?e.symbol:e;const r="CIMPolygonSymbol"===e.type;if(i.symbolLayers)for(const s of i.symbolLayers){if(s.colorLocked)continue;if(r&&(Pr(s)||Dr(s)&&s.markerPlacement&&zr(s.markerPlacement)))continue;const e=t.toArray(0);switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":break;case"CIMVectorMarker":s.markerGraphics.forEach((e=>{Wr(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":s.color=e;break;case"CIMHatchFill":Wr(s.lineSymbol,t)}}}class Zr{constructor(e,t){this._storage=new Qe,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}put(e,t){this._storage.put(e,t,1,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.clearAll()}}const Qr=Je("esri/symbols/patterns/"),Jr=new Zr(1e3);function Yr(e){const t=e.style;let i=null;if(e)switch(e.type){case"simple-marker":"cross"!==t&&"x"!==t&&(i=e.color);break;case"simple-fill":"solid"===t?i=e.color:"none"!==t&&(i={type:"pattern",x:0,y:0,src:Qr+t+".png",width:5,height:5});break;case"picture-fill":i={type:"pattern",src:e.url,width:Ye(e.width)*e.xscale,height:Ye(e.height)*e.yscale,x:Ye(e.xoffset),y:Ye(e.yoffset)};break;case"text":i=e.color;break;case"cim":i=Gr(e)}return i}function Kr(e,t){const i=e+"-"+t;return void 0!==Jr.get(i)?L(Jr.get(i)):Ie(e,{responseType:"image"}).then((e=>{const r=e.data,s=r.naturalWidth,n=r.naturalHeight,a=document.createElement("canvas");a.width=s,a.height=n;const l=a.getContext("2d");l.fillStyle=t,l.fillRect(0,0,s,n),l.globalCompositeOperation="destination-in",l.drawImage(r,0,0);const o=a.toDataURL();return Jr.put(i,o),o}))}function Xr(e){if(!e)return null;let t;switch(e.type){case"simple-fill":case"picture-fill":case"simple-marker":t=Xr(e.outline);break;case"simple-line":{const i=Ye(e.width);"none"!==e.style&&0!==i&&(t={color:e.color,style:es(e.style),width:i,cap:e.cap,join:"miter"===e.join?Ye(e.miterLimit):e.join});break}default:t=null}return t}const es=function(){const e={};return function(t){if(e[t])return e[t];const i=t.replace(/-/g,"");return e[t]=i,i}}(),ts=new Ze([128,128,128]),is=/\/resource\/(.*?)\.svg$/;function rs(e){if(!e||!e.symbolLayers)return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((e=>"object"===e.type));case"line-3d":return e.symbolLayers.some((e=>"path"===e.type));case"polygon-3d":return e.symbolLayers.some((e=>"object"===e.type||"extrude"===e.type));default:return!1}}function ss(e){for(const t of e)if("number"==typeof t)return t;return null}function ns(e,t,i){for(let r=0;r<3;r++){const s=e[r];switch(s){case"symbol-value":return null!=i[r]?i[r]/t[r]:1;case"proportional":break;default:if(s&&t[r])return s/t[r]}}return 1}function as(e,t,i,r){switch(e){case"proportional":return i*r;case"symbol-value":return null!=t?t:i;default:return e}}async function ls(e,t){if(e&&t)return Ke(e)?async function(e,t){const i=e.symbolLayers;i&&await it(i,(async e=>async function(e,t){switch(e.type){case"extrude":i=t,e.size="number"==typeof i[2]?i[2]:0;break;case"icon":case"line":case"text":!function(e,t){const i=ss(t);_(i)&&(e.size=i)}(e,t);break;case"path":!function(e,t){const i=ns(t,rt,[e.width,void 0,e.height]);e.width=as(t[0],e.width,1,i),e.height=as(t[2],e.height,1,i)}(e,t);break;case"object":await async function(e,t){const{resourceSize:i,symbolSize:r}=await async function(e){const t=await import("./symbolLayerUtils.bef66e0a.js"),i=await t.computeObjectLayerResourceSize(e,10),{width:r,height:s,depth:n}=e,a=[r,n,s];let l=1;for(let o=0;o<3;o++)if(null!=a[o]){l=a[o]/i[o];break}for(let o=0;o<3;o++)null==a[o]&&(a[o]=i[o]*l);return{resourceSize:i,symbolSize:a}}(e),s=ns(t,i,r);e.width=as(t[0],r[0],i[0],s),e.depth=as(t[1],r[1],i[1],s),e.height=as(t[2],r[2],i[2],s)}(e,t)}var i}(e,t)))}(e,t):void(Xe(e)&&function(e,t){const i=ss(t);if(!k(i))switch(e.type){case"simple-marker":e.size=i;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=i,e.height=i*t):(e.width=i*t,e.height=i);break}case"simple-line":e.width=i;break;case"text":e.font.size=i}}(e,t))}function os(e,t,i){if(e&&null!=t)if(Ke(e)){const r=e.symbolLayers;r&&r.forEach((e=>{if(e&&"object"===e.type)switch(i){case"tilt":e.tilt=t;break;case"roll":e.roll=t;break;default:e.heading=t}}))}else Xe(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle=t))}new Ze("white");const cs={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let ds=class extends(st(ot)){constructor(){super(...arguments),this._scale=null,this.view=null}destroy(){this.layer=this.view=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>e.toExportImageJSON()));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&nt(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),e.on("sublayer-update",(e=>this.notifyChange(cs[e.propertyName])))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map((e=>e.id)).join(","):"show:-1":null}get layerDefs(){const e=this.visibleSublayers.filter((e=>null!=e.definitionExpression));return e.length?JSON.stringify(e.reduce(((e,t)=>(e[t.id]=t.definitionExpression,e)),{})):null}get scale(){return null!=this._scale?this._scale:this.view&&this.view.scale||0}set scale(e){this.view||(this._scale=e,this.notifyChange("scale"))}get version(){const e=this;e.layers,e.layerDefs,e.dynamicLayers,e.timeExtent;const t=e.layer;return t&&(t.dpi,t.imageFormat,t.imageTransparency,t.gdbVersion),(this._get("version")||0)+1}set version(e){this._set("version",e)}get visibleSublayers(){const e=[];if(!this.layer)return e;const t=this.layer.sublayers,i=t=>{const r=this.scale,s=0===r,n=0===t.minScale||r<=t.minScale,a=0===t.maxScale||r>=t.maxScale;t.visible&&(s||n&&a)&&(t.sublayers?t.sublayers.forEach(i):e.unshift(t))};t&&t.forEach(i);const r=this._get("visibleSublayers");return!r||r.length!==e.length||r.some(((t,i)=>e[i]!==t))?e:r}toJSON(){const e=this.layer;let t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t=n(n({},t),{layers:this.layers,layerDefs:this.layerDefs}),t}};a([l({readOnly:!0,dependsOn:["hasDynamicLayers","visibleSublayers"]})],ds.prototype,"dynamicLayers",null),a([l({readOnly:!0,dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],ds.prototype,"hasDynamicLayers",null),a([l()],ds.prototype,"layer",null),a([l({readOnly:!0,dependsOn:["visibleSublayers"]})],ds.prototype,"layers",null),a([l({readOnly:!0,dependsOn:["visibleSublayers"]})],ds.prototype,"layerDefs",null),a([l({type:Number,dependsOn:["view.scale"]})],ds.prototype,"scale",null),a([l(at)],ds.prototype,"timeExtent",void 0),a([l({dependsOn:["layers","layerDefs","dynamicLayers","layer.dpi","layer.imageFormat","layer.imageTransparency","layer.gdbVersion","timeExtent"]})],ds.prototype,"version",null),a([l({type:lt})],ds.prototype,"view",void 0),a([l({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],ds.prototype,"visibleSublayers",null),ds=a([o("esri.layers.mixins.ExportImageParameters")],ds);let us=null;function ps(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function ys(e,t={}){const i="horizontal"===t.align,r=i?75:24,s=i?24:75,{width:n=r,height:a=s,gradient:l=!0}=t,o=window.devicePixelRatio,c=n*o,d=a*o,u=document.createElement("canvas");u.width=c,u.height=d,u.style.width=`${n}px`,u.style.height=`${a}px`;const p=u.getContext("2d"),y=i?c:0,h=i?0:d;if(l){const t=p.createLinearGradient(0,0,y,h),i=1/(e.length-1);e.forEach(((e,r)=>t.addColorStop(r*i,e.toString()))),p.fillStyle=t,p.fillRect(0,0,c,d)}else{const t=i?c/e.length:c,r=i?d:d/e.length;let s=0,n=0;for(const a of e)p.fillStyle=a.toString(),p.fillRect(s,n,t,r),s=i?s+t:0,n=i?0:n+r}const m=document.createElement("div");return m.style.width=`${n}px`,m.style.height=`${a}px`,m.appendChild(u),m}async function hs(e,t){switch(e.type){case"web-style":{const{previewWebStyleSymbol:i}=await import("./previewWebStyleSymbol.06a662a1.js");return i(e,hs,t)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:i}=await Promise.resolve().then((function(){return Rn}));return i(e,t)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:i}=await import("./previewSymbol2D.045acaff.js");return i(e,t)}case"cim":{const{previewCIMSymbol:i}=await import("./previewCIMSymbol.9279ecbf.js");return i(e,t)}default:return}}const ms=/^-?(\d+)(\.(\d+))?$/i;function fs(e,t){return e-t}function gs(e,t){let i,r;return i=Number(e.toFixed(t)),i<e?r=i+1/Math.pow(10,t):(r=i,i-=1/Math.pow(10,t)),i=Number(i.toFixed(t)),r=Number(r.toFixed(t)),[i,r]}function bs(e,t,i,r,s){const n=ws(e,t,i,r),a=null==n.previous||n.previous<=s,l=null==n.next||n.next<=s;return a&&l||n.previous+n.next<=2*s}function vs(e){const t=String(e),i=t.match(ms);if(i&&i[1])return{integer:i[1].split("").length,fractional:i[3]?i[3].split("").length:0};if(t.toLowerCase().indexOf("e")>-1){const e=t.split("e"),i=e[0],r=e[1];if(i&&r){const e=Number(i);let t=Number(r);const s=t>0;s||(t=Math.abs(t));const n=vs(e);return s?(n.integer+=t,t>n.fractional?n.fractional=0:n.fractional-=t):(n.fractional+=t,t>n.integer?n.integer=1:n.integer-=t),n}}return{integer:0,fractional:0}}function ws(e,t,i,r){const s={previous:null,next:null};if(null!=i){const r=e-i,n=t-i-r;s.previous=Math.floor(Math.abs(100*n/r))}if(null!=r){const i=r-e,n=r-t-i;s.next=Math.floor(Math.abs(100*n/i))}return s}function _s(e,t={}){const i=e.slice(0),{tolerance:r=2,strictBounds:s=!1,indexes:n=i.map(((e,t)=>t))}=t;n.sort(fs);for(let a=0;a<n.length;a++){const e=n[a],t=i[e],l=0===e?null:i[e-1],o=e===i.length-1?null:i[e+1],c=vs(t).fractional;if(c){let n,d=0,u=!1;for(;d<=c&&!u;){const e=gs(t,d);n=s&&0===a?e[1]:e[0],u=bs(t,n,l,o,r),d++}u&&(i[e]=n)}}return i}const Ls={maximumFractionDigits:20};const Ss=pt("short-date");function Is(e,t,i,r){let s="";0===t?s="< ":t===i&&(s="> ");let n=null;return n=r?ut(e,Ss):function(e){return dt(e,Ls)}(e),s+n}const xs=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];function Ms(e,t){const{min:i,max:r}=(null==t?void 0:t.statistics)||{},s=e.stops.map((e=>e.value)),[n,a,l,o,c]=s,d=null!=i&&n<i,u=null!=r&&c>r;if(null==i||null==r||!d&&!u)return s;const p=d?i:n,y=u?r:c;return _s([p,d?p+(l-p)/2:a,l,u?l+(y-l)/2:o,y],{strictBounds:!0})}const Es=new Ze([64,64,64]);function Cs(e,t){const i=[],r=e.length-1;return 5===e.length?i.push(0,2,4):i.push(0,r),e.map(((e,s)=>i.indexOf(s)>-1?Is(e,s,r,t):null))}async function ks(e,t,i,r){let s=!1,n=[],a=[];if(e.stops){const t=null==r?void 0:r.authoringInfo,i="univariate-color-size"===(null==t?void 0:t.type)&&"above-and-below"===(null==t?void 0:t.univariateTheme),l=e.stops;n=i&&"color"===e.type?Ms(e,t):l.map((e=>e.value)),s=l.some((e=>!!e.label)),s&&(a=l.map((e=>e.label)))}const l=n[0],o=n[n.length-1];if(null==l&&null==o)return null;const c=s?null:Cs(n,i);return(await yt(n.map((async(i,r)=>({value:i,color:"opacity"===e.type?await async function(e,t,i=Es){const r=new Ze(i),s=(await import("./vendor.1ee57f36.js").then((function(e){return e.jP}))).getOpacity(t,e);return null!=s&&(r.a=s),r}(i,e,t):(await import("./vendor.1ee57f36.js").then((function(e){return e.jP}))).getColor(e,i),label:s?a[r]:c[r]}))))).reverse()}function As(e,t){const{startIndex:i,endIndex:r,weight:s}=function(e,t){let i=0,r=t.length-1;return t.some(((t,s)=>e<t.value?(r=s,!0):(i=s,!1))),{startIndex:i,endIndex:r,weight:(e-t[i].value)/(t[r].value-t[i].value)}}(e,t);if(i===r)return t[i].color;const n=Ze.blendColors(t[i].color,t[r].color,s);return new Ze(n)}function Fs(e){return"h"in e&&"s"in e&&"v"in e}function Ts(e){return"l"in e&&"a"in e&&"b"in e}const Rs=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],Os=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function Ds(e,t){const i=[];let r,s;if(e[0].length!==t.length)throw"dimensions do not match";const n=e.length,a=e[0].length;let l=0;for(r=0;r<n;r++){for(l=0,s=0;s<a;s++)l+=e[r][s]*t[s];i.push(l)}return i}function Ps(e){const t=Ds(Os,[e.x/100,e.y/100,e.z/100]).map((e=>{const t=e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function zs(e){const t=e.l,i=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?Math.pow(e,3):3*Math.pow(6/29,2)*(e-4/29)));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function Vs(e){return function(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>Math.pow(6/29,3)?Math.pow(e,1/3):1/3*Math.pow(29/6,2)*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}(function(e){const t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4))),i=Ds(Rs,t);return{x:100*i[0],y:100*i[1],z:100*i[2]}}(e))}function js(e){return function(e){return"r"in e&&"g"in e&&"b"in e}(e)?e:function(e){return"l"in e&&"c"in e&&"h"in e}(e)?function(e){return Ps(zs(function(e){const t=e.l,i=e.c,r=e.h;return{l:t,a:i*Math.cos(r),b:i*Math.sin(r)}}(e)))}(e):Ts(e)?function(e){return Ps(zs(e))}(e):function(e){return"x"in e&&"y"in e&&"z"in e}(e)?Ps(e):Fs(e)?function(e){const t=(e.h+360)%360/60,i=e.s/100,r=e.v/100*255,s=r*i,n=s*(1-Math.abs(t%2-1));let a;switch(Math.floor(t)){case 0:a={r:s,g:n,b:0};break;case 1:a={r:n,g:s,b:0};break;case 2:a={r:0,g:s,b:n};break;case 3:a={r:0,g:n,b:s};break;case 4:a={r:n,g:0,b:s};break;case 5:case 6:a={r:s,g:0,b:n};break;default:a={r:0,g:0,b:0}}return a.r=Math.round(a.r+r-s),a.g=Math.round(a.g+r-s),a.b=Math.round(a.b+r-s),a}(e):e}function Ns(e){return Fs(e)?e:function(e){const t=e.r,i=e.g,r=e.b,s=Math.max(t,i,r),n=s-Math.min(t,i,r);let a=s,l=0===n?0:s===t?(i-r)/n%6:s===i?(r-t)/n+2:(t-i)/n+4,o=0===n?0:n/a;return l<0&&(l+=6),l*=60,o*=100,a*=100/255,{h:l,s:o,v:a}}(js(e))}function Bs(e){return Ts(e)?e:Vs(js(e))}const qs={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};function Gs(e){const t=.5*e,i=22;return[{type:"path",path:[{command:"M",values:[0,.7*i*.5]},{command:"L",values:[6.6,.7*i]},{command:"L",values:[6.6,.7*i+t]},{command:"L",values:[0,.7*i+t-.7*i*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,.7*i]},{command:"L",values:[6.6,.7*i+t]},{command:"L",values:[22,t]},{command:"L",values:[22,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,0]},{command:"L",values:[22,0]},{command:"L",values:[6.6,.7*i]},{command:"L",values:[0,.7*i*.5]},{command:"Z",values:[]}]}]}function $s(e,t){return Math.round(Math.min(Math.max(e+255*t*.75,0),255))}function Us(e,t){if("type"in e&&("linear"===e.type||"pattern"===e.type))return e;const i=new Ze(e);return new Ze([$s(i.r,t),$s(i.g,t),$s(i.b,t),i.a])}let Hs=0,Ws=0;const Zs=T("android"),Qs=T("chrome")||Zs&&Zs>=4?"auto":"optimizeLegibility",Js={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},Ys=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let Ks={},Xs={};const en={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};function tn(e){return e.map((e=>`${e.command} ${e.values.join(" ")}`)).join(" ").trim()}function rn(e,t,i,r){if(e){if("circle"===e.type)return mt("circle",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",cx:e.cx,cy:e.cy,r:e.r});if("ellipse"===e.type)return mt("ellipse",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",cx:e.cx,cy:e.cy,rx:e.rx,ry:e.ry});if("rect"===e.type)return mt("rect",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",x:e.x,y:e.y,width:e.width,height:e.height});if("image"===e.type)return mt("image",{href:e.src,x:e.x,y:e.y,width:e.width,height:e.height,preserveAspectRatio:"none"});if("path"===e.type){const r="string"!=typeof e.path?tn(e.path):e.path;return mt("path",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",d:r})}if("text"===e.type)return mt("text",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4","text-anchor":r.align,"text-decoration":r.decoration,kerning:r.kerning,rotate:r.rotate,"text-rendering":Qs,"font-style":r.font.style,"font-variant":r.font.variant,"font-weight":r.font.weight,"font-size":r.font.size,"font-family":r.font.family,x:e.x,y:e.y},e.text)}return null}function sn(e){const t={fill:"none",pattern:null,linearGradient:null};if(e)if("type"in e&&"pattern"===e.type){const i="patternId-"+ ++Hs;t.fill=`url(#${i})`,t.pattern={id:i,x:e.x,y:e.y,width:e.width,height:e.height,image:{x:0,y:0,width:e.width,height:e.height,href:e.src}}}else if("type"in e&&"linear"===e.type){const i="linearGradientId-"+ ++Ws;t.fill=`url(#${i})`,t.linearGradient={id:i,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,stops:e.colors.map((e=>({offset:e.offset,color:e.color&&new Ze(e.color).toString()})))}}else if(e){const i=new Ze(e);t.fill=i.toString()}return t}function nn(e){const t={color:"none",width:1,cap:"butt",join:"4",dashArray:"none"};if(e&&(null!=e.width&&(t.width=e.width),e.cap&&(t.cap=e.cap),e.join&&(t.join=e.join.toString()),e.color&&(t.color=new Ze(e.color).toString()),e.style)){let i=null;if(e.style in en&&(i=en[e.style]),Array.isArray(i)){i=i.slice(0);for(let t=0;t<i.length;++t)i[t]*=e.width;if("butt"!==e.cap){for(let t=0;t<i.length;t+=2)i[t]-=e.width,i[t]<1&&(i[t]=1);for(let t=1;t<i.length;t+=2)i[t]+=e.width}i=i.join(",")}t.dashArray=i}return t}function an(e,t){const i={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};return e&&(i.align=e.align,i.decoration=e.decoration,i.kerning=e.kerning?"auto":"0",i.rotate=e.rotated?"90":"0",i.font.style=t.style||"normal",i.font.variant=t.variant||"normal",i.font.weight=t.weight||"normal",i.font.size=t.size&&t.size.toString()||"10pt",i.font.family=t.family||"serif"),i}function ln(e){const{pattern:t,linearGradient:i}=e;if(t)return mt("pattern",{id:t.id,patternUnits:"userSpaceOnUse",x:t.x,y:t.y,width:t.width,height:t.height},mt("image",{x:t.image.x,y:t.image.y,width:t.image.width,height:t.image.height,href:t.image.href}));if(i){const e=i.stops.map(((e,t)=>mt("stop",{key:`${t}-stop`,offset:e.offset,"stop-color":e.color})));return mt("linearGradient",{id:i.id,gradientUnits:"userSpaceOnUse",x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},e)}return null}function on(e,t,i){return vt(e,bt(e),[t,i])}function cn(e,t,i,r,s){return _t(e,bt(e),[t,i]),e[4]=e[4]*t-r*t+r,e[5]=e[5]*i-s*i+s,e}function dn(e,t){Ks&&"left"in Ks?(Ks.left>e&&(Ks.left=e),Ks.right<e&&(Ks.right=e),Ks.top>t&&(Ks.top=t),Ks.bottom<t&&(Ks.bottom=t)):Ks={left:e,bottom:t,right:e,top:t}}function un(e){const t=e.args,i=t.length;let r;switch(e.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(r=0;r<i;r+=2)dn(t[r],t[r+1]);Xs.x=t[i-2],Xs.y=t[i-1];break;case"H":for(r=0;r<i;++r)dn(t[r],Xs.y);Xs.x=t[i-1];break;case"V":for(r=0;r<i;++r)dn(Xs.x,t[r]);Xs.y=t[i-1];break;case"m":{let e=0;"x"in Xs||(dn(Xs.x=t[0],Xs.y=t[1]),e=2);for(r=e;r<i;r+=2)dn(Xs.x+=t[r],Xs.y+=t[r+1]);break}case"l":case"t":for(r=0;r<i;r+=2)dn(Xs.x+=t[r],Xs.y+=t[r+1]);break;case"h":for(r=0;r<i;++r)dn(Xs.x+=t[r],Xs.y);break;case"v":for(r=0;r<i;++r)dn(Xs.x,Xs.y+=t[r]);break;case"c":for(r=0;r<i;r+=6)dn(Xs.x+t[r],Xs.y+t[r+1]),dn(Xs.x+t[r+2],Xs.y+t[r+3]),dn(Xs.x+=t[r+4],Xs.y+=t[r+5]);break;case"s":case"q":for(r=0;r<i;r+=4)dn(Xs.x+t[r],Xs.y+t[r+1]),dn(Xs.x+=t[r+2],Xs.y+=t[r+3]);break;case"A":for(r=0;r<i;r+=7)dn(t[r+5],t[r+6]);Xs.x=t[i-2],Xs.y=t[i-1];break;case"a":for(r=0;r<i;r+=7)dn(Xs.x+=t[r+5],Xs.y+=t[r+6])}}function pn(e,t,i){const r=Js[e.toLowerCase()];let s;"number"==typeof r&&(r?t.length>=r&&(s={action:e,args:t.slice(0,t.length-t.length%r)},i.push(s),un(s)):(s={action:e,args:[]},i.push(s),un(s)))}function yn(e){const t={x:0,y:0,width:0,height:0};if("circle"===e.type)t.x=e.cx-e.r,t.y=e.cy-e.r,t.width=2*e.r,t.height=2*e.r;else if("ellipse"===e.type)t.x=e.cx-e.rx,t.y=e.cy-e.ry,t.width=2*e.rx,t.height=2*e.ry;else if("image"===e.type||"rect"===e.type)t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height;else if("path"===e.type){const i=function(e){const t=("string"!=typeof e.path?tn(e.path):e.path).match(Ys),i=[];if(Ks={},Xs={},!t)return null;let r="",s=[];const n=t.length;for(let l=0;l<n;++l){const e=t[l],n=parseFloat(e);isNaN(n)?(r&&pn(r,s,i),s=[],r=e):s.push(n)}pn(r,s,i);const a={x:0,y:0,width:0,height:0};return Ks&&"left"in Ks&&(a.x=Ks.left,a.y=Ks.top,a.width=Ks.right-Ks.left,a.height=Ks.bottom-Ks.top),a}(e);t.x=i.x,t.y=i.y,t.width=i.width,t.height=i.height}return t}function hn(e){const t={x:0,y:0,width:0,height:0};let i=null,r=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(const n of e)i?(i.x=Math.min(i.x,n.x),i.y=Math.min(i.y,n.y),r=Math.max(r,n.x+n.width),s=Math.max(s,n.y+n.height)):(i=t,i.x=n.x,i.y=n.y,r=n.x+n.width,s=n.y+n.height);return i&&(i.width=r-i.x,i.height=s-i.y),i}function mn(e,t,i,r,s,n,a){const l=t/2,o=i/2,c=e.width+r,d=e.height+r,u=wt(),p=wt();let y=!1;if(s&&0!==c&&0!==d){const e=c/d,r=t>i?t:i;let s=1,n=1;isNaN(r)||(e>1?(s=r/c,n=r/e/d):(n=r/d,s=r*e/c)),ft(p,p,cn(u,s,n,l,o)),y=!0}const h=e.x+(c-r)/2,m=e.y+(d-r)/2;if(ft(p,p,on(u,l-h,o-m)),!y&&(c>t||d>i)){const e=c/t>d/i,r=(e?t:i)/(e?c:d);ft(p,p,cn(u,r,r,h,m))}return n&&ft(p,p,function(e,t,i,r){const s=t%360*Math.PI/180;gt(e,bt(e),s);const n=Math.cos(s),a=Math.sin(s),l=e[4],o=e[5];return e[4]=l*n-o*a+r*a-i*n+i,e[5]=o*n+l*a-i*a-r*n+r,e}(u,n,h,m)),a&&ft(p,p,on(u,a[0],a[1])),`matrix(${p[0]},${p[1]},${p[2]},${p[3]},${p[4]},${p[5]})`}function fn(e,t,i,r){const s=[],n=[];for(const a of e){const e=[],l=[];let o=0,c=0,d=0;for(const t of a){const{shape:i,fill:r,stroke:n,font:a,offset:u}=t;o+=n&&n.width||0;const p=sn(r),y=nn(n),h="text"===i.type?an(i,a):null;s.push(ln(p)),e.push(rn(i,p.fill,y,h)),l.push(yn(i)),u&&(c+=u[0],d+=u[1])}const u=mn(hn(l),t,i,o,r&&r.scale,r&&r.rotation,[c,d]);n.push(mt("g",{transform:u},e))}return mt("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:i},mt("defs",null,s),n)}const gn=Lt();function bn(e,t,i){const r=Math.ceil(t[0]),s=Math.ceil(t[1]);if(!e.some((e=>!!e.length)))return null;const n=i&&i.node||document.createElement("div");return null!=i.opacity&&(n.style.opacity=i.opacity.toString()),gn.append(n,fn.bind(null,e,r,s,i)),n}function vn(e,t,i,r,s){switch(s){case"multiply":e[t+0]*=i[0],e[t+1]*=i[1],e[t+2]*=i[2],e[t+3]*=i[3];break;default:{const s=Ns({r:e[t+0],g:e[t+1],b:e[t+2]});s.h=r.h,s.s=r.s,s.v=s.v/100*r.v;const n=js(s);e[t+0]=n.r,e[t+1]=n.g,e[t+2]=n.b,e[t+3]*=i[3];break}}}const wn=Je("esri/symbols/patterns/"),_n=Je("esri/images/Legend/legend3dsymboldefault.png"),Ln=b.getLogger("esri.symbols.support.previewSymbol3D");function Sn(e){const t=e.outline,i=_(e.material)?e.material.color:null,r=_(i)?i.toRgba().toString():null;if(k(t))return"fill"===e.type&&"255,255,255,1"===r?{color:"#bdc3c7",width:.75}:null;const s=Ye(t.size)||0;return{color:"rgba("+(_(t.color)?t.color.toRgba():"255,255,255,1")+")",width:Math.min(s,80)}}function In(e,t=1){const i=e.a,r=Ns(e),s=r.h,n=r.s/t,a=100-(100-r.v)/t,{r:l,g:o,b:c}=js({h:s,s:n,v:a});return[l,o,c,i]}function xn(e){return"water"===e.type?k(e.color)?null:e.color:k(e.material)||k(e.material.color)?null:e.material.color}function Mn(e,t=0){const i=xn(e);if(!i){const e=$s(ts.r,t);return[e,e,e,100]}const r=i.toRgba();for(let s=0;s<3;s++)r[s]=$s(r[s],t);return r}async function En(e,t){const i=e.style;return"none"===i?null:{type:"pattern",x:0,y:0,src:await Kr(`${wn}${i}.png`,t.toCss(!0)),width:5,height:5}}function Cn(e){return e.outline?Sn(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function kn(e,t){const i=xn(e);if(!i)return null;let r="rgba(";return r+=$s(i.r,t)+",",r+=$s(i.g,t)+",",r+=$s(i.b,t)+",",r+i.a+");"}function An(e,t){const i=kn(e,t);return i?{color:i,width:Math.min(e.size?Ye(e.size):.75,80)}:{}}function Fn(e,t,i){const r=.75*i;return{type:"linear",x1:r?.25*r:0,y1:r?.5*r:0,x2:r||4,y2:r?.5*r:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}function Tn(e,t){const i=t&&t.size?Ye(t.size):null,r=t&&t.maxSize?Ye(t.maxSize):null,s=t&&t.disableUpsampling,n=e.symbolLayers,a=[];let l=0,o=0;const c=n.getItemAt(n.length-1);let d;return c&&"icon"===c.type&&(d=c.size&&Ye(c.size)),n.forEach((n=>{if("icon"!==n.type&&"object"!==n.type)return;const c="icon"===n.type?n.size&&Ye(n.size):0,u=i||c?Math.ceil(Math.min(i||c,r||120)):22;if(n&&n.resource&&n.resource.href){const t=function(e,t){const i=t&&t.resource,r=i&&i.href;return e.thumbnail&&e.thumbnail.url?L(e.thumbnail.url):r&&"object"!==t.type?L(function(e,t){const i=t.resource.href;return!T("esri-canvas-svg-support")&&e.styleOrigin&&is.test(i)?i.replace(is,"/resource/png/$1.png"):i}(e,t)):e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)?It(e.styleOrigin,{portal:e.styleOrigin.portal},"webRef").catch((e=>e)).then((e=>e&&e.thumbnail&&e.thumbnail.url||_n)):L(_n)}(e,n).then((function(e){const t=n.get("material.color"),i="icon"===n.type?"multiply":"tint";return function(e,t,i,r,s){return(n=e,a=t,l=s,n?Ie(n,{responseType:"image"}).then((e=>{const t=e.data,i=t.width,r=t.height,s=i/r;let n=a;if(l){const e=Math.max(i,r);n=Math.min(n,e)}return{image:t,width:s<=1?Math.ceil(n*s):n,height:s<=1?n:Math.ceil(n/s)}})):x(new M("renderUtils: imageDataSize","href not provided."))).then((s=>{const n=s.width?s.width:t,a=s.height?s.height:t;if(s.image&&function(e,t){return!(!e||"ignore"===t||"multiply"===t&&255===e.r&&255===e.g&&255===e.b&&1===e.a)}(i,r)){let t=s.image.width,l=s.image.height;(T("edge")||T("ie"))&&/\.svg$/i.test(e)&&(t-=1,l-=1);const o=function(e,t){e=Math.ceil(e),t=Math.ceil(t);const i=document.createElement("canvas");i.width=e,i.height=t,i.style.width=e+"px",i.style.height=t+"px";const r=i.getContext("2d");return r.clearRect(0,0,e,t),r}(n,a);o.drawImage(s.image,0,0,t,l,0,0,n,a);const c=o.getImageData(0,0,n,a),d=[i.r/255,i.g/255,i.b/255,i.a],u=Ns(i);for(let e=0;e<c.data.length;e+=4)vn(c.data,e,d,u,r);o.putImageData(c,0,0),e=o.canvas.toDataURL("image/png")}else{const t=St&&St.findCredential(e);if(t&&t.token){const i=-1===e.indexOf("?")?"?":"&";e=`${e}${i}token=${t.token}`}}return{url:e,width:n,height:a}})).catch((function(){return{url:e,width:t,height:t}}));var n,a,l}(e,u,t,i,s)})).then((function(e){const t=e.width,i=e.height;return l=Math.max(l,t),o=Math.max(o,i),[{shape:{type:"image",x:0,y:0,width:t,height:i,src:e.url},fill:null,stroke:null}]}));a.push(t)}else{var p;let e=u;"icon"===n.type&&d&&i&&(e=u*(c/d));const r="tall"===(null==t?void 0:t.symbolConfig)||(null==t||null==(p=t.symbolConfig)?void 0:p.isTall)||"object"===n.type&&function(e){const t=e.depth,i=e.height,r=e.width;return r&&t&&i&&r===t&&r<i}(n);l=Math.max(l,r?20:e),o=Math.max(o,e),a.push(L(function(e,t,i){const r=[];if(!e)return r;switch(e.type){case"icon":{const i=0,s=0,n=t,a=t;switch(e.resource&&e.resource.primitive||Mt){case"circle":r.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:Mn(e,0),stroke:Sn(e)});break;case"square":r.push({shape:{type:"path",path:[{command:"M",values:[i,a]},{command:"L",values:[i,s]},{command:"L",values:[n,s]},{command:"L",values:[n,a]},{command:"Z",values:[]}]},fill:Mn(e,0),stroke:Sn(e)});break;case"triangle":r.push({shape:{type:"path",path:[{command:"M",values:[i,a]},{command:"L",values:[.5*n,s]},{command:"L",values:[n,a]},{command:"Z",values:[]}]},fill:Mn(e,0),stroke:Sn(e)});break;case"cross":r.push({shape:{type:"path",path:[{command:"M",values:[.5*n,s]},{command:"L",values:[.5*n,a]},{command:"M",values:[i,.5*a]},{command:"L",values:[n,.5*a]}]},stroke:Cn(e)});break;case"x":r.push({shape:{type:"path",path:[{command:"M",values:[i,s]},{command:"L",values:[n,a]},{command:"M",values:[n,s]},{command:"L",values:[i,a]}]},stroke:Cn(e)});break;case"kite":r.push({shape:{type:"path",path:[{command:"M",values:[i,.5*a]},{command:"L",values:[.5*n,s]},{command:"L",values:[n,.5*a]},{command:"L",values:[.5*n,a]},{command:"Z",values:[]}]},fill:Mn(e,0),stroke:Sn(e)})}break}case"object":switch(e.resource&&e.resource.primitive||xt){case"cone":{const s=Fn(Mn(e,0),Mn(e,-.6),i?20:t),n=function(e,t){let i=t?20:e;const r=t?4:6;i-=i<=22?.5*r:r;const s=.15*i,n=e-s;return[{type:"ellipse",cx:.5*i,cy:n,rx:.5*i,ry:s},{type:"path",path:[{command:"M",values:[.5*i,0]},{command:"L",values:[i,n]},{command:"L",values:[0,n]},{command:"Z",values:[]}]}]}(t,i);r.push({shape:n[0],fill:s}),r.push({shape:n[1],fill:s});break}case"inverted-cone":{const i=Mn(e,0),s=Fn(i,Mn(e,-.6),t),n=function(e){let t=e;t-=t<22?3:6;const i=.15*t;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,0]},{command:"L",values:[.5*t,e-i]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*t,cy:0,rx:.5*t,ry:i}]}(t);r.push({shape:n[0],fill:s}),r.push({shape:n[1],fill:i});break}case"cube":{const s=function(e,t){let i=t?20:e;const r=t?4:6;i-=i<=22?.5*r:r;const s=t?.35*i:.5*i;return[{type:"path",path:[{command:"M",values:[.5*i,0]},{command:"L",values:[i,.5*s]},{command:"L",values:[.5*i,s]},{command:"L",values:[0,.5*s]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*s]},{command:"L",values:[.5*i,s]},{command:"L",values:[.5*i,e]},{command:"L",values:[0,e-.5*s]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*i,s]},{command:"L",values:[.5*i,e]},{command:"L",values:[i,e-.5*s]},{command:"L",values:[i,.5*s]},{command:"Z",values:[]}]}]}(t,i);r.push({shape:s[0],fill:Mn(e,0)}),r.push({shape:s[1],fill:Mn(e,-.3)}),r.push({shape:s[2],fill:Mn(e,-.5)});break}case"cylinder":{const s=Fn(Mn(e,0),Mn(e,-.6),i?20:t),n=function(e,t){let i=t?20:e;const r=t?4:6;i-=i<=22?.5*r:r;const s=.5*i,n=.15*i,a=e-n;return[{type:"ellipse",cx:.5*i,cy:a,rx:s,ry:n},{type:"path",path:[{command:"M",values:[0,n]},{command:"L",values:[0,a]},{command:"L",values:[i,a]},{command:"L",values:[i,n]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*i,cy:n,rx:s,ry:n}]}(t,i);r.push({shape:n[0],fill:s}),r.push({shape:n[1],fill:s}),r.push({shape:n[2],fill:Mn(e,0)});break}case"diamond":{const i=function(e){let t=e;const i=e;t-=t<22?2:4;const r=t,s=i,n=Math.floor(e/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*r,0]},{command:"L",values:[r,.5*s-n]},{command:"L",values:[.45*r-n,.5*s+n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*r,0]},{command:"L",values:[.45*r-n,.5*s+n]},{command:"L",values:[0,.5*s-n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*s-n]},{command:"L",values:[.45*r-n,.5*s+n]},{command:"L",values:[.45*r,i]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*r,i]},{command:"L",values:[r,.5*s-n]},{command:"L",values:[.45*r-n,.5*s+n]},{command:"Z",values:[]}]}]}(t);r.push({shape:i[0],fill:Mn(e,-.3)}),r.push({shape:i[1],fill:Mn(e,0)}),r.push({shape:i[2],fill:Mn(e,-.3)}),r.push({shape:i[3],fill:Mn(e,-.7)});break}case"sphere":{const i=Fn(Mn(e,0),Mn(e,-.6));i.x1=0,i.y1=0,i.x2=.25*t,i.y2=.25*t,r.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:i});break}case"tetrahedron":{const i=function(e){let t=e;return t-=t<22?1:2,[{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[e,t]},{command:"L",values:[.45*e,.6*t]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[.45*e,.6*t]},{command:"L",values:[0,t]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,t]},{command:"L",values:[.45*e,.6*t]},{command:"L",values:[e,t]},{command:"Z",values:[]}]}]}(t);r.push({shape:i[0],fill:Mn(e,-.3)}),r.push({shape:i[1],fill:Mn(e,0)}),r.push({shape:i[2],fill:Mn(e,-.6)});break}}}return r}(n,e,r)))}})),Et(a).then((function(e){const i=[];return e.forEach((function(e){e.value?i.push(e.value):e.error&&Ln.warn("error while building swatchInfo!",e.error)})),bn(i,[l,o],{node:t&&t.node,scale:!1,opacity:t&&t.opacity})}))}var Rn=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getPatternDescriptor:En,getSymbolLayerFill:Mn,previewSymbol3D:function(e,t){if(0===e.symbolLayers.length)return x(new M("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));let i=null;switch(e.type){case"point-3d":i=Tn(e,t);break;case"line-3d":i=function(e,t){const i=e.symbolLayers,r=[],s=rs(e),a=t&&t.size?Ye(t.size):null,l=(t&&t.maxSize?Ye(t.maxSize):null)||80;let o,c=0,d=0;return i.forEach(((e,t)=>{if(!e)return;if("line"!==e.type&&"path"!==e.type)return;const i=[];switch(e.type){case"line":{const r=An(e,0),s=r&&r.width||0;0===t&&(o=s);const n=Math.min(a||s,l),u=0===t?n:a?n*(s/o):n,p=u>20?2*u:40;d=Math.max(d,u),c=Math.max(c,p),r.width=u,i.push({shape:{type:"path",path:[{command:"M",values:[0,.5*d]},{command:"L",values:[c,.5*d]}]},stroke:r});break}case"path":{const t=Math.min(a||22,l),r=Mn(e,0),s=Mn(e,-.2),o=kn(e,-.4),u=o?{color:o,width:1}:{};if("quad"===e.profile){const t=e.width||e.size,a=e.height||e.size,l=function(e){let t=22,i=22;return e<1?t*=.75:e>1&&(i*=1.25),[{type:"path",path:[{command:"M",values:[22,0]},{command:"L",values:[19.25,0]},{command:"L",values:[0,i-11]},{command:"L",values:[t-11,i-11]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[22,0]},{command:"L",values:[22,2.75]},{command:"L",values:[t-11,22]},{command:"L",values:[t-11,i-11]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[t-11,i-11]},{command:"L",values:[0,i-11]},{command:"L",values:[0,22]},{command:"L",values:[t-11,22]},{command:"Z",values:[]}]}]}(t&&a?t/a:1),o=n(n({},u),{join:"bevel"});i.push({shape:l[0],fill:s,stroke:o}),i.push({shape:l[1],fill:s,stroke:o}),i.push({shape:l[2],fill:r,stroke:o})}else i.push({shape:qs.pathSymbol3DLayer[0],fill:s,stroke:u}),i.push({shape:qs.pathSymbol3DLayer[1],fill:r,stroke:u});d=Math.max(d,t),c=d}}r.push(i)})),L(bn(r,[c,d],{node:t&&t.node,scale:s,opacity:t&&t.opacity}))}(e,t);break;case"polygon-3d":case"mesh-3d":i=async function(e,t){const i="mesh-3d"===e.type,r=e.symbolLayers,s=t&&t.size?Ye(t.size):null,a=t&&t.maxSize?Ye(t.maxSize):null,l=s||22,o=[];let c=0,d=0,u=!1;for(let p=0;p<r.length;p++){const e=r.getItemAt(p),t=[];if(i&&"fill"!==e.type)continue;const s=qs.fill[0];switch(e.type){case"fill":{const r=Sn(e),n=Math.min(l,a||120);c=Math.max(c,n),d=Math.max(d,n),u=!0;let o=Mn(e,0);const p="pattern"in e&&e.pattern,y=xn(e);!i&&_(p)&&"style"===p.type&&"solid"!==p.style&&y&&(o=await En(p,y)),t.push({shape:s,fill:o,stroke:r});break}case"line":{const i={stroke:An(e,0),shape:s};c=Math.max(c,22),d=Math.max(d,22),t.push(i);break}case"extrude":{const i=n({join:"round"},An(e,-.4)),r=Mn(e,0),s=Mn(e,-.2),o=Math.min(l,a||120),u=Gs(o);i.width=1,t.push({shape:u[0],fill:s,stroke:i}),t.push({shape:u[1],fill:s,stroke:i}),t.push({shape:u[2],fill:r,stroke:i});const p=22,y=22*.7+.5*o;c=Math.max(c,p),d=Math.max(d,y);break}case"water":{const i=xn(e),r=In(i),s=In(i,2),n=In(i,3),o=[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}];u=!0,t.push({shape:o[0],fill:r}),t.push({shape:o[1],fill:s}),t.push({shape:o[2],fill:n});const p=Math.min(l,a||120);c=Math.max(c,p),d=Math.max(d,p);break}}o.push(t)}return L(bn(o,[c,d],{node:t&&t.node,scale:u,opacity:t&&t.opacity}))}(e,t)}return i||x(new M("symbolPreview: swatchInfo3D","symbol not supported."))}});const On={HH:315,HL:45,LL:135,LH:225},Dn={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function Pn(e){if(!e)return;const{type:t}=e;if(t.indexOf("3d")>-1)return Mn(e.symbolLayers.getItemAt(0));if("simple-line"===t){const t=Xr(e);return t&&t.color}if("simple-marker"===e.type&&("x"===e.style||"cross"===e.style)){const t=Xr(e);return t&&t.color}return Yr(e)}function zn(e){let t=On[e];return e&&null==t&&(t=On.HH),t||0}const Vn=[255,255,255],jn=[200,200,200],Nn=[128,128,128];async function Bn(e,t,i,r,s,n){const a=t.legendOptions,l=a&&a.customValues,o=function(e,t){let i=null,r=null;if("simple"===e.type)i=e.symbol;else if("class-breaks"===e.type){const t=e.classBreakInfos;i=t&&t[0]&&t[0].symbol,r=t.length>1}else if("unique-value"===e.type){const t=e.uniqueValueInfos;i=t&&t[0]&&t[0].symbol,r=t.length>1}return!i||(s=i)&&(Ke(s)?s.symbolLayers&&s.symbolLayers.some((e=>e&&"fill"===e.type)):-1!==s.type.indexOf("fill"))?null:(i=i.clone(),(t||r)&&(i.type.indexOf("3d")>-1?qn(i):Gn(i)),i);var s}(e,i),c=!!o,d=!!l,u=null!=t.minSize&&null!=t.maxSize,p=t.stops&&t.stops.length>1,y=!!t.target;if(!c||!d&&!(u||p&&!y))return;const h=rs(o);let m=null,f=null,g=null;f=h&&!p?_s([t.minDataValue,t.maxDataValue]):l||await async function(e,t,i,r){const s=(await import("./vendor.1ee57f36.js").then((function(e){return e.jP}))).getSizeRangeAtScale(e,i,r),n=s&&function(e){const t=e.minSize,i=(e.maxSize-t)/4,r=[];for(let s=0;s<5;s++)r.push(t+i*s);return r}(s);if(!s&&!n)return;let a=n.map((t=>function(e,t,i){const r=i.minSize,s=i.maxSize,n=t.minDataValue,a=t.maxDataValue;let l=null;return l=e<=r?n:e>=s?a:(e-r)/(s-r)*(a-n)+n,l}(t,e,s)));a=_s(a);for(let l=1;l<a.length-1;l++){const s=await $n(e,t,a[l],a[l-1],i,r);s&&(a[l]=s[0],n[l]=s[1])}return a}(t,o,r,s);const b=null==e?void 0:e.authoringInfo,v="univariate-color-size"===(null==b?void 0:b.type)&&"above-and-below"===(null==b?void 0:b.univariateTheme);if(!f&&p&&(f=v?Ms(t,b):t.stops.map((e=>e.value)),m=t.stops.some((e=>!!e.label)),m&&(g=t.stops.map((e=>e.label)))),h&&f&&f.length>2&&(f=[f[0],f[f.length-1]]),!f)return null;const w=[12,30],L=function(e){if(!e)return 0;if(Ke(e)){const t=function(e){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const i=e.symbolLayers.getItemAt(t-1);return"outline"in i?et(i,"outline","size"):void 0}(e);return _(t)?t:0}const t=Xr(e);return t&&tt(t.width)||0}(o),S=m?null:function(e,t){const i=e.length-1;return e.map(((e,r)=>Is(e,r,i,t)))}(f,n);return(await yt(f.map((async(i,n)=>{const a=h?w[n]:await Un(t,o,i,r,s);return{value:i,symbol:function(e,t){const i=e.clone();if(Ke(i))rs(i)||i.symbolLayers.forEach((e=>{"fill"!==e.type&&(e.size=t)}));else if("esri.symbols.SimpleMarkerSymbol"===i.declaredClass)i.size=t;else if("esri.symbols.PictureMarkerSymbol"===i.declaredClass){const e=i.width,r=i.height;i.height=t,i.width=t*(e/r)}else!function(e){return"esri.symbols.SimpleLineSymbol"===e.declaredClass}(i)?function(e){return"esri.symbols.TextSymbol"===e.declaredClass}(i)&&i.font&&(i.font.size=t):i.width=t;return i}(v&&"class-breaks"===e.type?function(e,t){const i=e.classBreakInfos,r=i.length,s=r<2||!(t>=2)?i[0].symbol.clone():i[r-1].symbol.clone();return e.visualVariables.some((e=>"color"===e.type))&&(s.type.indexOf("3d")>-1?qn(s):Gn(s)),s}(e,n):o,a),label:m?g[n]:S[n],size:a,outlineSize:L}})))).reverse()}function qn(e){rs(e)||("line-3d"===e.type?e.symbolLayers.forEach((e=>{e.material={color:Nn}})):e.symbolLayers.forEach((e=>{"icon"!==e.type||e.resource&&e.resource.href?e.material={color:jn}:(e.material={color:Vn},e.outline={color:Nn,size:1.5})})))}function Gn(e){"cim"===e.type?Hr(e,new Ze(jn)):-1!==e.type.indexOf("line")?e.color=Nn:(e.color=Vn,"simple-marker"===e.type&&(e.outline={color:Nn,width:1.5}))}async function $n(e,t,i,r,s,n){const a=await Un(e,t,i,s,n),l=await Un(e,t,r,s,n),o=vs(i),c=o.fractional;let d=o.integer,u=null,p=null;i>0&&i<1&&(u=Math.pow(10,c),d=vs(i*=u).integer);for(let y=d-1;y>=0;y--){const r=Math.pow(10,y);let o=Math.floor(i/r)*r,c=Math.ceil(i/r)*r;null!=u&&(o/=u,c/=u);let d=(o+c)/2;[,d]=_s([o,d,c],{indexes:[1]});const h=await Un(e,t,o,s,n),m=await Un(e,t,c,s,n),f=await Un(e,t,d,s,n),g=ws(a,h,l,null),b=ws(a,m,l,null),v=ws(a,f,l,null);let w=g.previous<=20,_=b.previous<=20;if(w&&_&&(g.previous<=b.previous?(w=!0,_=!1):(_=!0,w=!1)),w?p=[o,h]:_?p=[c,m]:v.previous<=20&&(p=[d,f]),p)break}return p}async function Un(e,t,i,r,s){const{getSize:n}=await import("./vendor.1ee57f36.js").then((function(e){return e.jP}));return n(e,i,{scale:r,view:s,shape:"simple-marker"===t.type?t.style:null})}const Hn=b.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),Wn=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,Zn=new B({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),Qn={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},Jn=new Ct({size:6,outline:{color:[128,128,128,.5],width:.5}}),Yn=new kt({style:"solid"});function Kn(e){return"vector-field"===e.type}function Xn(e){return"raster-colormap"===e.type}function ea(e){return"raster-stretch"===e.type}function ta(e){return"raster-shaded-relief"===e.type}function ia(e){return"esri.renderers.SimpleRenderer"===e.declaredClass}function ra(e){return"esri.renderers.ClassBreaksRenderer"===e.declaredClass}function sa(e){return"esri.renderers.UniqueValueRenderer"===e.declaredClass}function na(e){return"esri.renderers.HeatmapRenderer"===e.declaredClass}function aa(e){return"esri.renderers.PointCloudClassBreaksRenderer"===e.declaredClass}function la(e){return"esri.renderers.PointCloudStretchRenderer"===e.declaredClass}function oa(e){return"esri.renderers.PointCloudUniqueValueRenderer"===e.declaredClass}function ca(e){return"esri.renderers.DotDensityRenderer"===e.declaredClass}function da(e){return"esri.layers.BuildingSceneLayer"===e.declaredClass}function ua(e){return"esri.layers.MapImageLayer"===e.declaredClass}function pa(e){return"esri.layers.ImageryLayer"===e.declaredClass}function ya(e){return"esri.layers.WCSLayer"===e.declaredClass}const ha=new Ct({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}});let ma={},fa=class extends ot{constructor(e){super(e),this._handles=new ee,this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this.children=new P,this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null}initialize(){const e=()=>this.notifyChange("ready");this._handles.add([At(this,"children","change",(t=>{const{added:i,removed:r}=t,s=this._handles;i.map((t=>{const i=`activeLayerInfo-ready-watcher-${t.layer.uid}`;s.add(Ft(t,"ready",e),i)})),r.forEach((e=>s.remove(e.layer.uid))),e()}))]),this.keepCacheOnDestroy||(ma={})}destroy(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(ma=null)}get opacity(){var e;const t=this.layer.opacity,i=null==(e=this.parent)?void 0:e.opacity,r=this.layer.parent,s=r&&"uid"in r?this._getParentLayerOpacity(r):null;return null!=i?i*t:null!=s?s*t:t}get ready(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view&&this.view.scale}get isScaleDriven(){const e=this.layer;if(null===e)return!1;if("featureReduction"in e&&e.featureReduction&&"cluster"===e.featureReduction.type)return!0;if("renderer"in e&&e.renderer){if("dot-density"===e.renderer.type)return!0;const t=e.get("renderer.valueExpression");if(Wn.test(t))return!0;const i=e.get("renderer.visualVariables");if(i)return i.some((e=>this._isScaleDrivenSizeVariable(e)))}return this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}async buildLegendElementsForFeatureCollections(e){const t=e.map((e=>{if("esri.layers.FeatureLayer"===e.declaredClass)return this._getRendererLegendElements(e.renderer,{title:e.title});if(e.featureSet&&e.featureSet.features.length){const t=e.layerDefinition,i=t&&t.drawingInfo,r=i&&Tt(i.renderer),s=Zn.read(t.geometryType);return r?this._getRendererLegendElements(r,{title:e.name,geometryType:s}):(Hn.warn("drawingInfo not available!"),null)}return null}));try{const e=[];await Et(t).then((t=>{t.forEach((({value:t})=>t&&e.push(...t)))})),this.legendElements=e,this.notifyChange("ready")}catch(i){Hn.warn("error while building legend for layer!",i)}}async buildLegendElementsForRenderer(e){try{const t=await this._getRendererLegendElements(e);this.legendElements=t,this.notifyChange("ready")}catch(t){Hn.warn("error while building legend for layer!",t)}}async buildLegendElementsForTools(){const e=this.layer;"esri.layers.WMTSLayer"!==e.declaredClass?function(e){return"esri.layers.WMSLayer"===e.declaredClass}(e)?await this._constructLegendElementsForWMSSublayers():da(e)?await this._constructLegendElementsForBuildingSceneLayer():ua(e)||function(e){return"esri.layers.TileLayer"===e.declaredClass}(e)||da(e)?await this._constructLegendElementsForSublayers():(this._handles.remove("imageryLayers-watcher"),await this._getLegendLayers().then((t=>{this.legendElements=[],t.forEach((t=>{if(pa(e)){const t=e.watch(["renderingRule","bandIds"],(()=>{ma.default=null,this.buildLegendElementsForTools()}));this._handles.add(t,"imageryLayers-watcher")}const i=this._generateSymbolTableElementForLegendLayer(t);i&&i.infos.length&&(pa(e)&&(i.title=e.title),this.legendElements.push(i)),this.notifyChange("ready")})),this.notifyChange("ready")})).catch((e=>{Hn.warn("Request to server for legend has failed!",e)}))):this._constructLegendElementsForWMTSlayer()}_getParentLayerOpacity(e){let t=1;const i=e.parent;return i&&"uid"in i&&(t=this._getParentLayerOpacity(i)),e.opacity*t}_isGroupActive(){const e=this.children;return!!e.length&&e.some((e=>e.ready))}_isScaleDrivenSizeVariable(e){if(e&&"size"!==e.type)return!1;const t=e,i=t.minSize,r=t.maxSize;return"object"==typeof i&&i?this._isScaleDrivenSizeVariable(i):"object"==typeof r&&r?this._isScaleDrivenSizeVariable(r):!!t.expression||Wn.test(t.valueExpression)}_isLayerScaleDriven(e){if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some((e=>this._isLayerScaleDriven(e)));const t=e.parent;if(!1===e.loaded&&t&&ua(t)&&"source"in e&&e.source&&"map-layer"===e.source.type)for(const i of t.sourceJSON.layers)if(i.id===e.source.mapLayerId&&(i.minScale>0||i.maxScale>0))return!0;return!1}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");const e=this.layer.activeLayer;if(this._handles.add(Rt(this.layer,"activeLayer",(()=>this._constructLegendElementsForWMTSlayer())),"wmts-activeLayer-watcher"),e.styleId&&e.styles){let t=null;e.styles.some((i=>e.styleId===i.id&&(t=i.legendUrl,!0))),t&&(this.legendElements=[{type:"symbol-table",title:e.title,infos:[{src:t,opacity:this.opacity}]}])}this.notifyChange("ready")}async _constructLegendElementsForWMSSublayers(){this.legendElements=[],this._handles.remove("wms-sublayers-watcher");const e=this.layer;let t=null;(e.customParameters||e.customLayerParameters)&&(t=n(n({},e.customParameters),e.customLayerParameters)),this._handles.add(Rt(this.layer,"sublayers",(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher"),this.legendElements=await this._generateLegendElementsForWMSSublayers(e.sublayers,t),this.notifyChange("ready")}async _generateLegendElementsForWMSSublayers(e,t){const i=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher");const r=e.toArray();for(const s of r){const e=s.watch(["title","visible","legendEnabled"],(()=>this._constructLegendElementsForWMSSublayers()));if(this._handles.add(e,"wms-sublayers-watcher"),s.visible&&s.legendEnabled){const e=await this._generateSymbolTableElementForWMSSublayer(s,t);e&&e.infos.length&&i.unshift(e)}}return i}async _generateSymbolTableElementForWMSSublayer(e,t){if(!e.legendUrl&&e.sublayers){const i=(await this._generateLegendElementsForWMSSublayers(e.sublayers,t)).filter((e=>e));return{type:"symbol-table",title:e.title,infos:i}}return this._generateSymbolTableElementForLegendUrl(e,t)}async _generateSymbolTableElementForLegendUrl(e,t){var i;let r=e.legendUrl;if(!r)return;const s={type:"symbol-table",title:e.title||e.name||e.id&&e.id+"",infos:[]};t&&(r+="?"+Ot(t));let n=null;const a=null==(i=e.layer)?void 0:i.opacity;try{n=(await Ie(r,{responseType:"image"})).data,n&&(n.style.opacity=a)}catch(l){}return s.infos.push({src:r,preview:n,opacity:a}),s}_getLegendLayers(e){const t=e&&e.hasDynamicLayers?e.dynamicLayers:null,i=t||"default",r=ma&&ma[i];return r?L(r):this._legendRequest(t).then((e=>{const t=e.layers;return ma[i]=t,t}))}_legendRequest(e){const t=this.layer;let i={f:"json",dynamicLayers:e};if(pa(t)){const e=t.exportImageServiceParameters.renderingRule;if(e&&(i.renderingRule=JSON.stringify(e.toJSON())),t.bandIds&&(i.bandIds=t.bandIds.join()),t.raster||t.viewId){const{raster:e,viewId:r}=t;i=n({raster:e,viewId:r},i)}}let r=t.url.replace(/(\/)+$/,"");if("version"in t&&t.version>=10.01){const e=r.indexOf("?");e>-1?r=r.substring(0,e)+"/legend"+r.substring(e):r+="/legend"}else{const e=r.toLowerCase().indexOf("/rest/"),t=r.substring(0,e)+r.substring(e+5,r.length);r="https://utility.arcgis.com/sharing/tools/legend?soapUrl="+encodeURI(t)+"&returnbytes=true"}return Ie(r,{query:i}).then((e=>e.data))}async _constructLegendElementsForBuildingSceneLayer(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add(Rt(e,"sublayers",(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForBuildingSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){Hn.warn("Request to server for legend has failed!",t)}}async _generateLegendElementsForBuildingSublayers(e,t){let i=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");const r=e.toArray();for(const s of r){const e=s.watch(["renderer","opacity","title","visible"],(()=>this._constructLegendElementsForBuildingSceneLayer()));if(this._handles.add(e,"sublayers-watcher"),s.visible){const e=s&&null!=s.opacity?s.opacity:null,r=null!=e?e*t:t;if("building-group"===s.type){const e={type:"symbol-table",title:s.title,infos:[]},t=await this._generateLegendElementsForBuildingSublayers(s.sublayers,r);e.infos.push(...t),i=[e,...i]}else s.renderer&&(i=[...await this._getRendererLegendElements(s.renderer,{title:s.title,opacity:r,sublayer:s}),...i])}}return i.filter((e=>!!e&&(!("infos"in e)||e.infos.length>0)))}async _constructLegendElementsForSublayers(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add(Rt(e,"sublayers",(()=>this._constructLegendElementsForSublayers)),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){Hn.warn("Request to server for legend has failed!",t)}}async _generateLegendElementsForSublayers(e,t,i){let r=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForSublayers())),"sublayers-watcher");let s=e.toArray();if(!i&&this.sublayerIds&&this.sublayerIds.length){const e=this.layer;s=this.sublayerIds.map((t=>e.findSublayerById(t))).filter(Boolean)}const n=new ds({layer:this.layer}),a=n.hasDynamicLayers&&n.dynamicLayers||"default";n.destroy();for(const l of s){const e=l.watch("renderer, opacity, title, visible, legendEnabled",((e,t,r)=>{var s;const n=ma&&ma[a];n&&!i&&(i=new Map,n.forEach((e=>i.set(e.layerId,e))));const o=null==(s=i)?void 0:s.get(l.id);("renderer"!==r||l.originIdOf("renderer")>2||!o)&&this._constructLegendElementsForSublayers()}));if(this._handles.add(e,"sublayers-watcher"),l.visible&&l.legendEnabled){const e=l&&null!=l.opacity?l.opacity:null,s=null!=e?e*t:t;if(l.renderer&&!l.sublayers&&l.originIdOf("renderer")>2)this.respectLayerVisibility&&!this._isSublayerInScale(l)||(await l.load(),r=[...await this._getRendererLegendElements(l.renderer,{title:l.title,opacity:s,sublayer:l}),...r]);else{const e=await this._generateSymbolTableElementForSublayer(l,s,i);e&&r.unshift(e)}}}return r.filter((e=>!!e&&(!("infos"in e)||e.infos.length>0)))}async _generateSymbolTableElementForSublayer(e,t,i){if(!i){i=new Map;const e=new ds({layer:this.layer});try{(await this._getLegendLayers(e)).forEach((e=>i.set(e.layerId,e)))}finally{e.destroy()}}const r=i.get(e.id);if(!r&&e.sublayers){const r=await this._generateLegendElementsForSublayers(e.sublayers,t,i);return{type:"symbol-table",title:e.title,infos:r}}return this._generateSymbolTableElementForLegendLayer(r,e,t)}_generateSymbolTableElementForLegendLayer(e,t,i){if(!e||!e.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;const r=t&&t.renderer;let s=t&&t.title||e.layerName;if(r){const e=t&&t.title||this._getRendererTitle(r,t);e&&(s&&"string"!=typeof e&&"title"in e&&(e.title=s),s=e)}const n={type:"symbol-table",title:s,infos:[]};e.legendType&&(n.legendType=e.legendType);const a=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return n.infos=a.map((t=>{let r=t.url;if(t.imageData&&t.imageData.length>0)r=`data:image/png;base64,${t.imageData}`;else{if(0===r.indexOf("http"))return null;r=Dt(`${this.layer.url}/${e.layerId}/images/${r}`)}return{label:t.label,src:r,opacity:null==i?this.opacity:i,width:t.width,height:t.height}})).filter((e=>!!e)),n.infos.length?n:null}_isSublayerInScale(e){const t=e.minScale||0,i=e.maxScale||0;return!(t>0&&t<this.scale||i>this.scale)}_isLegendLayerInScale(e,t){const i=t||this.layer;let r=null,s=null,n=!0;return!i.minScale&&0!==i.minScale||!i.maxScale&&0!==i.maxScale?(0===e.minScale&&i.tileInfo&&(r=i.tileInfo.lods[0].scale),0===e.maxScale&&i.tileInfo&&(s=i.tileInfo.lods[i.tileInfo.lods.length-1].scale)):(r=Math.min(i.minScale,e.minScale)||i.minScale||e.minScale,s=Math.max(i.maxScale,e.maxScale)),(r>0&&r<this.scale||s>this.scale)&&(n=!1),n}_sanitizeLegendForSublayer(e,t){if("version"in this.layer&&this.layer.version<10.1||0===e.length)return e;const i=t.renderer,r=e.some((e=>e.values));let s=null,n=null;return r&&e.some(((e,t)=>(e.values||(s=t,n=e,n.label||(n.label="others")),null!=n))),i?"unique-value"===i.type?n&&(e.splice(s,1),e.push(n)):"class-breaks"===i.type&&(n&&e.splice(s,1),e.reverse(),n&&e.push(n)):n&&(e.splice(s,1),e.push(n)),e}async _getRendererLegendElements(e,t={}){return ia(i=e)||ra(i)||sa(i)||ea(i)||Xn(i)||na(i)||aa(i)||la(i)||oa(i)||ca(i)||Kn(i)||ta(i)?function(e){return aa(e)||la(e)||oa(e)||"esri.renderers.PointCloudRGBRenderer"===e.declaredClass}(e)?this._constructPointCloudRendererLegendElements(e,t):ca(e)?this._constructDotDensityRendererLegendElements(e):this._constructRendererLegendElements(e,t):(Hn.warn("Renderer not supported!"),[]);var i}_getPointCloudRendererTitle(e){return e.legendOptions&&e.legendOptions.title||e.field}_constructPointCloudRendererLegendElements(e,t={}){const i=t.title,r=[];let s=null,n=null;if(aa(e))s={type:"symbol-table",title:i||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach((e=>{s.infos.unshift({label:e.label||e.minValue+" - "+e.maxValue,value:[e.minValue,e.maxValue],symbol:this._getAppliedCloneSymbol(Jn,e.color)})}));else if(la(e)){const t=e.stops;let r=null;if(t.length&&(1===t.length&&(r=t[0].color),!r)){const e=t[0].value,i=t[t.length-1].value;null!=e&&null!=i&&(r=As(e+(i-e)/2,t))}s={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(Jn,r||Jn.color)}]};const a=function(e){let t=!1,i=[],r=[];i=e.map((e=>e.value)),t=e.some((e=>!!e.label)),t&&(r=e.map((e=>e.label)));const s=i[0],n=i[i.length-1];if(null==s&&null==n)return null;const a=t?null:Cs(i,!1);return i.map(((i,s)=>({value:i,color:As(i,e),label:t?r[s]:a[s]}))).reverse()}(e.stops);n={type:"color-ramp",title:i||this._getPointCloudRendererTitle(e),infos:a,preview:ys(a.map((e=>e.color)))}}else oa(e)&&(s={type:"symbol-table",title:i||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos.forEach((e=>{s.infos.push({label:e.label||e.values.join(", "),value:e.values.join(", "),symbol:this._getAppliedCloneSymbol(Jn,e.color)})})));s&&s.infos.length&&r.push(s),n&&n.infos.length&&r.push(n);const a=r.reduce(((e,t)=>e.concat(t.infos)),[]).filter((e=>!!e.symbol)).map((t=>this._getSymbolPreview(t,this.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}})));return Et(a).then((()=>r))}_getElementInfoForDotDensity(e,t){const{backgroundColor:i,outline:r,dotSize:s}=e,n=s+"-"+t+"-"+i+"-"+(r&&JSON.stringify(r.toJSON())),a=this._dotDensityUrlCache,l=a.has(n)?a.get(n):function(e,t,i){const{backgroundColor:r,outline:s,dotSize:n}=e,a=i&&i.swatchSize||22,l=Math.round(a*a/Math.pow(n,2)*.8),o=window.devicePixelRatio,c=document.createElement("canvas"),d=a*o;c.width=d,c.height=d,c.style.width=c.width/o+"px",c.style.height=c.height/o+"px";const u=c.getContext("2d");if(r&&(u.fillStyle=r.toCss(!0),u.fillRect(0,0,d,d),u.fill()),u.fillStyle=t.toCss(!0),us&&us.length/2===l)for(let y=0;y<2*l;y+=2){const e=us[y],t=us[y+1];u.fillRect(e,t,n*o,n*o),u.fill()}else{us=[];for(let e=0;e<2*l;e+=2){const e=ps(0,d),t=ps(0,d);us.push(e,t),u.fillRect(e,t,n*o,n*o),u.fill()}}s&&(s.color&&(u.strokeStyle=s.color.toCss(!0)),u.lineWidth=s.width,u.strokeRect(0,0,d,d));const p=new Image(a,a);return p.src=c.toDataURL(),p}(e,t);return a.set(n,l),{opacity:1,src:l.src,preview:l,width:l.width,height:l.height}}_constructDotDensityRendererLegendElements(e){const t=e.calculateDotValue(this.view.scale),i=e.legendOptions&&e.legendOptions.unit,r={type:"symbol-table",title:{value:t&&Math.round(t),unit:i||""},infos:[]};return e.attributes.forEach((t=>{const i=this._getElementInfoForDotDensity(e,t.color);i.label=t.label||t.valueExpressionTitle||t.field,r.infos.push(i)})),L([r])}async _constructRendererLegendElements(e,t={}){const{title:i,sublayer:r}=t,s=r||this.layer;let n=await this._loadRenderer(e);this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null;const a=await this._getVisualVariableLegendElements(n,s)||[],l={type:"symbol-table",title:i||this._getRendererTitle(n,s),infos:[]};let o=null,c=!1;const d=new Set;if(function(e){const t="authoringInfo"in e&&(null==e?void 0:e.authoringInfo);return"univariate-color-size"===(null==t?void 0:t.type)&&"above-and-below"===(null==t?void 0:t.univariateTheme)}(n)){const e={type:"univariate-above-and-below-ramp",title:i,infos:[]},t=a.findIndex((e=>"color-ramp"===e.type)),r=a.splice(t,1)[0],s=a.findIndex((e=>"size-ramp"===e.type)),n=a.splice(s,1)[0];r&&(e.title=r.title,e.infos.push(r)),n&&(e.title=n.title,e.infos.push(n)),a.push(e)}else if(na(n)){const e=function(e){let t=e.colorStops,i=t.length-1;if(t&&t[0]){const e=t[i];e&&1!==e.ratio&&(t=t.slice(0),t.push(new ht({ratio:1,color:e.color})),i++)}return t.map(((e,t)=>{let r="";return 0===t?r="low":t===i&&(r="high"),{color:e.color,label:r,ratio:e.ratio}})).reverse()}(n);a.push({type:"heatmap-ramp",title:i,infos:e,preview:ys(e.map((e=>e.color)))})}else if(sa(n)){const e=n&&n.authoringInfo;if(e&&"relationship"===e.type){const{focus:t,numClasses:i,field1:r,field2:o}=e;if(i&&r&&o){const e=[r,o];let c=zn(t)||0;for(const t of e){const{field:e,normalizationField:i,label:r}=t,n=r||{field:this._getFieldAlias(e,s),normField:i&&this._getFieldAlias(i,s)},a=ha.clone();a.angle=c,l.infos.push({label:n,symbol:a}),d.add(a),c+=90}const u=function(e){const{focus:t,infos:i,numClasses:r}=e,s=Dn[r],n={};i.forEach((e=>{n[e.value]={label:e.label,fill:Pn(e.symbol)}}));const a=[];for(let l=0;l<r;l++){const e=[];for(let t=0;t<r;t++){const i=n[s[l][t]];e.push(i.fill)}a.push(e)}return{type:"relationship-ramp",numClasses:r,focus:t,colors:a,labels:function(e,t){const i=t.HH.label,r=t.LL.label,s=t.HL.label,n=t.LH.label;switch(e){case"HH":return{top:i,bottom:r,left:s,right:n};case"HL":return{top:s,bottom:n,left:r,right:i};case"LL":return{top:r,bottom:i,left:n,right:s};case"LH":return{top:n,bottom:s,left:i,right:r};default:return{top:i,bottom:r,left:s,right:n}}}(t,n),rotation:zn(t)}}({focus:t,numClasses:i,infos:n.uniqueValueInfos});a.unshift(u)}}else{const e=n.field;n.uniqueValueInfos.forEach((t=>{t.symbol&&l.infos.push({label:t.label||this._getDomainName(e,t.value,s)||t.value,value:t.value,symbol:t.symbol})}))}n.defaultSymbol&&(l.infos.push({label:n.defaultLabel||"others",symbol:n.defaultSymbol}),c=!0)}else if(ra(n))o=this._isUnclassedRenderer(n),(!o||!this._hasSizeRamp)&&(n.classBreakInfos.forEach((e=>{e.symbol&&l.infos.unshift({label:e.label||(o?null:e.minValue+" - "+e.maxValue),value:[e.minValue,e.maxValue],symbol:e.symbol})})),o&&(l.title=null),this._updateInfosforClassedSizeRenderer(n,l.infos)),n.defaultSymbol&&!o&&(l.infos.push({label:n.defaultLabel||"others",symbol:n.defaultSymbol}),c=!0);else if(ea(n))if("esri.layers.ImageryTileLayer"===this.layer.declaredClass||ya(this.layer)){const e=this._constructTileImageryStretchRendererElements(n);"stretch-ramp"===e.type?a.push(e):l.infos=e}else{const e=this.layer;let t,i;n.statistics&&n.statistics.length&&(t=n.statistics[0].min||n.statistics[0][0],i=n.statistics[0].max||n.statistics[0][1]);let r=[];const s=Pt(e.renderingRule?await e.generateRasterInfo(e.renderingRule):e.serviceRasterInfo),o=s.keyProperties.BandProperties;1===s.bandCount?(t=t||s.statistics&&s.statistics[0].min,i=i||s.statistics&&s.statistics[0].max,t||i?a.push(this._getStretchLegendElements(n,{min:t,max:i})):this.buildLegendElementsForTools()):e.bandIds&&1===e.bandIds.length?(t=t||s.statistics&&s.statistics[e.bandIds[0]].min,i=i||s.statistics&&s.statistics[e.bandIds[0]].max,t||i?a.push(this._getStretchLegendElements(n,{min:t,max:i})):this.buildLegendElementsForTools()):s.bandCount>=3?o&&o.length>=s.bandCount?e.bandIds&&3===e.bandIds.length?(r=e.bandIds.map((e=>o[e].BandName)),l.infos=this._createSymbolTableElementMultiBand(r)):"lerc"===e.format?(r=[0,1,2].map((e=>o[e].BandName)),l.infos=this._createSymbolTableElementMultiBand(r)):this.buildLegendElementsForTools():"lerc"===e.format?(r=["band1","band2","band3"],l.infos=this._createSymbolTableElementMultiBand(r)):this.buildLegendElementsForTools():this.buildLegendElementsForTools()}else if(Xn(n))n.colormapInfos.forEach((e=>{l.infos.push({label:e.label,value:e.value,symbol:this._getAppliedCloneSymbol(Yn,e.color)})}));else if(ia(n)){let e=n.symbol;switch(t.geometryType){case"point":e="pointSymbol"in s&&s.pointSymbol;break;case"polyline":e="lineSymbol"in s&&s.lineSymbol;break;case"polygon":e="polygonSymbol"in s&&s.polygonSymbol}n.symbol&&!this._hasSizeRamp&&l.infos.push({label:n.label,symbol:e})}else if(Kn(n)){n.outputUnit&&(this.title="("+n.toJSON().outputUnit+")"),l.title=n.attributeField;const e=n.getClassBreakInfos();null!=e&&e.length?e.forEach((e=>{l.infos.push({label:e.minValue+" - "+e.maxValue,symbol:e.symbol})})):l.infos.push({label:n.attributeField,symbol:n.getDefaultSymbol()})}else ta(n)&&a.push(this._getStretchLegendElements(n,{min:0,max:255}));const u=n.defaultSymbol;!u||c||ia(n)||o&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||a.push({type:"symbol-table",infos:[{label:n.defaultLabel||"others",symbol:u}]}),l.infos.length&&a.unshift(l);const p=null==t.opacity?this.opacity:t.opacity,y=this._isTallSymbol("visualVariables"in n&&n.visualVariables),h=pa(this.layer),m=a.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]).filter((e=>!(!e||!e.symbol))).map((e=>this._getSymbolPreview(e,p,{applyScaleDrivenSize:!d.has(e.symbol),symbolConfig:{isTall:y,isSquareFill:h}})));return n=null,await Et(m),a}_getAllInfos(e){const t=null==e?void 0:e.infos;return t?t.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]):[e]}_constructTileImageryStretchRendererElements(e){const t=this.layer,i=t.rasterInfo,r=i.bandCount||e.statistics.length;let s,n,a=[];const l=i.keyProperties&&i.keyProperties.BandProperties;if(e.statistics&&e.statistics.length)s=void 0!==e.statistics[0].min?e.statistics[0].min:e.statistics[0][0],n=e.statistics[0].max||e.statistics[0][1];else if(ya(t)){const e=Qn[t.rasterInfo.pixelType.toLowerCase()];s=e[0],n=e[1]}if(1===i.bandCount)return this._getStretchLegendElements(e,{min:s,max:n});function o(e){var r;const s=((null==t||null==(r=t.bandIds)?void 0:r.length)===i.bandCount?t.bandIds:Array.from(Array(Math.min(i.bandCount,3)).keys())).map((t=>e&&e[t]&&e[t].BandName||"band"+(t+1)));return s.length<3?s.push(s[1]):s.length>3&&s.splice(3),s}return a=l&&l.length>=r?o(l):o(),this._createSymbolTableElementMultiBand(a)}_getStretchLegendElements(e,t){const i=function(e,t){let i=[];if(e&&"multipart"===e.type)e.colorRamps.reverse().forEach((function(r,s){0===s?i.push({value:t.max,color:new Ze(r.toColor),label:"high"}):i.push({value:null,color:new Ze(r.toColor),label:""}),s===e.colorRamps.length-1?i.push({value:t.min,color:new Ze(r.fromColor),label:"low"}):i.push({value:null,color:new Ze(r.fromColor),label:""})}));else{let r,s;e&&"algorithmic"===e.type?(r=e.fromColor,s=e.toColor):(r=[0,0,0,1],s=[255,255,255,1]),i=[{value:t.max,color:new Ze(s),label:"high"},{value:t.min,color:new Ze(r),label:"low"}]}return i}(e.colorRamp,t);return{type:"stretch-ramp",title:"",infos:i,preview:ys(i.map((e=>e.color)))}}_createSymbolTableElementMultiBand(e){const t=[],i=["red","green","blue"];return e.forEach(((e,r)=>{t.push({label:{colorName:i[r],bandName:e},src:xs[r],opacity:1})})),t}_updateInfosforClassedSizeRenderer(e,t){const i=e.authoringInfo&&"class-breaks-size"===e.authoringInfo.type,r=e.classBreakInfos.some((e=>rs(e.symbol)));if(i&&r){const i=30,r=12,s=e.classBreakInfos.length,n=(i-r)/(s>1?s-1:s);t.forEach(((e,t)=>{e.size=i-n*t}))}}_isTallSymbol(e){let t=!1,i=!1;if(e)for(let r=0;r<e.length&&(!t||!i);r++){const s=e[r];"size"===s.type&&("height"===s.axis&&(t=!0),"width-and-depth"===s.axis&&(i=!0))}return t&&i}async _getSymbolPreview(e,t,i){let r=null==e.size&&this._hasSizeRamp?tt(22):e.size;if(this._scaleDrivenSizeVariable&&null!=i&&i.applyScaleDrivenSize){const{getSize:t}=await import("./vendor.1ee57f36.js").then((function(e){return e.jP}));r=t(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:"simple-marker"===e.symbol.type?e.symbol.style:null})}return hs(e.symbol,{size:r,opacity:t,scale:!1,symbolConfig:null==i?void 0:i.symbolConfig,rotation:e.symbol.angle}).then((t=>(e.preview=t,e))).catch((()=>(e.preview=null,e)))}async _loadRenderer(e){var t,i;const r=[],s=this.layer;e=e.clone(),this._hasClusterSizeVariable=!1;const n="visualVariables"in e&&(null==(t=e.visualVariables)?void 0:t.some((e=>"size"===e.type&&"outline"!==e.target&&!Wn.test(e.valueExpression))));if(e&&"visualVariables"in e&&!n&&"featureReduction"in s&&"cluster"===(null==(i=s.featureReduction)?void 0:i.type)){const t=this.layerView._effectiveRenderer,i=Pt(function(e,t){if(!e||!("visualVariables"in e)||!e.visualVariables)return null;const i=e.visualVariables.find((e=>"size"===e.type)),r=((e,t)=>{const i=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return t.levels?t.levels[i]:null})(t,i);return r?new ct({field:i.field,minSize:r[2].size,minDataValue:r[2].value,maxSize:r[3].size,maxDataValue:r[3].value}):null}(t,this.view));if(i){const t=s.featureReduction;if("clusterMinSize"in t&&"clusterMaxSize"in t){const{clusterMinSize:e,clusterMaxSize:r}=t;i.legendOptions=new zt({showLegend:e!==r})}const r=e.visualVariables||[];e.visualVariables=r.concat([i]),this._hasClusterSizeVariable=!0}}const a=await this._getMedianColor(e);if(ra(e)||sa(e)){const t=(e.classBreakInfos||e.uniqueValueInfos).map((e=>this._fetchSymbol(e.symbol,a).then((t=>{e.symbol=t})).catch((()=>{e.symbol=null}))));Array.prototype.push.apply(r,t)}return r.push(this._fetchSymbol(e.symbol||e.defaultSymbol,e.defaultSymbol?null:a).then((t=>{this._applySymbolToRenderer(e,t,ia(e))})).catch((()=>{this._applySymbolToRenderer(e,null,ia(e))}))),Et(r).then((()=>e))}_applySymbolToRenderer(e,t,i){i?e.symbol=t:e.defaultSymbol=t}async _getMedianColor(e){if(!("visualVariables"in e)||!e.visualVariables)return null;const t=e.visualVariables.find((e=>"color"===e.type));if(!t)return null;let i=null,r=null;if(t.stops){if(1===t.stops.length)return t.stops[0].color;i=t.stops[0].value,r=t.stops[t.stops.length-1].value}const s=i+(r-i)/2,{getColor:n}=await import("./vendor.1ee57f36.js").then((function(e){return e.jP}));return n(t,s)}_fetchSymbol(e,t){if(!e)return x();if("web-style"===e.type){const i=e.portal,r=i&&i.url,s=i&&i.user&&i.user.username,n=e.name+"-"+e.styleName+"-"+e.styleUrl+"-"+r+"-"+s,a=this._webStyleSymbolCache;return a.has(n)||("2d"===this.view.type?a.set(n,e.fetchCIMSymbol()):a.set(n,e.fetchSymbol())),a.get(n).then((e=>this._getAppliedCloneSymbol(e,t))).catch((()=>(Hn.warn("Fetching web-style failed!"),x())))}return L(this._getAppliedCloneSymbol(e,t))}_getAppliedCloneSymbol(e,t){if(!e||!t)return e;const i=e.clone(),r=t&&t.toRgba();return i.type.indexOf("3d")>-1?this._applyColorTo3dSymbol(i,r):"cim"===i.type?Hr(i,t):i.color&&(i.color=new Ze(r||i.color)),i}_applyColorTo3dSymbol(e,t){t&&e.symbolLayers.forEach((e=>{e&&(e.material||(e.material={}),e.material.color=new Ze(t))}))}async _getVisualVariableLegendElements(e,t){if(!("visualVariables"in e)||!e.visualVariables||"vector-field"===e.type)return null;const i=e.visualVariables,r=[],s=[],n=[];for(const c of i)"color"===c.type?r.push(c):"size"===c.type?s.push(c):"opacity"===c.type&&n.push(c);const a=[...r,...s,...n];let l,o;if(0===r.length&&ra(e)&&e.classBreakInfos&&1===e.classBreakInfos.length){const t=e.classBreakInfos[0];l=t&&t.symbol}if(0===r.length&&ia(e)&&(l=e.symbol),l)if(l.type.indexOf("3d")>-1){const e=l.symbolLayers.getItemAt(0);"water"===e.type?_(e.color)&&(o=e.color):_(e.material)&&_(e.material.color)&&(o=e.material.color)}else l.url||(o=l.color);return(await yt(a.map((async i=>{if(!i.legendOptions||!1!==i.legendOptions.showLegend){const r=this._getRampTitle(i,t);let s=null;const n="getField"in t&&t.getField&&t.getField(i.field),a=n&&Vt(n);if("color"===i.type){const t=await ks(i,null,a,e);s={type:"color-ramp",title:r,infos:t,preview:ys(t.map((e=>e.color)))},this._hasColorRamp||(this._hasColorRamp=!(null==s.infos||!s.infos.length))}else if("size"===i.type&&"outline"!==i.target)Wn.test(i.valueExpression)?this._hasClusterSizeVariable||(this._scaleDrivenSizeVariable=i):(s={type:"size-ramp",title:this._hasClusterSizeVariable?this._getClusterTitle(i):r,infos:await Bn(e,i,await this._getMedianColor(e),this.scale,this.view.type,a)},this._hasSizeRamp||(this._hasSizeRamp=!(null==s.infos||!s.infos.length)));else if("opacity"===i.type){const e=await ks(i,o,a);s={type:"opacity-ramp",title:r,infos:e,preview:ys(e.map((e=>e.color)))},this._hasOpacityRamp||(this._hasOpacityRamp=!(null==s.infos||!s.infos.length))}return s&&s.infos?s:null}})))).filter((e=>!!e))}_getDomainName(e,t,i){if(e&&"function"!=typeof e){const r="getField"in i&&i.getField&&i.getField(e),s=r&&"getFieldDomain"in i&&i.getFieldDomain?i.getFieldDomain(r.name):null;return s&&"coded-value"===s.type?s.getName(t):null}return null}_getClusterTitle(e){const t=this.layer,i=e.field;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type){const e=t.featureReduction,r="popupTemplate"in e&&e.popupTemplate,s=r&&r.fieldInfos;if(s)for(const t of s)if(t.fieldName===i)return"cluster_count"===i?t.label||{showCount:!0}:t.label}return{showCount:!0}}_getRampTitle(e,t){let i=e.field,r=e.normalizationField,s=!1,n=!1,a=!1,l=null;i="function"==typeof i?null:i,r="function"==typeof r?null:r;const o=e.legendOptions&&e.legendOptions.title;if(null!=o)l=o;else if(e.valueExpressionTitle)l=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo&&t.renderer.authoringInfo.visualVariables){const e=t.renderer.authoringInfo.visualVariables;for(let t=0;t<e.length;t++){const i=e[t];if("color"===i.type){if("ratio"===i.style){s=!0;break}if("percent"===i.style){n=!0;break}if("percent-of-total"===i.style){a=!0;break}}}}l={field:i&&this._getFieldAlias(i,t),normField:r&&this._getFieldAlias(r,t),ratio:s,ratioPercent:n,ratioPercentTotal:a}}return l}_getRendererTitle(e,t){const i=e;if(i.legendOptions&&i.legendOptions.title)return i.legendOptions.title;if(i.valueExpressionTitle)return i.valueExpressionTitle;let r=i.field,s=null,n=null;ra(i)&&(s=i.normalizationField,n="percent-of-total"===i.normalizationType),r="function"==typeof r?null:r,s="function"==typeof s?null:s;let a=null;return(r||s)&&(a={field:r&&this._getFieldAlias(r,t),normField:s&&this._getFieldAlias(s,t),normByPct:n}),a}_getFieldAlias(e,t){const i="popupTemplate"in t&&t.popupTemplate,r=i&&i.fieldInfos;let s=null;r&&r.some((t=>e===t.fieldName&&(s=t,!0)));let n=null;"getField"in t&&t.getField?n=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(n=t.fieldsIndex.get(e));const a=s||n;let l=null;return a&&(l=s&&s.label||n&&n.alias||"name"in a&&a.name||"fieldName"in a&&a.fieldName),l}_isUnclassedRenderer(e){const t=e.visualVariables;let i=!1;return ra(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&t&&(i=e.field?t.some((t=>!(!t||e.field!==t.field||(e.normalizationField||t.normalizationField)&&e.normalizationField!==t.normalizationField))):!!t.length),i}};a([l()],fa.prototype,"children",void 0),a([l()],fa.prototype,"layerView",void 0),a([l()],fa.prototype,"layer",void 0),a([l()],fa.prototype,"legendElements",void 0),a([l({dependsOn:["parent","parent.opacity","layer","layer.opacity"],readOnly:!0})],fa.prototype,"opacity",null),a([l()],fa.prototype,"parent",void 0),a([l({readOnly:!0,dependsOn:[],autoTracked:!1})],fa.prototype,"ready",null),a([l()],fa.prototype,"keepCacheOnDestroy",void 0),a([l()],fa.prototype,"respectLayerVisibility",void 0),a([l({dependsOn:["view.scale"],readOnly:!0})],fa.prototype,"scale",null),a([l()],fa.prototype,"sublayerIds",void 0),a([l({dependsOn:["layer.renderer?.valueExpression?","layer.renderer?.visualVariables?","layer.featureReduction?","scale"],readOnly:!0})],fa.prototype,"isScaleDriven",null),a([l()],fa.prototype,"title",void 0),a([l({readOnly:!0,dependsOn:["ready"],autoTracked:!1,value:0})],fa.prototype,"version",null),a([l()],fa.prototype,"view",void 0),fa=a([o("esri.widgets.Legend.support.ActiveLayerInfo")],fa);var ga=fa;const ba="all-layer-views",va="legend-properties",wa=P.ofType(ga),_a=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.TileLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer"],La=["view.basemapView.baseLayerViews","view.groundView.layerViews","view.layerViews","view.basemapView.referenceLayerViews"];let Sa=class extends ot{constructor(e){super(e),this._handles=new ee,this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new P,this.activeLayerInfos=new wa,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null}initialize(){this._handles.add(Ft(this,"view",this._viewHandles),"view"),this._handles.add(jt((()=>this._refresh())))}destroy(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}_viewHandles(){this._handles.remove("state"),this.view&&this._handles.add(Ft(this,"state",this._stateHandles),"state")}_stateHandles(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews()}_resetAll(){this._handles.remove([ba,va]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}_destroyViewActiveLayerInfo(e){this._handles.remove(e);const t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t&&t.parent&&t.parent.children.remove(t)}_watchPropertiesAndAllLayerViews(){const{allLayerViews:e}=this.view;e.length&&this._refresh(),this._handles.add(e.on("change",this._allLayerViewsChangeHandle.bind(this)),ba),this._handles.add(Rt(this,"layerInfos, basemapLegendVisible, groundLegendVisible",this._propertiesChangeHandle.bind(this)),va)}_allLayerViewsChangeHandle(e){e.removed.forEach((e=>this._destroyViewActiveLayerInfo(e.uid))),this._refresh()}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh()}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}_sortActiveLayerInfos(e){if(e.length<2)return;const t=[];e.forEach((i=>{if(!i.parent){const r=i.layer.parent,s=r&&"uid"in r&&this._layerViewByLayerId[r.uid],n=s&&this._activeLayerInfosByLayerViewId[s.uid];n&&-1!==e.indexOf(n)&&(t.push(i),i.parent=n,n.children.add(i),this._sortActiveLayerInfos(n.children))}})),e.removeMany(t);const i={};this.view.allLayerViews.forEach(((e,t)=>i[e.layer.uid]=t)),e.sort(((e,t)=>{const r=i[e.layer.uid]||0;return(i[t.layer.uid]||0)-r}))}_generateLayerViews(){const e=[];return La.filter(this._filterLayerViews,this).map(this.get,this).filter((e=>null!=e)).forEach(this._collectLayerViews("layerViews",e)),e}_filterLayerViews(e){const t=!this.basemapLegendVisible&&("view.basemapView.baseLayerViews"===e||"view.basemapView.referenceLayerViews"===e),i=!this.groundLegendVisible&&"view.groundView.layerViews"===e;return!t&&!i}_collectLayerViews(e,t){const i=r=>(r&&r.forEach((r=>{t.push(r),i(r[e])})),t);return i}_filterLayerViewsByLayerInfos(e){const t=this.layerInfos;return!t||!t.length||t.some((t=>this._hasLayerInfo(t,e)))}_hasLayerInfo(e,t){const i=this._isLayerUIDMatching(e.layer,t.layer.uid);return i&&(this._layerInfosByLayerViewId[t.uid]=e),i}_isLayerUIDMatching(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}_hasLayerUID(e,t){return e&&e.some((e=>this._isLayerUIDMatching(e,t)))}_isLayerViewSupported(e){return _a.indexOf(e.layer.declaredClass)>-1&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}_generateActiveLayerInfo(e){this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add(Rt(e,"legendEnabled, layer.legendEnabled",(()=>this._layerActiveHandle(e))),e.uid))}_layerActiveHandle(e){this._isLayerActive(e)&&(this._handles.remove(e.uid),this._buildActiveLayerInfo(e))}_isLayerActive(e){return!this.respectLayerVisibility||e.legendEnabled&&e.get("layer.legendEnabled")}_buildActiveLayerInfo(e){var t;const i=e.layer,r=e.uid,s=this._layerInfosByLayerViewId[r];let n=this._activeLayerInfosByLayerViewId[r];if(!n){const t=s&&void 0!==s.title&&s.layer.uid===i.uid;n=new ga({layer:i,layerView:e,title:t?s.title:i.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:s&&s.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[r]=n}const a=i.parent&&"uid"in i.parent&&this._layerViewByLayerId[null==(t=i.parent)?void 0:t.uid];if(n.parent=this._activeLayerInfosByLayerViewId[null==a?void 0:a.uid],!this._handles.has(r)){const t=[Rt(i,"title",(e=>this._titleHandle(e,n))),Rt(i,"renderer?, opacity, pointSymbol?, lineSymbol?, polygonSymbol?",(()=>this._constructLegendElements(n))),Nt(this.view,"stationary",(()=>this._scaleHandle(n))),Rt(e,"_effectiveRenderer",(()=>this._constructLegendElements(n)))];if(this.respectLayerVisibility){const r=Rt(e,"legendEnabled",(e=>this._legendEnabledHandle(e,n))),s=Rt(i,"legendEnabled",(e=>this._legendEnabledHandle(e,n)));t.push(r,s)}this._handles.add(t,r)}n.isScaleDriven||this._constructLegendElements(n),this._addActiveLayerInfo(n)}_titleHandle(e,t){t.title=e,this._constructLegendElements(t)}_legendEnabledHandle(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}_scaleHandle(e){e.isScaleDriven&&this._constructLegendElements(e)}_addActiveLayerInfo(e){const{layerView:t,layer:i}=e;if(this._isLayerActive(t)&&-1===this.activeLayerInfos.indexOf(e)){const t=e.parent;if(t)-1===t.children.indexOf(e)&&t.children.push(e),this._sortActiveLayerInfos(t.children);else{var r;const t=null==(r=this.layerInfos)?void 0:r.some((e=>e.layer.uid===i.uid));i.parent&&"uid"in i.parent&&!t?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){const e=[];this._activeLayerInfosWithNoParent.forEach((t=>{const i=t.layer.parent,r=i&&"uid"in i&&this._layerViewByLayerId[null==i?void 0:i.uid],s=this._activeLayerInfosByLayerViewId[null==r?void 0:r.uid];s&&(e.push(t),t.parent=s)})),e.length&&(this._activeLayerInfosWithNoParent.removeMany(e),e.forEach((e=>this._addActiveLayerInfo(e))))}}}_removeActiveLayerInfo(e){const t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}_constructLegendElements(e){const t=e.layer;"featureCollections"in t&&t.featureCollections?e.buildLegendElementsForFeatureCollections(t.featureCollections):"renderer"in t&&t.renderer?e.buildLegendElementsForRenderer(t.renderer):"url"in t&&t.url?e.buildLegendElementsForTools():e.children.forEach((e=>this._constructLegendElements(e)))}};a([l({type:wa})],Sa.prototype,"activeLayerInfos",void 0),a([l()],Sa.prototype,"basemapLegendVisible",void 0),a([l()],Sa.prototype,"groundLegendVisible",void 0),a([l()],Sa.prototype,"keepCacheOnDestroy",void 0),a([l()],Sa.prototype,"respectLayerVisibility",void 0),a([l()],Sa.prototype,"layerInfos",void 0),a([l({dependsOn:["view.ready"],readOnly:!0})],Sa.prototype,"state",null),a([l()],Sa.prototype,"view",void 0),Sa=a([o("esri.widgets.Legend.LegendViewModel")],Sa);var Ia=Sa;const xa=Lt(),Ma="esri-relationship-ramp--diamond__middle-column--label",Ea="esri-relationship-ramp--square__table-row",Ca="esri-relationship-ramp--square__table-cell",ka="esri-relationship-ramp--square__table-label",Aa="esri-univariate-above-and-below-ramp__symbol";function Fa(e,t,i){const{focus:r,labels:s}=e,n=!!r,a=function(e,t,i,r=60){const{focus:s,numClasses:n,colors:a,rotation:l}=e,o=!!s,c=Math.sqrt(Math.pow(r,2)+Math.pow(r,2))+(o?0:5);let d=null;null!=i&&(d=`opacity: ${i}`);const u=[],p=[],y=[],h=(r||75)/n;for(let _=0;_<n;_++){const e=_*h;for(let t=0;t<n;t++){const i=t*h,r=sn(a[_][t]),s=nn(null),n={type:"rect",x:i,y:e,width:h,height:h};u.push(ln(r)),p.push(rn(n,r.fill,s,null)),y.push(yn(n))}}let m=null;o||(m="margin: -15px -15px -18px -15px");const f=Ta("left",s,t),g=Ta("right",s,t),b=hn(y),v=mn(b,c,c,0,!1,l),w=mn(b,c,c,0,!1,o?-45:null);return mt("div",{style:d,class:o?"esri-relationship-ramp--diamond__middle-column--ramp":Ca},mt("svg",{xmlns:"http://www.w3.org/2000/svg",width:c,height:c,style:m},mt("defs",null,mt("marker",{id:`${t}_arrowStart`,markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},mt("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),mt("marker",{id:`${t}_arrowEnd`,markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},mt("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),u),mt("g",{transform:v},p),mt("g",{transform:w},mt("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":f.markerStart,"marker-end":f.markerEnd,x1:-10,y1:r-15,x2:-10,y2:15}),mt("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":g.markerStart,"marker-end":g.markerEnd,x1:15,y1:r+10,x2:r-15,y2:r+10}))))}(e,t,i);return n?mt("div",{class:"esri-relationship-ramp--diamond__container"},mt("div",{class:"esri-relationship-ramp--diamond__left-column"},s.left),mt("div",{class:"esri-relationship-ramp--diamond__middle-column"},mt("div",{class:Ma},s.top),a,mt("div",{class:Ma},s.bottom)),mt("div",{class:"esri-relationship-ramp--diamond__right-column"},s.right)):mt("div",{class:"esri-relationship-ramp--square__table"},mt("div",{class:Ea},mt("div",{class:Bt(Ca,ka,"esri-relationship-ramp--square__table-label--right-bottom")},s.left),mt("div",{class:Ca}),mt("div",{class:Bt(Ca,ka,"esri-relationship-ramp--square__table-label--left-bottom")},s.top)),mt("div",{class:Ea},mt("div",{class:Ca}),a,mt("div",{class:Ca})),mt("div",{class:Ea},mt("div",{class:Bt(Ca,ka,"esri-relationship-ramp--square__table-label--right-top")},s.bottom),mt("div",{class:Ca}),mt("div",{class:Bt(Ca,ka,"esri-relationship-ramp--square__table-label--left-top")},s.right)))}function Ta(e,t,i){const r=`${i}_arrowStart`,s=`${i}_arrowEnd`,n="left"===e,a={markerStart:null,markerEnd:null};switch(t){case"HL":n?a.markerStart=`url(#${s})`:a.markerEnd=`url(#${r})`;break;case"LL":a.markerStart=`url(#${s})`;break;case"LH":n?a.markerEnd=`url(#${r})`:a.markerStart=`url(#${s})`;break;default:a.markerEnd=`url(#${r})`}return a}function Ra(e="vertical"){const t="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?mt("svg",{height:"4",width:"10"},mt("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:t})):mt("svg",{height:"10",width:"10"},mt("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:t}))}function Oa(e,t="vertical"){const i=document.createElement("div");return i.style.height="20px",i.className=Aa,null!=e&&(i.style.opacity=e.toString()),xa.append(i,Ra.bind(null,t)),i}function Da(e,t="classic"){const i=e.infos;return"classic"===t?(Ye(i[0].size)+10)/2:(i[0].size-i[i.length-1].size)/2}function Pa(e,t){if(!e)return null;const i=e.infos.map((e=>e.color)),r=ys("full"===t.type?i:"above"===t.type?i.slice(0,3):i.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment});return r.className="esri-legend__color-ramp",null!=t.opacity&&(r.style.opacity=t.opacity.toString()),r}function za(e,t,i="vertical"){let r=0;const s=e.infos,n="full"===t||"below"===t?4:2;for(let a="full"===t||"above"===t?0:2;a<=n;a++)r+=2===a?"horizontal"===i?10:20:Ye(s[a].size)+("horizontal"===i?20:10);return r}function Va(e,t,i="vertical"){const r=za(e,t,i),s=e.infos,n="full"===t||"above"===t?0:2,a="full"===t||"below"===t?4:2,l="full"===t?s[n].size+s[a].size:"above"===t?s[n].size:s[a].size;return r-(Ye(l/2)+15)}function ja(e,t,i="vertical"){const r=e.infos;let s=r.filter((({type:e})=>"size-ramp"===e))[0],a=r.filter((({type:e})=>"color-ramp"===e))[0];var l;return s&&(s=n({},s),s.infos=[...s.infos]),a&&(a=n({},a),a.infos=[...a.infos]),function(e,t,i="vertical"){e.infos.forEach(((e,r)=>{if(2===r)e.preview=Oa(t,i);else{const t=Ye(e.size)+("horizontal"===i?20:10),r="div"===e.preview.tagName.toLowerCase(),s=r?e.preview:document.createElement("div");s.className=Aa,"horizontal"===i?s.style.width=`${t}px`:s.style.height=`${t}px`,r||s.appendChild(e.preview),e.preview=s}}))}(s,t,i),"horizontal"===i&&(s.infos.reverse(),null==(l=a)||l.infos.reverse()),{sizeRampElement:s,colorRampElement:a}}function Na(e){e.appendChild(this)}function Ba(e,t,i){if(!t)return;if("string"==typeof t||"number"==typeof t)return t;if("value"in t||"unit"in t)return qt(e.dotValue,t);if("colorName"in t||"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:null;let r=null;return i?r=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:qa(t,i)&&(r=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),r?qt("showField"===r?"{field}":e[r],{field:t.field,normField:t.normField}):null}function qa(e,t){return!t}function Ga(e,t){return!!(t&&"Stretched"===t&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}const $a="esri-legend--card__image-label",Ua="esri-legend--card__layer-caption",Ha="esri-legend--card__layer-row",Wa="esri-legend--card__ramp-label",Za="esri-legend--card__section",Qa="esri-legend--card__service",Ja="esri-legend--card__symbol",Ya="esri-legend--card__symbol-row",Ka="esri-legend--card__service-caption-container",Xa="esri-legend--card__symbol-container",el="esri-legend--card__size-ramp-container",tl="esri-widget__heading",il="esri-legend--card__",rl=window.devicePixelRatio;let sl=class extends Ht{constructor(e,t){super(e,t),this._handles=new ee,this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.layout="stack",this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}initialize(){this.own([this.watch("activeLayerInfos",(e=>{this._handles.removeAll(),this._watchForSectionChanges(e)}))])}destroy(){this._handles.destroy(),this._handles=null}render(){this._hasIndicators="auto"===this.layout&&this.view.container.clientWidth<=768||"stack"===this.layout;const e=this.activeLayerInfos,t=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));this._hasIndicators?this._selectedSectionName&&-1!==this._sectionNames.indexOf(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const i=this._sectionNames.length,r=this._sectionNames.map(((e,t)=>{const r=qt(this.messagesCommon.pagination.pageText,{index:t+1,total:i});return mt("div",{key:e,"aria-label":r,title:r,tabIndex:0,onclick:this._selectSection,onkeydown:this._selectSection,bind:this,class:this.classes("esri-legend--card__carousel-indicator",{"esri-legend--card__carousel-indicator--activated":this._selectedSectionName===e}),"data-section-name":e})})),s=this._hasIndicators&&i>1?mt("div",{class:"esri-legend--card__carousel-indicator-container",key:"carousel-navigation"},r):null,n=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):t&&t.length?t:null,a={"esri-legend--stacked":this._hasIndicators};return mt("div",{class:this.classes("esri-legend--card",a)},s,n||mt("div",{class:"esri-legend--card__message"},this.messages.noLegend))}_selectSection(e){const t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach((e=>{const t=`activeLayerInfo-${e.layer.uid}-version-change`;this._handles.remove(t),this._watchForSectionChanges(e.children),this._handles.add(e.watch("version",(()=>this._generateSectionNames())),t)}));const t="activeLayerInfos-collection-change";this._handles.remove(t),this._handles.add(e.on("change",(()=>this._watchForSectionChanges(e))),t)}}_generateSectionNames(){this._sectionNames.length=0,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach(((t,i)=>{this._sectionNames.push(`${il}${e.layer.uid}-type-${t.type}-${i}`)}))}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const t=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return mt("div",{key:e.layer.uid,class:this.classes(Qa,"esri-legend--card__group-layer")},mt("div",{class:Ka},e.title),t)}{const t=e.legendElements;if(t&&!t.length)return null;const i=t.some((e=>"relationship-ramp"===e.type)),r=t.map(((t,r)=>this._renderLegendForElement(t,e,r,i))).filter((e=>!!e));if(!r.length)return null;const s={"esri-legend--card__group-layer-child":!!e.parent};return mt("div",{key:e.layer.uid,class:this.classes(Qa,s)},mt("div",{class:Ka},mt("div",{class:"esri-legend--card__service-caption-text"},e.title)),mt("div",{class:"esri-legend--card__service-content"},r))}}_renderLegendForElement(e,t,i,r=!1){const s="color-ramp"===e.type,n="opacity-ramp"===e.type,a="size-ramp"===e.type,l=t.layer,o=e.title;let c=null;if("string"==typeof o)c=o;else if(o){const e=Ba(this.messages,o,s||n);c=o.title?`${o.title} (${e})`:e}const d=`${il}${l.uid}-type-${e.type}-${i}`,u=this._hasIndicators?mt("div",null,mt("h3",{class:this.classes(tl,"esri-legend--card__carousel-title")},t.title),mt("h4",{class:this.classes(tl,Ua)},c)):c?mt("h4",{class:this.classes(tl,Ua)},c):null;let p=null;if("symbol-table"===e.type){const i=e.infos.map(((i,r)=>this._renderLegendForElementInfo(i,t,e.legendType,r))).filter((e=>!!e));if(i.length){const e={"esri-legend--card__label-container":!(i[0].properties.classes&&i[0].properties.classes[Ya])&&!r,"esri-legend--card__relationship-label-container":r};p=mt("div",{key:d,class:Za},u,mt("div",{class:this.classes(e)},i))}}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type?p=mt("div",{key:d,class:Za},u,this._renderLegendForRamp(e,l.opacity)):a?p=mt("div",{key:d,class:Za},u,this._renderSizeRamp(e,l.opacity)):"relationship-ramp"===e.type?p=mt("div",{key:d,class:this.classes(Za,"esri-legend--card__relationship-section")},u,Fa(e,this.id,l.opacity)):"univariate-above-and-below-ramp"===e.type&&(p=mt("div",{key:d,class:Za},u,this._renderUnivariateAboveAndBelowRamp(e,l.opacity)));return p?(this._sectionMap.set(d,p),p):null}_renderUnivariateAboveAndBelowRamp(e,t){const{sizeRampElement:i,colorRampElement:r}=ja(e,t,"horizontal"),s=za(i,"full","horizontal"),n=Va(i,"above","horizontal"),a=Va(i,"below","horizontal"),l=Pa(r,{width:n,height:12,rampAlignment:"horizontal",opacity:t,type:"above"}),o=Pa(r,{width:a,height:12,rampAlignment:"horizontal",opacity:t,type:"below"}),c=Da(i,"card"),d=i.infos.map((e=>e.label)).map(((e,t)=>0===t||4===t?mt("div",{key:t},e):null)),u={marginTop:"3px",marginLeft:`${c}px`,display:"flex"},p={width:`${s}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return mt("div",{class:Ha,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},mt("div",{class:this.classes(Xa,"esri-legend__size-ramp--horizontal"),styles:{display:"flex",flexDirection:"row"}},i.infos.map(((e,t)=>mt("div",{key:t,class:Ja,bind:e.preview,afterCreate:Na})))),l?mt("div",{class:"esri-univariate-above-and-below-ramp__color--card",styles:u,key:"color-ramp-preview"},mt("div",{bind:l,afterCreate:Na}),mt("div",{bind:o,afterCreate:Na})):null,mt("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--info"},mt("div",{class:"esri-legend__ramp-labels",styles:p},d)))}_renderLegendForElementInfo(e,t,i,r){const s=t.layer;if(e.type)return this._renderLegendForElement(e,t,r);const n=Ga(s,i);if(e.preview){var a,l;if(-1===e.symbol.type.indexOf("simple-fill")){if(!e.label)return mt("div",{key:r,bind:e.preview,afterCreate:Na});const t={"esri-legend--card__symbol-cell":this._hasIndicators};return mt("div",{key:r,class:this.classes(Ha,{[Ya]:this._hasIndicators})},mt("div",{class:this.classes(t),bind:e.preview,afterCreate:Na}),mt("div",{class:this.classes($a,{"esri-legend--card__label-cell":this._hasIndicators})},Ba(this.messages,e.label,!1)||""))}let t=255,i=255,n=255,o=0,c=255,d=255,u=255,p=0;const y=e.symbol.color&&e.symbol.color.a,h=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;y&&(t=e.symbol.color.r,i=e.symbol.color.g,n=e.symbol.color.b,o=e.symbol.color.a*s.opacity),h&&(c=e.symbol.outline.color.r,d=e.symbol.outline.color.g,u=e.symbol.outline.color.b,p=e.symbol.outline.color.a*s.opacity);const m=null==(a=null==(l=e.symbol.color)?void 0:l.isBright)||a,f=m?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)";return mt("div",{key:r,class:Ha},mt("div",{class:"esri-legend--card__label-element",styles:{background:y?`rgba(${t}, ${i}, ${n}, ${o})`:"none",color:m?"black":"white",textShadow:`-1px -1px 0 ${f},\n                                              1px -1px 0 ${f},\n                                              -1px 1px 0 ${f},\n                                              1px 1px 0 ${f}`,border:h?`1px solid rgba(${c}, ${d}, ${u}, ${p})`:"none"}}," ",e.label," "))}if(e.src){const t=this._renderImage(e,s,n);return mt("div",{key:r,class:Ha},t,mt("div",{class:$a},e.label||""))}}_renderImage(e,t,i){const{label:r,src:s,opacity:n}=e,a={"esri-legend--card__imagery-layer-image--stretched":i,[Ja]:!i},l={opacity:`${null!=n?n:t.opacity}`};return mt("img",{alt:Ba(this.messages,r,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(a),styles:l})}_renderSizeRampLines(e){const t=e.infos,i=t[0],r=t[t.length-1],s=i.symbol,n=this._hasIndicators,a=Ye(i.size+i.outlineSize)*rl,l=Ye(r.size+r.outlineSize)*rl,o=n?a:a+50*rl,c=n?a/2+50*rl:a,d=function(e){if(e){if(e.type.indexOf("3d")>-1){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const i=e.symbolLayers.getItemAt(t-1).get("resource.primitive");return"triangle"===i||"cone"===i||"tetrahedron"===i}return"triangle"===e.style}}(s),u=function(e){if(e){if(e.type.indexOf("3d")>-1){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const i=e.symbolLayers.getItemAt(t-1),r=i.resource&&i.resource.primitive;return"circle"===r||"cross"===r||"kite"===r||"sphere"===r||"cube"===r||"diamond"===r}{const t=e.style;return"circle"===t||"diamond"===t||"cross"===t}}}(s),p=document.createElement("canvas");p.width=o,p.height=c,p.style.width=p.width/rl+"px",p.style.height=p.height/rl+"px";const y=p.getContext("2d");if(n){y.beginPath();const e=0,t=0,i=o/2-l/2,r=c;y.moveTo(e,t),y.lineTo(i,r);const s=o,n=0,a=o/2+l/2,d=c;y.moveTo(s,n),y.lineTo(a,d)}else{y.beginPath();const e=0,t=c/2-l/2,i=o,r=0;y.moveTo(e,t),y.lineTo(i,r);const s=0,n=c/2+l/2,a=o,d=c;y.moveTo(s,n),y.lineTo(a,d)}return y.strokeStyle="#ddd",y.stroke(),mt("div",{bind:p,afterCreate:Na,styles:n?{display:"flex",marginTop:`-${d?0:u?a/2:0}px`,marginBottom:`-${d?l:u?l/2:0}px`}:{display:"flex",marginRight:`-${d?0:u?a/2:0}px`,marginLeft:`-${d?0:u?l/2:0}px`}})}_renderSizeRamp(e,t){const i=e.infos,r=i[0].label,s=i[i.length-1].label;let n=i[0].preview,a=i[i.length-1].preview;const l=this._hasIndicators,o={"flex-direction":l?"column":"row-reverse"};n&&(n=n.cloneNode(!0),n.style.display="flex"),a&&(a=a.cloneNode(!0),a.style.display="flex");const c={opacity:null!=t?`${t}`:""};return mt("div",{class:this.classes(Ha,{"esri-legend--card__size-ramp-row":l})},mt("div",{class:Wa},l?r:s),mt("div",{class:el,styles:o},mt("div",{bind:n,afterCreate:Na,class:"esri-legend--card__size-ramp-preview",styles:c}),this._renderSizeRampLines(e),mt("div",{bind:a,afterCreate:Na,class:el,styles:c})),mt("div",{class:Wa},l?s:r))}_renderLegendForRamp(e,t){const i=e.infos,r="heatmap-ramp"===e.type,s=i.length-1,n=s>2&&!r?25*s:100,a=n+20,l=i.slice(0).reverse();l.forEach(((e,t)=>{e.offset=r?e.ratio:t/s}));const o=l.length-1,c=l.length%2!=0&&l[l.length/2|0],d=c&&mt("div",{class:"esri-legend--card__interval-separators-container"},mt("div",{class:"esri-legend--card__interval-separator"},"|"),mt("div",{class:Wa},c.label)),u=i[i.length-1].label,p=i[0].label;let y=null;null!=t&&(y=`opacity: ${t}`);const h=fn([[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:l[0].color,stroke:{width:0}},{shape:{type:"rect",x:10,y:0,width:n,height:25},fill:{type:"linear",x1:10,y1:0,x2:n+10,y2:0,colors:l},stroke:{width:0}},{shape:{type:"path",path:`M${n+10} 0 L${a} 12.5 L${n+10} 25 Z`},fill:l[o].color,stroke:{width:0}}]],a,25),{messages:m}=this;return mt("div",{class:Ha},mt("div",{class:Wa},r?m[u]:u),mt("div",{class:Xa},mt("div",{style:y},h),d),mt("div",{class:Wa},r?m[p]:p))}};a([Gt(),l()],sl.prototype,"activeLayerInfos",void 0),a([l()],sl.prototype,"layout",void 0),a([l(),Gt(),$t("esri/widgets/Legend/t9n/Legend")],sl.prototype,"messages",void 0),a([l(),Gt(),$t("esri/t9n/common")],sl.prototype,"messagesCommon",void 0),a([l({readOnly:!0})],sl.prototype,"type",void 0),a([l()],sl.prototype,"view",void 0),a([Ut()],sl.prototype,"_selectSection",null),sl=a([o("esri.widgets.Legend.styles.Card")],sl);var nl=sl;const al="esri-legend__service",ll="esri-legend__layer-body",ol="esri-legend__layer-row",cl="esri-legend__layer-cell esri-legend__layer-cell--info",dl="esri-legend__imagery-layer-info--stretched",ul="esri-legend__layer-cell esri-legend__layer-cell--symbols",pl="esri-legend__symbol",yl="esri-legend__ramps",hl="esri-legend__size-ramp",ml="esri-legend__ramp-labels",fl="esri-legend__ramp-label",gl="esri-univariate-above-and-below-ramp__label",bl={display:"flex",alignItems:"flex-start"},vl={marginLeft:"3px"},wl={display:"table-cell",verticalAlign:"middle"};let _l=class extends Ht{constructor(e,t){super(e,t),this.activeLayerInfos=null,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,t=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return mt("div",null,t&&t.length?t:mt("div",{class:"esri-legend__message"},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const t=!!e.children.length,i=`esri-legend__${e.layer.uid}-version-${e.version}`,r=e.title?mt("h3",{class:this.classes("esri-widget__heading","esri-legend__service-label")},e.title):null;if(t){const t=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return mt("div",{key:i,class:this.classes(al,"esri-legend__group-layer")},r,t)}{const t=e.legendElements;if(t&&!t.length)return null;const s=t.map((t=>this._renderLegendForElement(t,e.layer))).filter((e=>!!e));if(!s.length)return null;const n={"esri-legend__group-layer-child":!!e.parent};return mt("div",{key:i,class:this.classes(al,n)},r,mt("div",{class:"esri-legend__layer"},s))}}_renderLegendForElement(e,t,i){const r="color-ramp"===e.type,s="opacity-ramp"===e.type,n="size-ramp"===e.type;let a=null;if("symbol-table"===e.type||n){const i=e.infos.map((i=>this._renderLegendForElementInfo(i,t,n,e.legendType))).filter((e=>!!e));i.length&&(a=mt("div",{class:ll},i))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?a=this._renderLegendForRamp(e,t.opacity):"relationship-ramp"===e.type?a=Fa(e,this.id,t.opacity):"univariate-above-and-below-ramp"===e.type&&(a=this._renderUnivariateAboveAndBelowRamp(e,t.opacity));if(!a)return null;const l=e.title;let o=null;if("string"==typeof l)o=l;else if(l){const e=Ba(this.messages,l,r||s);o=qa(0,r||s)&&l.title?`${l.title} (${e})`:e}const c=i?"esri-legend__layer-child-table":"esri-legend__layer-table",d=o?mt("div",{class:"esri-legend__layer-caption"},o):null,u={"esri-legend__layer-table--size-ramp":n||!i};return mt("div",{class:this.classes(c,u)},d,a)}_renderUnivariateAboveAndBelowRamp(e,t){const{sizeRampElement:i,colorRampElement:r}=ja(e,t),s=Va(i,"above"),n=Va(i,"below"),a=Pa(r,{width:12,height:s,rampAlignment:"vertical",opacity:t,type:"above"}),l=Pa(r,{width:12,height:n,rampAlignment:"vertical",opacity:t,type:"below"}),o=Da(i),c=i.infos.map((e=>e.label)),d=c.map(((e,t)=>{const i=2===t;return 0===t?mt("div",{key:t,class:e?a?gl:fl:null},e):i?mt("div",null):null})),u=c.map(((e,t)=>2===t||4===t?mt("div",{key:t,class:e?a?gl:fl:null},e):null)),p={display:"table-cell",verticalAlign:"middle"},y={marginTop:`${o}px`},h={height:`${s}px`},m={height:`${n}px`};return mt("div",{key:"univariate-above-and-below-ramp-preview",styles:bl},mt("div",{class:ll},i.infos.map(((e,t)=>mt("div",{class:this.classes(ol,hl)},mt("div",{class:pl,styles:p,bind:e.preview,afterCreate:Na}),a||t%2!=0?null:mt("div",{class:cl},c[t]))))),a?mt("div",{styles:y,key:"color-ramp-preview"},mt("div",{styles:vl},mt("div",{styles:wl},mt("div",{class:yl,bind:a,afterCreate:Na})),mt("div",{styles:wl},mt("div",{class:ml,styles:h},d))),mt("div",{styles:vl},mt("div",{styles:wl},mt("div",{class:yl,bind:l,afterCreate:Na})),mt("div",{styles:wl},mt("div",{class:ml,styles:m},u)))):null)}_renderLegendForRamp(e,t){const i=e.infos,r="opacity-ramp"===e.type,s="heatmap-ramp"===e.type,n="stretch-ramp"===e.type,a=e.preview,l=r?"esri-legend__opacity-ramp":"";a.className=`esri-legend__color-ramp ${l}`,null!=t&&(a.style.opacity=t.toString());const o=i.map((e=>mt("div",{class:e.label?fl:null},s?this.messages[e.label]:n?this._getStretchStopLabel(e):e.label))),c={height:a.style.height};return mt("div",{class:ol},mt("div",{class:ul,styles:{width:"24px"}},mt("div",{class:yl,bind:a,afterCreate:Na})),mt("div",{class:cl},mt("div",{class:ml,styles:c},o)))}_getStretchStopLabel(e){return e.label?this.messages[e.label]+": "+dt(e.value,{style:"decimal",notation:e.value.toString().indexOf("e")>-1?"scientific":"standard"}):""}_renderLegendForElementInfo(e,t,i,r){if(e.type)return this._renderLegendForElement(e,t,!0);let s=null;const n=Ga(t,r);if(e.preview?s=mt("div",{class:pl,bind:e.preview,afterCreate:Na}):e.src&&(s=this._renderImage(e,t,n)),!s)return null;const a={[dl]:n},l={[dl]:n,[hl]:!n&&i};return mt("div",{class:ol},mt("div",{class:this.classes(ul,l)},s),mt("div",{class:this.classes(cl,a)},Ba(this.messages,e.label,!1)||""))}_renderImage(e,t,i){const{label:r,src:s,opacity:n}=e,a={"esri-legend__imagery-layer-image--stretched":i,[pl]:!i},l={opacity:`${null!=n?n:t.opacity}`};return mt("img",{alt:Ba(this.messages,r,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(a),styles:l})}};a([Gt(),l()],_l.prototype,"activeLayerInfos",void 0),a([l(),Gt(),$t("esri/widgets/Legend/t9n/Legend")],_l.prototype,"messages",void 0),a([l({readOnly:!0})],_l.prototype,"type",void 0),_l=a([o("esri.widgets.Legend.styles.Classic")],_l);var Ll=_l;let Sl=class extends Ht{constructor(e,t){super(e,t),this._handles=new ee,this.activeLayerInfos=null,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.iconClass="esri-icon-layer-list",this.label=void 0,this.layerInfos=null,this.messages=null,this.style=new Ll,this.view=null,this.viewModel=new Ia}initialize(){this.own(At(this,"activeLayerInfos","change",(()=>this._refreshActiveLayerInfos(this.activeLayerInfos))),Ft(this,"style",((e,t)=>{t&&e!==t&&t.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view))})))}destroy(){this._handles.destroy(),this._handles=null}castStyle(e){if(e instanceof nl||e instanceof Ll)return e;if("string"==typeof e)return"card"===e?new nl:new Ll;if(e&&"string"==typeof e.type){const t=n({},e);return delete t.type,new("card"===e.type?nl:Ll)(t)}return new Ll}render(){return mt("div",{class:this.classes("esri-legend","esri-widget",this.style instanceof Ll?"esri-widget--panel":null)},this.style.render())}_refreshActiveLayerInfos(e){this._handles.removeAll(),e.forEach((e=>this._renderOnActiveLayerInfoChange(e))),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const t=Ft(e,"version",(()=>this.scheduleRender()));this._handles.add(t,`version_${e.layer.uid}`);const i=At(e,"children","change",(()=>{e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}));this._handles.add(i,`children_${e.layer.uid}`),e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}};a([Wt("viewModel.activeLayerInfos"),Gt()],Sl.prototype,"activeLayerInfos",void 0),a([Wt("viewModel.basemapLegendVisible"),Gt()],Sl.prototype,"basemapLegendVisible",void 0),a([Wt("viewModel.groundLegendVisible"),Gt()],Sl.prototype,"groundLegendVisible",void 0),a([Wt("viewModel.keepCacheOnDestroy")],Sl.prototype,"keepCacheOnDestroy",void 0),a([Wt("viewModel.respectLayerVisibility"),Gt()],Sl.prototype,"respectLayerVisibility",void 0),a([l()],Sl.prototype,"iconClass",void 0),a([l({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Sl.prototype,"label",void 0),a([Wt("viewModel.layerInfos"),Gt()],Sl.prototype,"layerInfos",void 0),a([l(),Gt(),$t("esri/widgets/Legend/t9n/Legend")],Sl.prototype,"messages",void 0),a([l(),Gt()],Sl.prototype,"style",void 0),a([g("style")],Sl.prototype,"castStyle",null),a([Wt("viewModel.view"),Gt()],Sl.prototype,"view",void 0),a([l(),Gt(["view.size"])],Sl.prototype,"viewModel",void 0),Sl=a([o("esri.widgets.Legend")],Sl);var Il=Sl,xl=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Il});const Ml={layers:{prcrParks:{displayName:"PRCR's Raleigh Parks for ParkServe - 2021",data:{path:"raleigh_parks_list_update_20210205.geojson",attribution:"City of Raleigh Parks, Recreation and Cultural Resources GIS"},popupTemplate:{title:"PRCR Inventory: {Park Name}",content:[{type:"fields",fieldInfos:[{fieldName:"Managing A",label:"Park Manager"}]}]},renderer:{type:"simple",symbol:El("#1B5E20")}},tplParks:{displayName:"TPL's Raleigh Parks for ParkServe - 2021",data:{path:"https://hosted.tplgis.org/hosted/rest/services/ParkServe/ParkServe_ProdWeb/FeatureServer/2",attribution:"Trust for Public Land",definitionExpression:"Park_Local_Manager LIKE '%Raleigh%'"},popupTemplate:{title:"TPL Inventory: {Park_Name}",content:[{type:"fields",fieldInfos:[{fieldName:"Park_Local_Owner",label:"Park Owner"},{fieldName:"Park_Local_Manager",label:"Park Manager"},{fieldName:"Park_Source_Agency",label:"Source Agency"}]}]},renderer:{type:"unique-value",valueExpression:"IIF(Upper($feature[\"Park_Local_Manager\"]) =='RALEIGH CITY OF', 'CITY OF RALEIGH', Upper($feature[\"Park_Local_Manager\"]))",valueExpressionTitle:"Park Manager According to TPL Data",defaultSymbol:El([158,158,158,1]),uniqueValueInfos:[{value:"CITY OF RALEIGH",symbol:El("#4CAF50")},{value:"BENTLEY & ASSOCIATES",symbol:El("#90CAF9")},{value:"NORTH CAROLINA STATE OF",symbol:{type:"simple-fill",color:El([255,213,79,1])}},{value:"WAKE COUNTY",symbol:El("#CE93D8")}]}},raleighCityLimits:{displayName:"Raleigh City Limits",data:{path:"https://maps.wakegov.com/arcgis/rest/services/Jurisdictions/Jurisdictions/MapServer/0",attribution:"Wake County GIS",definitionExpression:"LONG_NAME='RALEIGH'"},renderer:{type:"simple",symbol:El("#BDBDBD",0)}}}};function El(e,t=.2){return{type:"simple-fill",color:e,outline:{width:t,color:[0,0,0,.1]}}}Zt.assetsPath="./assets";const Cl=new Mr({url:Ml.layers.raleighCityLimits.data.path,definitionExpression:Ml.layers.raleighCityLimits.data.definitionExpression,title:Ml.layers.raleighCityLimits.displayName,copyright:Ml.layers.raleighCityLimits.data.attribution,renderer:Ml.layers.raleighCityLimits.renderer,opacity:.7,popupEnabled:!1,visible:!1}),kl=new Qt({url:Ml.layers.prcrParks.data.path,title:Ml.layers.prcrParks.displayName,copyright:Ml.layers.prcrParks.data.attribution,popupTemplate:Ml.layers.prcrParks.popupTemplate,renderer:Ml.layers.prcrParks.renderer}),Al=new Mr({url:Ml.layers.tplParks.data.path,definitionExpression:Ml.layers.tplParks.data.definitionExpression,title:Ml.layers.tplParks.displayName,copyright:Ml.layers.tplParks.data.attribution,popupTemplate:Ml.layers.tplParks.popupTemplate,renderer:Ml.layers.tplParks.renderer,opacity:1}),Fl=new Yt({container:"viewDiv",map:new Jt({basemap:"gray-vector",layers:[Cl,Al,kl]})});kl.when((()=>kl.queryExtent())).then((e=>Fl.goTo(e.extent)));const Tl=new Kt({view:Fl,container:"div"}),Rl=new Xt({view:Fl,content:Tl,expandTooltip:"Toggle Map Layers",group:"ui-elements"});Fl.ui.add(Rl,{position:"top-left"});const Ol=new Il({view:Fl,container:"div"}),Dl=new Xt({view:Fl,content:Ol,expandTooltip:"Legend",group:"ui-elements"});Fl.ui.add(Dl,{position:"top-left"});const Pl=new ei({view:Fl,container:"div"}),zl=new Xt({view:Fl,content:Pl,expandTooltip:"Basemap Gallery",group:"ui-elements"});Fl.ui.add(zl,"top-left");let Vl=document.getElementById("uiOptionsDiv");const jl=new Xt({view:Fl,content:Vl,expandTooltip:"Misc. UI",expandIconClass:"esri-icon-experimental",group:"ui-elements"});Fl.ui.add(jl,"top-left"),Fl.when((()=>{const e=document.getElementById("swipeToggle");let t;e.addEventListener("change",(()=>{console.log("Toggled!"),e.checked?(t=new ti({leadingLayers:[kl],trailingLayers:[Al],position:35,view:Fl}),Fl.ui.add(t)):(t.trailingLayers.removeAll(),t.leadingLayers.removeAll(),t.view.ui.remove(t))}));document.getElementById("fullExtentBtn").addEventListener("click",(()=>{Fl.goTo(kl.fullExtent,{duration:1e3})}));const i=document.getElementsByClassName("bookmarkBtn");for(let r of i)r.addEventListener("click",(()=>{let e=new E({xmin:parseFloat(r.dataset.xmin),ymin:parseFloat(r.dataset.ymin),xmax:parseFloat(r.dataset.xmax),ymax:parseFloat(r.dataset.ymax)});Fl.goTo(e,{duration:1e3,easing:"ease-in-out"})}))}));export{Er as F,xl as L,Tr as a,Zr as b,Xr as c,qs as d,Yr as e,Kr as f,js as g,Us as h,Rr as i,Cr as j,Br as k,bn as l,Bs as m,Fr as n,kr as o,Ns as p,Vr as q,Ar as r,jr as s,hr as t,Mr as u,lr as v,os as w,cr as x,ds as y,ls as z};
