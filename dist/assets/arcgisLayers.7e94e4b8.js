var e=Object.defineProperty,r=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.propertyIsEnumerable,l=(r,a,t)=>a in r?e(r,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[a]=t,n=(e,n)=>{for(var s in n||(n={}))r.call(n,s)&&l(e,s,n[s]);if(a)for(var s of a(n))t.call(n,s)&&l(e,s,n[s]);return e};import{a8 as s,q as o,m as u,ai as i,k as y}from"./vendor.1ee57f36.js";import{a as c}from"./lazyLayerLoader.c609a97f.js";async function f(e){const r=await async function(e){const r=s(e);if(o(r))throw new u("arcgis-layers:url-mismatch","The url '${url}' is not a valid arcgis resource",{url:e});const{serverType:a,sublayer:t}=r;let l;const n={FeatureServer:"FeatureLayer",StreamServer:"StreamLayer",VectorTileServer:"VectorTileLayer"};switch(a){case"MapServer":l=null!=t?"FeatureLayer":async function(e){return(await b(e)).tileInfo}(e).then((e=>e?"TileLayer":"MapImageLayer"));break;case"ImageServer":l=b(e).then((e=>{const r=e.tileInfo&&e.tileInfo.format;return e.tileInfo?!r||"LERC"!==r.toUpperCase()||e.cacheType&&"elevation"!==e.cacheType.toLowerCase()?"ImageryTileLayer":"ElevationLayer":"ImageryLayer"}));break;case"SceneServer":l=b(r.url.path).then((e=>{const r={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};if(e&&Array.isArray(e.layers)&&e.layers.length>0){const a=e.layers[0].layerType;if(null!=r[a])return r[a]}return"SceneLayer"}));break;default:l=n[a]}const i="FeatureServer"===a,y={parsedUrl:r,Constructor:null,layerOrTableId:i?t:null,sublayerIds:null,tableIds:null},f=await l;if({FeatureLayer:!0,SceneLayer:!0}[f]&&null==t){const r=await async function(e,r){var a,t;let l,n=!1;if("FeatureServer"===r){const r=await async function(e){var r,a;let t=await b(e);t=t||{},t.layers=(null==(r=t.layers)?void 0:r.filter(I))||[];const l={serviceJSON:t};if(t.currentVersion<10.5)return l;const n=await b(e+"/layers");return l.layersJSON={layers:(null==n||null==(a=n.layers)?void 0:a.filter(I))||[],tables:(null==n?void 0:n.tables)||[]},l}(e);n=!!r.layersJSON,l=r.layersJSON||r.serviceJSON}else l=await b(e);const s=null==(a=l)?void 0:a.layers,o=null==(t=l)?void 0:t.tables;return{layerIds:(null==s?void 0:s.map((e=>e.id)).reverse())||[],tableIds:(null==o?void 0:o.map((e=>e.id)).reverse())||[],layerInfos:n?s:[],tableInfos:n?o:[]}}(e,a);if(i&&(y.sublayerInfos=r.layerInfos,y.tableInfos=r.tableInfos),r.layerIds.length+r.tableIds.length!==1)y.sublayerIds=r.layerIds,y.tableIds=r.tableIds;else if(i){var d,p;y.layerOrTableId=null!=(d=r.layerIds[0])?d:r.tableIds[0],y.sourceJSON=null!=(p=r.layerInfos[0])?p:r.tableInfos[0]}}return y.Constructor=await async function(e){return(0,c[e])()}(f),y}(e.url),a=n(n({},e.properties),{url:e.url});if(!r.sublayerIds)return null!=r.layerOrTableId&&(a.layerId=r.layerOrTableId,a.sourceJSON=r.sourceJSON),new r.Constructor(a);const t=new((await import("./GroupLayer.173f8fe9.js")).default)({title:r.parsedUrl.title});return function(e,r,a){function t(e,t){const l=n(n({},a),{layerId:e,sublayerTitleMode:"service-name"});return y(t)&&(l.sourceJSON=t),new r.Constructor(l)}r.sublayerIds.forEach((a=>{const l=t(a,d(r.sublayerInfos,a));e.add(l)})),r.tableIds.forEach((a=>{const l=t(a,d(r.tableInfos,a));e.tables.add(l)}))}(t,r,a),t}function d(e,r){return e?e.find((e=>e.id===r)):null}function I(e){return!e.type||"Feature Layer"===e.type}async function b(e){return(await i(e,{responseType:"json",query:{f:"json"}})).data}export{f as fromUrl};
